(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[490],{1860:function(e,t,n){"use strict";var a=n(60),i=n(24),r=n(1117),o=Object(r.e)("ms-contextual-menu","./react/ReactContextualMenu",function(){return a.n.resolve(n.e(150).then(n.bind(null,4639)))});o.template='\x3c!--ko component:{name:\'od-overlay\',params:{alignToParent:false}}--\x3e<div role="application" data-bind="react:reactBindingParams"></div>\x3c!--/ko--\x3e',i.components.isRegistered(o.tagName)||i.components.register(o.tagName,o)},2297:function(e,t,n){"use strict";var a,i;function r(e){return e===i.htmlMp4||e===i.htmlFallback||e===i.flashMp4?a.mp4:e===i.htmlHls||e===i.htmlHlsMediaFoundationFallback||e===i.htmlHlsFFMPEGFallback?a.hls:e===i.htmlHlsV6||e===i.htmlHlsV6MediaFoundationFallback||e===i.htmlHlsV6FFMPEGFallback?a.hlsV6:a.dash}n.d(t,"e",function(){return a}),n.d(t,"t",function(){return i}),n.d(t,"a",function(){return r}),function(e){e.hls="hls",e.hlsV6="hlsV6",e.dash="dash",e.mp4="htmlMp4"}(a||(a={})),function(e){e.none="none",e.flashDash="flashDash",e.flashMp4="flashMp4",e.flashPending="flashPending",e.htmlMp4="htmlMp4",e.htmlDashling="htmlDashling",e.htmlDashlingMediaFoundationFallback="htmlDashlingMediaFoundationFallback",e.htmlHls="htmlHls",e.htmlHlsMediaFoundationFallback="htmlHlsMediaFoundationFallback",e.htmlFallback="htmlFallback",e.htmlDashlingFFMPEGFallback="htmlDashlingFFMPEGFallback",e.htmlHlsFFMPEGFallback="htmlHlsFFMPEGFallback",e.htmlHlsV6="htmlHlsV6",e.htmlHlsV6MediaFoundationFallback="htmlHlsV6MediaFoundationFallback",e.htmlHlsV6FFMPEGFallback="htmlHlsV6FFMPEGFallback"}(i||(i={})),t.n=i},2337:function(e,t,n){"use strict";n.d(t,"e",function(){return i}),n.d(t,"a",function(){return r}),n.d(t,"t",function(){return o}),n.d(t,"n",function(){return s});var a=n(7),i=new a.t("video.context"),r=new a.t("video.playbackPanelProvider"),o=new a.t("video.deepLinkProvider"),s=new a.t("video.pauseEvent")},2402:function(e,t,n){"use strict";n.d(t,"e",function(){return i});var a=36e5;function i(e){var t="",n=!1;if(e>=a){var i=Math.floor(e/a);e%=a,t+=i+":",n=!0}var r=Math.floor(e/6e4);e%=6e4,r<10&&n&&(t+="0"),t+=r+":";var o=Math.floor(e/1e3);return o<10&&(t+="0"),t+o}},2486:function(e,t,n){"use strict";var a=n(1136);n.d(t,"e",function(){return a.e})},3237:function(e,t,n){"use strict";n.d(t,"e",function(){return l}),n.d(t,"t",function(){return f});var a=n(0),i=n(60),r="SEFH",o="SEFT",s=r.length,c=o.length,d={};function l(e,t){return Object(a.__awaiter)(this,void 0,i.n,function(){return Object(a.__generator)(this,function(n){return[2,t.then(function(t){return function(e,t){return Object(a.__awaiter)(this,void 0,i.n,function(){var n,i,r;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),p("Generate new Blob Url for item key ",e),[4,m(t)];case 1:return n=a.sent(),i=new Blob([u(n)],{type:"video/mp4"}),d[e]=window.URL.createObjectURL(i),[2,d[e]];case 2:return r=a.sent(),[2,Promise.reject(r)];case 3:return[2]}})})}(e.key,t)}).catch(function(e){return i.n.reject(e)})]})})}function u(e){try{var t=new DataView(e),n={startSignature:"",formatVersion:0,dataCount:0,dataReferences:[],endSignature:""},a=e.byteLength-c;n.endSignature=String.fromCharCode(t.getInt8(a),t.getInt8(a+1),t.getInt8(a+2),t.getInt8(a+3));var i=4+c,d=t.getUint32(e.byteLength-i,!0)+i;p("SEF Tail Size: ",d);var l=e.byteLength-d,u=l+s,f=u+4;n.startSignature=String.fromCharCode(t.getInt8(l),t.getInt8(l+1),t.getInt8(l+2),t.getInt8(l+3)),n.formatVersion=t.getUint32(u,!0),n.dataCount=t.getUint32(f,!0);for(var m=l+s+4+4,_=0;_<n.dataCount;++_)n.dataReferences[_]={subData:t.getUint16(m,!0),dataType:t.getUint16(m+2,!0),startPosition:t.getUint32(m+4,!0),dataLength:t.getUint32(m+8,!0)},m+=12;if(D=!0,((S=n).startSignature!==r||S.endSignature!==o||S.formatVersion<101||S.dataCount<=0||2608!==S.dataReferences[S.dataCount-1].dataType)&&(D=!1),p(D?"":"INVALID ","SEF Tail",S),!D)throw new Error("Invalid SEF: "+JSON.stringify(n));var h=d+n.dataReferences[n.dataCount-1].dataLength,b=8+t.getUint32(e.byteLength-h+4,!0);if(p("SEG Header Size: ",b),24!==b)throw new Error("Unexpected motionPhotoHeaderSize: "+b);var g=d+n.dataReferences[n.dataCount-1].dataLength-b,v=e.byteLength-g;p("MP4 Offset: ",v);var y=e.slice(v);if(!function(e){var t=!1,n=new DataView(e);return e.byteLength>8&&(t="ftyp"===String.fromCharCode(n.getInt8(4),n.getInt8(5),n.getInt8(6),n.getInt8(7))),t||p("Not an MP4"),t}(y))throw new Error("Invalid MP4");return y}catch(e){throw e.message="SamsungMotionPhoto Error: "+(e.message||""),p(e.name||"",e.message),e}var S,D;return new ArrayBuffer(0)}function f(e){d[e]&&(window.URL.revokeObjectURL(d[e]),delete d[e],p("Freeing videoBlobs[",e,"]"))}function p(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function m(e){return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(t){return[2,new Promise(function(t){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsArrayBuffer(e)})]})})}},3274:function(e,t,n){"use strict";var a=function(){function e(){}return e.isFullScreen=function(){var e=window.document;return e.fullscreenElement||e.mozFullScreenElement||e.webkitFullscreenElement||e.msFullscreenElement},e.enterFullScreen=function(){var t=window.document.body;e.isFullScreen()||(t.requestFullscreen?t.requestFullscreen():t.msRequestFullscreen?t.msRequestFullscreen():t.mozRequestFullScreen?t.mozRequestFullScreen():t.webkitRequestFullscreen&&t.webkitRequestFullscreen())},e.exitFullScreen=function(){var e=window.document;e.exitFullscreen?e.exitFullscreen():e.msExitFullscreen?e.msExitFullscreen():e.mozCancelFullScreen?e.mozCancelFullScreen():e.webkitExitFullscreen&&e.webkitExitFullscreen()},e.isFullScreenAllowed=function(){var e=window.document;return e.fullscreenEnabled||e.webkitFullscreenEnabled||e.mozFullScreenEnabled||e.msFullscreenEnabled},e}();t.e=a},3275:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(7),i=n(1929),r=new a.t({name:"PaneProvider.key",factory:i.e})},4496:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return ea});var a=n(17);Object(a.n)([{rawString:".od-OneUpVideo-watermark{display:block;width:108px;height:108px;position:absolute;left:50%;top:50%;transform:translate(-50%,-50%)}.od-burstPhotoBadgeContainer{position:relative;width:100%;height:100%}[dir=ltr] .od-burstPhotoBadgeContainer{margin-left:12px}[dir=rtl] .od-burstPhotoBadgeContainer{margin-right:12px}.od-AppleLivePhotoBadge{width:60px}.od-SamsungMotionPhotoBadge{width:82px}.od-burstPhotoVideo-button{opacity:80%;margin-top:16px;height:21px;border:0;border-radius:4px;cursor:pointer}.od-burstPhotoVideo-button[disabled]:hover{opacity:80%}.od-burstPhotoVideo-button:hover{opacity:50%}.od-burstPhotoVideo-button[disabled]{cursor:wait}.od-burstPhoto-loadingSpinner{width:20px;height:20px;opacity:100%}"}]);var i=n(0),r=n(24),o=n(230),s=n(215),c=n(47),d=n(179),l=n(3275),u=n(2706);Object(a.n)([{rawString:".od-VideoPlayer--isFullScreen{position:fixed;left:0;top:0;width:100%;height:100%;background:"},{theme:"black",defaultValue:"#000"},{rawString:"}.od-VideoPlayer-frame{border:none;height:100%;width:100%}.od-VideoPlayer-canvas,.od-VideoPlayer-status{position:absolute;top:0;left:0;right:0;bottom:0}.od-VideoPlayer-status{background-color:rgba(0,0,0,.8);color:"},{theme:"white",defaultValue:"#fff"},{rawString:";text-align:center;display:none}.od-VideoPlayer-status .od-VideoPlayer-statusContent .od-ButtonBar-main{float:none}.od-VideoPlayer-statusContent{position:absolute;top:50%;left:50%;right:-50%;transform:translate(-50%,-50%);padding:20px}.od-VideoPlayer--hasStatus .od-VideoPlayer-status{display:block}.od-VideoPlayer-debugText{color:"},{theme:"neutralTertiary",defaultValue:"#a19f9d"},{rawString:";font-size:11px;padding:20px 0 0 0}.od-VideoPlayer-statusButton{width:100px;height:100px;line-height:100px;vertical-align:middle;padding:0;margin:20px;border:2px solid "},{theme:"white",defaultValue:"#fff"},{rawString:";border-radius:50%;box-sizing:border-box;font-size:75px;color:"},{theme:"white",defaultValue:"#fff"},{rawString:";background-color:rgba(0,0,0,.5);cursor:pointer}.od-VideoPlayer-statusButton:before{font-size:42px;display:block}.od-VideoPlayer-statusButton:hover{background-color:"},{theme:"neutralSecondaryAlt",defaultValue:"#8a8886"},{rawString:"}.od-VideoPlayer-statusButton:active{background-color:"},{theme:"white",defaultValue:"#fff"},{rawString:";border-color:"},{theme:"black",defaultValue:"#000"},{rawString:";color:"},{theme:"black",defaultValue:"#000"},{rawString:"}.od-VideoPlayer .od-VideoCanvas-video{position:absolute;left:0;top:0;width:100%;height:100%}"}]),Object(a.n)([{rawString:".od-VideoCanvas object,.od_videoCanvas video{position:absolute;left:0;top:0;width:100%;height:100%}"}]);var f,p=n(399),m=n(196),_=n(178),h=n(2806),b=n(90);!function(e){e.none="none",e.unknown="unknown",e.unsupportedFormat="unsupportedFormat",e.unsupportedBrowser="unsupportedBrowser",e.getDownloadUrlFailure="getDownloadUrlFailure",e.htmlElementDecode="htmlElementDecode",e.htmlElementNetwork="htmlElementNetwork",e.htmlElementAborted="htmlElementAborted",e.htmlElementSrcNotSupported="htmlElementSrcNotSupported",e.htmlElementOther="htmlElementOther",e.htmlDashlingMediaSourceInit="htmlDashlingMediaSourceInit",e.htmlDashlingManifestDownload="htmlDashlingManifestDownload",e.htmlDashlingInitSegmentDownload="htmlDashlingInitSegmentDownload",e.htmlDashlingMediaSegmentDownload="htmlDashlingMediaSegmentDownload",e.htmlDashlingManifestParse="htmlDashlingManifestParse",e.htmlDashlingVideoElementError="htmlDashlingVideoElementError",e.htmlDashlingSourceBufferInit="htmlDashlingSourceBufferInit",e.htmlDashlingSourceBufferAppendException="htmlDashlingSourceBufferAppendException",e.htmlDashlingSourceBufferAppendMissing="htmlDashlingSourceBufferAppendMissing",e.htmlDashlingWebCryptoInitError="htmlDashlingWebCryptoInitError",e.htmlDashlingAesKeyFetchError="htmlDashlingAesKeyFetchError",e.htmlDashlingSegmentDecryptionError="htmlDashlingSegmentDecryptionError",e.htmlDashlingOther="htmlDashlingOther",e.htmlOther="htmlOther",e.flashLoadTimeout="flashLoadTimeout",e.flashOther="flashOther",e.throttled="throttled",e.unsupportedCodec="unsupportedCodec",e.emptyFile="emptyFile",e.bitRateTooHigh="bitRateTooHigh",e.html5VideoUnsupported="html5VideoUnsupported",e.h264Unsupported="h264Unsupported",e.mediaSourceUnsupported="mediaSourceUnsupported",e.geoLocInvalidRequest="geoLocInvalidRequest"}(f||(f={}));var g,v,y,S=f,D=function(e){function t(t){var n=e.call(this,t)||this,a=t.type,i=void 0===a?S.unknown:a,r=t.isRetriable,o=void 0===r||r,s=t.requiresNewUrl,c=void 0!==s&&s;return n.type=i,n.isRetriable=o,n.requiresNewUrl=c,n.isBreakingTooManyRequestFlow=!!t.isBreakingTooManyRequestFlow,n}return Object(i.__extends)(t,e),t}(b.e),I=n(256),x={manifest:null,startTime:0,isABREnabled:!0,isRBREnabled:!1,targetQuality:{audio:2,video:2},abrLimitQuality:null,shouldAutoPlay:!0,logToConsole:!1,safeBufferSeconds:12,maxBufferSeconds:119.5,requestStaggerTimeMultiple:1.4,maxConcurrentRequests:{audio:4,video:6},maxSegmentLeadCount:{audio:1,video:5},defaultBandwidth:15e4,requestTimeout:3e4,maxRetries:3,delaysBetweenRetries:[200,1500,3e3],requestCacheThreshold:80,baseUrlOverride:null,preprocessRequest:null,getRequestParametersAsync:null,getDiagnosticInfo:null,testConnectivity:null,missingSegmentThreshold:0,publishResponseMetaData:null,publishAPIStats:null,publishOperationStats:null,publishTelemetryInfo:null,publishEventInfo:null,isDecryptorV2Enabled:!0,getKeyAsync:null,NoEncryptionCDNPlayback:!1,flushBufferredDataDuringStreamReset:!1,useOtherTracksDuringTimeouts:!0,checkForCorsErrors:!1,checkForPlaybackStallsOnDemand:!1,limitMaxDefaultbandwidth:!1,playbackSessionId:null,enableMaxRetriesCheckInRequestManager:!1,preTranscode:{enabled:!1,segmentCount:0},isDecryptionErrorsInvestigationEnabled:!1},C=n(170),O=window.clearTimeout,w=window.setTimeout,E=window.setInterval,A=function(){function e(e){this._parent=e,this._throttleIds={},this._timeoutIds={}}return e.prototype.dispose=function(){if(this._throttleIds){for(var e in this._throttleIds)O(this._throttleIds[e]);this._throttleIds=null}for(var e in this._timeoutIds)O(Number(e));this._timeoutIds=null},e.prototype.setTimeout=function(e,t){return this._setTimer(e,t,w)},e.prototype.setInterval=function(e,t){return this._setTimer(e,t,E)},e.prototype.clearTimeout=function(e){O(e),this._timeoutIds&&delete this._timeoutIds[e]},e.prototype.throttle=function(e,t,n){var a=this,i=this._throttleIds;i&&(i[t]||(i[t]=w(function(){e.apply(a._parent),delete i[t]},n)))},e.prototype._setTimer=function(e,t,n){var a,i=this;return this._timeoutIds?((a=n(function(){i._timeoutIds&&delete i._timeoutIds[a],e.apply(i._parent)},t))&&(this._timeoutIds[a]=a),a):0},e}(),L=function(){function e(e){this.reset(),this._max=e}return e.prototype.append=function(e){var t=this.average,n=this.metricValues,a=n.push(e),i=(e-t)/a;a>this._max&&(i+=(t+i-n.shift())/(a-1)),this.average+=i,this.min=Math.min(e,this.min),this.max=Math.max(e,this.max)},e.prototype.reset=function(){this.metricValues=[],this.average=this.min=this.max=0},e}();!function(e){e[e.disconnected=-2]="disconnected",e[e.error=-1]="error",e[e.idle=0]="idle",e[e.initializing=1]="initializing",e[e.manifestFetched=2]="manifestFetched",e[e.aeskeyfetched=3]="aeskeyfetched",e[e.mediaSourceInitStarted=4]="mediaSourceInitStarted",e[e.mediaSourceInitialized=5]="mediaSourceInitialized",e[e.buffering=6]="buffering",e[e.playing=7]="playing",e[e.paused=8]="paused",e[e.missingSegmentDetected=9]="missingSegmentDetected",e[e.playerStallDetected=10]="playerStallDetected"}(g||(g={})),function(e){e[e.disconnected=-2]="disconnected",e[e.error=-1]="error",e[e.idle=0]="idle",e[e.downloading=1]="downloading",e[e.downloaded=2]="downloaded",e[e.endOfStream=3]="endOfStream",e[e.appending=4]="appending",e[e.appended=5]="appended",e[e.aborted=6]="aborted",e[e.appendedButDataMissing=7]="appendedButDataMissing"}(v||(v={})),function(e){e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED",e[e.MS_MEDIA_ERR_ENCRYPTED=5]="MS_MEDIA_ERR_ENCRYPTED"}(y||(y={}));var k=0,M=function(){function e(e){this._settings=e,this._activeRequests=Object.create(null),this.waitTimes=new L(20),this.receiveTimes=new L(20),this.bytesPerSeconds=new L(20),this._activeRequestCount=0,this._currentConsecutiveFailureCount=0,this._maxConsecutiveErrors=this._settings.maxRetries*Math.max(this._settings.maxConcurrentRequests.audio,this._settings.maxConcurrentRequests.video)}return e.prototype.dispose=function(){this.abortAll()},e.prototype.getActiveRequestCount=function(){return this._activeRequestCount},e.prototype.abortAll=function(){var e=this._activeRequests;for(var t in e)e[t].dispose();this._activeRequests=Object.create(null)},e.prototype.start=function(e){var t=this;if(this._settings.enableMaxRetriesCheckInRequestManager&&this._currentConsecutiveFailureCount>this._maxConsecutiveErrors&&this.lastErroredReq)throw new Error("too many retries without success");this._activeRequests[k++]=e,this._activeRequestCount++,e.start({onBandwidthUpdate:function(e){t._onBandwidthUpdate(e)},onComplete:function(e){t._onComplete(e)}})},e.prototype._onComplete=function(e){e.isCompleted()?(this._activeRequestCount--,this._currentConsecutiveFailureCount=0,this.lastErroredReq=null,e.state===v.downloaded&&(e.timeAtLastByte<this._settings.requestCacheThreshold||(this.waitTimes.append(e.timeAtFirstByte),this.receiveTimes.append(e.timeAtLastByte)))):(this._currentConsecutiveFailureCount++,this.lastErroredReq=this.lastErroredReq||{errorMessage:e.statusCode,httpStatus:e.httpStatus,correlationId:e.correlationId})},e.prototype._onBandwidthUpdate=function(e){this.bytesPerSeconds.append(e)},e}(),P=performance&&performance.now?performance:Date,T=/(msie|trident.*rv:)/i.test(navigator.userAgent),U=function(){function e(e,t){this._options=e,this._settings=t,this.state=v.idle,this.data=null,this.timeAtFirstByte=-1,this.timeAtLastByte=-1,this.statusCode="",this.progressEvents=[],this.bytesLoaded=0,this.bytesPerMillisecond=0,this.correlationId="",this.requestType=e.requestType,this.fragmentIndex=e.fragmentIndex,this.qualityIndex=e.qualityIndex,this.qualityId=e.qualityId,this.clearDataAfterAppend=e.clearDataAfterAppend,this.hasUpdatedBufferRate=!1,this.fragment=e.fragment,this.isAborted=!1,this.requestUrl="",this._xhrType=XMLHttpRequest,this._responseHeaders=null,this.qualityIndexAttempted=e.qualityIndexAttempted||[],this.qualityIndexAttempted.push(this.qualityIndex),this.requestAttempt=e.currentRetryCount||0,this._streamType=e.streamType}return e.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._xhr&&(this.state===v.downloading&&(this.state=v.aborted,this.statusCode="aborted",this.isAborted=!0,this._xhr.abort(),this._options.onError&&this._options.onError(this),this._complete()),this._xhr=null),this._retryTimeoutId&&(clearTimeout(this._retryTimeoutId),this._retryTimeoutId=null),this._onBandwidthUpdate=this._onComplete=null)},e.prototype.isCompleted=function(){return this.state===v.downloaded||this.state===v.endOfStream||this.isAborted},e.prototype.start=function(e){var t=this;this._onBandwidthUpdate=e.onBandwidthUpdate,this._onComplete=e.onComplete;var n=this,a=n._options,i=a.url,r=a.isArrayBuffer,o=n._xhr=new n._xhrType;n._responseHeaders=null;var s=n._settings;n.requestAttempt++,n.isTimedOut=!1,n.state=v.downloading;var c=function(e){var a=n.startTime=P.now(),i=e.url,s=e.headers,c=e.body,d=e.useCredentials;if(n.requestUrl=i,o.open(c?"POST":"GET",i,!0),r&&(o.responseType="arraybuffer"),s)for(var l=0,u=Object.keys(s);l<u.length;l++){var f=u[l];s[f]&&o.setRequestHeader(f,s[f])}d&&(o.withCredentials=!0),o.timeout=n._settings.requestTimeout,o.onreadystatechange=function(){!n._isDisposed&&o.readyState>0&&n.timeAtFirstByte<0&&(n.timeAtFirstByte=P.now()-a)},o.onprogress=function(e){n._isDisposed||(n.progressEvents.push({timeFromStart:P.now()-a,bytesLoaded:e.loaded}),n._postProgress())},o.onloadend=function(){n._isDisposed||n._processResult()},o.ontimeout=function(){n._isDisposed||(n.isTimedOut=!0)},t._settings.publishAPIStats&&t._settings.publishAPIStats({requestType:n.requestType,isRequestStarted:!0,fragment:t.fragment}),o.send(c)};s.getRequestParametersAsync?s.getRequestParametersAsync(i,this.requestType).then(c,function(e){n.state=v.error,n.statusCode=e.code?"getRequestParametersAsync "+e.code:"getRequestParametersAsync",n.httpStatus=0,n.correlationId=e.correlationId,n._complete(),n._options.onError&&n._options.onError(n)}):(s.preprocessRequest&&(i=s.preprocessRequest(i)),c({url:i,headers:{spo_access_token:this._options.token}}))},e.prototype.getPreTranscodeInfo=function(){var e=this._xhr,t=this._getResponseHeaders(e);return{enabled:!!t.pretranscodesegmentcount,segmentCount:Number(t.pretranscodesegmentcount)||0}},e.prototype._processResult=function(){var e=this,t=e._xhr,n=e.progressEvents,a=e._options.isArrayBuffer,i=e._settings,r=this._getResponseHeaders(t)||{};if(e._xhr=null,e.timeAtLastByte=P.now()-e.startTime,i.publishAPIStats){var o="",s=!(t.status>=200&&t.status<=299),c=!s&&r&&"TCP_MISS"===r["x-cache"],d=!s&&r&&("TCP_HIT"===r["x-cache"]||"TCP_REMOTE_HIT"===r["x-cache"]),l=!s&&!d&&!c&&e.timeAtLastByte<20;(d||c)&&(o=r["x-msedge-ref"]+"||"+r["x-azure-ref-originshield"]);var u=-1!==this.requestUrl.indexOf("enableCdn=1");-1===this.requestUrl.indexOf("/transform/VideoProtectionKey")&&(i.NoEncryptionCDNPlayback="1"===r.nonencryptedplayback),i.publishAPIStats({requestType:this.requestType,isRetry:1!==this.requestAttempt,isFailure:s,responseTimeMs:e.timeAtLastByte,isBrowserCached:l,isCDNCacheMiss:c,isCDNCacheHit:d,correlationId:r["x-correlationid"],cdnRefIds:o,fragment:this.fragment,isCDNEnabled:u,requestAttempt:this.requestAttempt,xhr:t,streamType:this._streamType})}if(t.status>=200&&t.status<=299){if(e.bytesLoaded=a?t.response.byteLength:t.responseText?t.responseText.length:0,t.onreadystatechange(null),e._postProgress(),n.length>2){var f=n[n.length-1],p=n[0],m=f.timeFromStart-p.timeFromStart,_=f.bytesLoaded-p.bytesLoaded;e.bytesPerMillisecond=_/m,e.timeAtFirstByte=e.timeAtLastByte-e.bytesLoaded/e.bytesPerMillisecond}e.data=a?new Uint8Array(t.response):t.responseText,e.statusCode=String(t.status),e.state=v.downloaded,e.timeAtLastByte>20&&i.publishResponseMetaData&&(u=-1!==this.requestUrl.indexOf("enableCdn=1"),i.publishResponseMetaData({headers:r,requestType:this.requestType,bytesLoaded:e.bytesLoaded,isCDNEnabled:u})),e.correlationId=r["x-correlationid"];var h=r["x-errorcode"]||r["x-clienterrorcode"];h&&h.indexOf("EndOfStream")>-1&&(e.hasStreamEnded=!0),e._complete(),e._options.onSuccess&&e._options.onSuccess(e)}else e._processError(t)},e.prototype._processError=function(e){var t=this,n=e.status,a=t._settings,i=t.requestAttempt<a.maxRetries,r=!t.isAborted&&(n<400||n>406)&&i;t.isUnknownError=0===n&&!t.isTimedOut;var o=a.delaysBetweenRetries;if("init"!==t.requestType&&"manifest"!==t.requestType&&"key"!==t.requestType&&(t.isTimedOut||t.isUnknownError)&&t._settings.useOtherTracksDuringTimeouts&&i)t._processTerminalError(e);else if(r){var s=o[t.requestAttempt-1]||o[o.length-1];t._retryTimeoutId&&window.clearTimeout(t._retryTimeoutId),t._retryTimeoutId=window.setTimeout(function(){t.start({onBandwidthUpdate:t._onBandwidthUpdate,onComplete:t._onComplete})},s)}else{var c=t._options.isArrayBuffer?e.response:e.responseText;!a.testConnectivity||0!==n||c||t.isTimedOut?t._processTerminalError(e):a.testConnectivity(t.requestUrl).then(function(){t._settings.checkForCorsErrors&&!T&&window.fetch?window.fetch(t.requestUrl,{mode:"no-cors"}).then(function(){t.state=v.error,t.statusCode="cors-error",t.httpStatus=0,t._complete(),t._options.onError&&t._options.onError(t)}).catch(function(){t._processTerminalError(e)}):t._processTerminalError(e)},function(e){var n;n=e.code,t.state=v.disconnected,t.statusCode=n||"disconnected",t.httpStatus=0,t._complete(),t._options.onError&&t._options.onError(t)})}},e.prototype._processTerminalError=function(e){var t=this,n=e.status,a=this._getResponseHeaders(e),i=a["x-errorcode"]||a["x-clienterrorcode"],r=a["x-correlationid"];i&&i.indexOf("EndOfStream")>-1&&(t.hasStreamEnded=!0),t.state=v.error,t.statusCode=t.isAborted?"aborted":t.isTimedOut?"timeout":t.isUnknownError?"unknownError":i||String(n),t.httpStatus=n,t.correlationId=r,t._complete(),t._options.onError&&t._options.onError(t)},e.prototype._postProgress=function(){if(this._onBandwidthUpdate){var e=this.progressEvents;if(e.length>2){var t=e[e.length-1],n=e[0],a=t.bytesLoaded-n.bytesLoaded;if(a>1e4){var i=t.timeFromStart-n.timeFromStart;i>5&&this._onBandwidthUpdate(1e3*a/i)}}}},e.prototype._complete=function(){this._onComplete&&this._onComplete(this),this._onComplete=null,this._onBandwidthUpdate=null},e.prototype._getResponseHeaders=function(e){var t=this._responseHeaders;if(!t){this._responseHeaders=t={};try{for(var n=0,a=e.getAllResponseHeaders().split("\r\n");n<a.length;n++){var i=a[n],r=i.indexOf(":");r&&(t[i.slice(0,r)]=i.slice(r+1).trim())}}catch(e){}}return t},e}();function F(e,t){t&&!t.logToConsole||console.log(e)}"function"!=typeof Object.values&&(Object.values=function(e){return Object.keys(e).map(function(t){return e[t]})});var H=function(){function e(e,t){this._prefix=e||"",this._useSessionStorage=!!t}return e.prototype.getItem=function(e,t){e=this._prefix+e;try{return this._useSessionStorage?window.sessionStorage.getItem(e):window.localStorage.getItem(e)}catch(e){}return t},e.prototype.setItem=function(e,t){e=this._prefix+e;try{this._useSessionStorage?window.sessionStorage.setItem(e,t):window.localStorage.setItem(e,t)}catch(e){}},e}(),R=performance&&performance.now?performance:Date;function N(e,t){return t&&t.isDecryptionErrorsInvestigationEnabled&&e&&e.details?JSON.stringify(e.details,["code","message","name","stack","error"]):e.details&&e.details.message}var B,j="urn:mpeg:dash:sea:aes128-cbc:2013",V="aes-cbc";!function(e){e[e.IDLE=0]="IDLE",e[e.KEY_FETCHED=1]="KEY_FETCHED",e[e.CRYPTO_INITIALIZED=2]="CRYPTO_INITIALIZED",e[e.ERRORED=3]="ERRORED"}(B||(B={}));var z,G=function(){function e(e){var t=window,n=t.crypto||t.msCrypto;if(!n)throw new Error("no crypto support");this._webCryptor=n.subtle||n.webkitSubtle,this._settings=e,this._keyInfo=[],this.state=B.IDLE,this._pendingDecryptOperations=[],this._requestManager=new M(e),this._events=new C.e(this)}return e.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._events.dispose(),this._requestManager.dispose(),this._pendingDecryptOperations=[])},e.prototype.init=function(e,t,n){var a=this;if(e.schemeIdUri!==j)throw new Error("unknown encryption scheme ".concat(e.schemeIdUri));var i=this,r=function(r){if(!a._isDisposed){i._events.raise("sessionStateChange",{state:g.aeskeyfetched});var o=a._webCryptor.importKey("raw",new Uint8Array(r),V,!1,["decrypt"]),s=function(n){n=o.result||n,t(n,e)},c=function(e){n({step:"init",details:e})};if("oncomplete"in o){var d=o;d.oncomplete=s,d.onerror=c}else o.then(function(e){s(e)},function(e){c(e)})}},o=function(e){r(e.data)},s=function(e){a._isDisposed||n({step:"keyfetch",request:e})},c=function(){var t=new U({url:e.keyUri,requestType:"key",isArrayBuffer:!0,onSuccess:o,onError:s,token:a._settings.keyToken},a._settings);a._requestManager.start(t)};this._settings.getKeyAsync?this._settings.getKeyAsync(r,function(e){a._isDisposed||c()}):c()},e.prototype.decrypt=function(e,t,n,a,i){var r=this,o=R.now(),s={name:V,iv:n},c=this._webCryptor.decrypt(s,t,new Uint8Array(e)),d=function(e){r._isDisposed||(e=c.result||e,r._publishDecryptionTime(R.now()-o),a(e))},l=function(e){r._isDisposed||(r._publishDecryptionTime(R.now()-o),i({step:"decryption",details:e}))};if("oncomplete"in c){var u=c;u.oncomplete=d,u.onerror=l,u.onabort=l}else c.then(function(e){d(e)},function(e){l(e)})},e.prototype.initV2=function(e,t){var n=this;if(e.schemeIdUri!==j)throw new Error("unknown encryption scheme ".concat(e.schemeIdUri));var a=function(a){if(!n._isDisposed){n.state=B.KEY_FETCHED,n._events.raise("sessionStateChange",{state:g.aeskeyfetched});var i=n._webCryptor.importKey("raw",new Uint8Array(a),V,!1,["decrypt"]),r=function(t){t=i.result||t,n._keyInfo.push({contentProtection:e,importedKey:t}),n.state=B.CRYPTO_INITIALIZED,n._decryptPendingData()},o=function(e){t({step:"init",details:e}),n.state=B.ERRORED};if("oncomplete"in i){var s=i;s.oncomplete=r,s.onerror=o}else i.then(function(e){r(e)},function(e){o(e)})}},i=function(e){a(e.data)},r=function(e){n._isDisposed||(t({step:"keyfetch",request:e}),n.state=B.ERRORED)},o=function(){var t=new U({url:e.keyUri,requestType:"key",isArrayBuffer:!0,onSuccess:i,onError:r,token:n._settings.keyToken},n._settings);n._requestManager.start(t)};this._settings.getKeyAsync?this._settings.getKeyAsync(a,function(e){n._isDisposed||o()}):o()},e.prototype.decryptV2=function(e,t,n,a,i){this.state===B.CRYPTO_INITIALIZED?this._decrypt(e,t,n,a,i):this._pendingDecryptOperations.push({data:e,iv:n,contentProtection:t,onFailure:i,onSuccess:a})},e.prototype._decryptPendingData=function(){var e=this;this._pendingDecryptOperations.forEach(function(t){e._decrypt(t.data,t.contentProtection,t.iv,t.onSuccess,t.onFailure)}),this._pendingDecryptOperations=[]},e.prototype._decrypt=function(e,t,n,a,i){var r=this,o=R.now(),s={name:V,iv:n},c=this._keyInfo.length>0?this._keyInfo[0].importedKey:null;if(!c)throw new Error("_decryptInternal next called before fetching imported key");var d=this._webCryptor.decrypt(s,c,new Uint8Array(e)),l=function(e){r._isDisposed||(e=d.result||e,r._publishDecryptionTime(R.now()-o),a(e))},u=function(e){r._isDisposed||(r._publishDecryptionTime(R.now()-o),i({step:"decryption",details:e}))};if("oncomplete"in d){var f=d;f.oncomplete=l,f.onerror=u,f.onabort=u}else d.then(function(e){l(e)},function(e){u(e)})},e.prototype._publishDecryptionTime=function(e){this._settings.publishOperationStats&&this._settings.publishOperationStats({operationName:"decryptionTime",processingTimeMs:e})},e}(),K="bytesPerSecond",W=performance&&performance.now?performance:Date,q=function(){function e(e,t,n,a,i){var r=a.manifest,o=r.streams[e];this._events=new C.e(this),this._async=new A(this),this._storage=new H("Dashling.Stream."),this.streamType=e,this.qualityIndex=Math.max(0,Math.min(o.qualities.length-1,a.targetQuality[e])),this.bufferRate=new L(5),this._startTime=W.now(),this._appendLength=0,this._appendTimeoutId=0,this._initRequestManager=new M(a),this.requestManager=new M(a),this._mediaSource=t,this._videoElement=n,this._settings=a,this._manifest=r,this._streamInfo=o,this._buffer=null,this._initSegments=[],this._isAppending=!1,this._isDisposed=!1,this._decryptor=i,this._videoSegmentsDownloadCount=0;var s=o.timeline.map(function(e,t){return{state:v.idle,qualityIndex:-1,qualityId:"",requestType:"media",fragmentIndex:t,time:e,activeRequest:null,requests:[]}});this.fragments=s}return e.prototype.dispose=function(){this._isDisposed||(this._isDisposed=!0,this._events.dispose(),this._async.dispose(),this.requestManager.dispose(),this._initRequestManager.dispose())},e.prototype.initialize=function(){var e=this._streamInfo.mimeType+";codecs="+this._streamInfo.codecs,t=this._events;if(!this._buffer)try{F("Creating "+e+" buffer",this._settings);var n=this._buffer=this._mediaSource.addSourceBuffer(e);t.on(n,"error",function(n){t.raise("sessionStateChange",{state:g.error,errorType:"sourceBufferError",errorMessage:"type=".concat(e," error=").concat(n)})})}catch(n){t.raise("sessionStateChange",{state:g.error,errorType:"sourceBufferInit",errorMessage:"type=".concat(e," error=").concat(n)})}},e.prototype.abortAll=function(){this.requestManager.abortAll()},e.prototype.clearBuffer=function(){this._async.clearTimeout(this._appendTimeoutId),this._isAppending=!1,this.abortAll();try{this._buffer.remove(0,this._videoElement.duration)}catch(e){}for(var e=0,t=this.fragments;e<t.length;e++){var n=t[e];(n.state!==v.downloaded||"audio"===this.streamType&&this._settings.flushBufferredDataDuringStreamReset)&&(n.state=v.idle)}},e.prototype.canAppend=function(e){var t=this.fragments[e],n=t&&this._initSegments[t.qualityIndex];return!!(t&&t.state===v.downloaded&&n&&n.state>=v.downloaded)},e.prototype.isAppended=function(e){var t=this.fragments[e];return!(!t||t.state!==v.appended&&t.state!==v.appendedButDataMissing&&t.state!==v.endOfStream)},e.prototype.append=function(e,t){var n=this,a=n.fragments,i=a[e],r=[],o=n._buffer,s=n._settings.missingSegmentThreshold;function c(){if(!n._isDisposed)if(o.updating)n._appendTimeoutId=n._async.setTimeout(c,10);else if(r.length){var f=r[0];n._events.on(o,"updateend",l);try{d("started",f),o.appendBuffer(f.data)}catch(e){var p=e;p.code===DOMException.QUOTA_EXCEEDED_ERR||p.code===DOMException.INVALID_STATE_ERR?(F("Append failed due to exception with code ".concat(p.code,"; trying again momentarily")),n._events.off(o),n._appendTimeoutId=setTimeout(c,500)):u("sourceBufferAppendException",e)}}else n._appendTimeoutId=n._async.setTimeout(function(){if(!n._isDisposed){var r=i.activeRequest&&i.activeRequest.hasStreamEnded;i.state=r?v.endOfStream:v.appended,n._isAppending=!1;var o=e-a.length,c=n.isMissing(e,n._videoElement.currentTime);if(c&&o<s)n._settings.checkForPlaybackStallsOnDemand?(i.state=v.appendedButDataMissing,n._events.raise("sessionStateChange",{state:g.missingSegmentDetected}),t(i)):u("sourceBufferAppendMissing","Buffer missing ".concat(n._streamInfo.mimeType," fragment at end-relative index ").concat(o));else{c&&(i.state=v.endOfStream);var d=(W.now()-n._startTime)/1e3;n._appendLength+=i.time.lengthSeconds,n.bufferRate.append(n._appendLength/d),t(i)}}},100)}function d(e,t){F("Append ".concat(e,": ").concat(n.streamType," ").concat(t.qualityId," ").concat(t.requestType," ").concat(void 0!==t.fragmentIndex?"index ".concat(t.fragmentIndex):""),n._settings)}function l(){if(!n._isDisposed){var e=r[0];n._events.off(o),e.timeAtAppended=W.now()-e.startTime,e.state=v.appended,e.clearDataAfterAppend&&(e.data=null),d("complete",e),r.shift(),c()}}function u(t,a){var r="error=".concat(a=a||""," (quality=").concat(i.qualityId+(void 0!==e?" index=".concat(e):""),")");i.state=v.error,n._isAppending=!1,F("Append exception: "+r),n._events.raise("sessionStateChange",{state:g.error,errorType:t,errorMessage:r})}!n._isAppending&&i&&i.state===v.downloaded?(n._isAppending=!0,i.state=v.appending,r.push(n._initSegments[i.qualityIndex]),r.push(i.activeRequest),c()):i&&i.state===v.endOfStream&&t(i)},e.prototype.getBufferRate=function(){return this.bufferRate.average||0},e.prototype.getActiveRequestCount=function(){return this.requestManager.getActiveRequestCount()},e.prototype.getAvgBandwidthInBps=function(){return 8*this.requestManager.bytesPerSeconds.average},e.prototype.getRequestStaggerTimeMs=function(){return Math.round(1e3*this._estimateDownloadSeconds(this.qualityIndex)*this._settings.requestStaggerTimeMultiple)},e.prototype.isMissing=function(e,t){return this.fragments[e].state===v.appended&&!this.isBuffered(e,t)},e.prototype.getFragmentByTimeSeconds=function(e){return this.fragments.find(function(t){return t.time.startSeconds<=e&&t.time.lengthSeconds+t.time.startSeconds>e})},e.prototype.getNextFragmentAfterTimeSeconds=function(e){return this.fragments.find(function(t){return t.time.startSeconds>e})},e.prototype.getLastSegmentDuration=function(){return this.fragments[this.fragments.length-1].time.lengthSeconds},e.prototype.isBuffered=function(e,t){var n=this.fragments[e];if(n){var a=this._buffer.buffered,i=n.time,r=i.startSeconds,o=i.lengthSeconds,s=r<.3,c=r+o+.3>=this._manifest.mediaDuration,d=Math.max(t,r+(s?.8:.15)),l=r+o-(c?.8:.15);try{for(var u=0;u<a.length;u++)if(a.start(u)<=d&&a.end(u)>=l)return!0}catch(e){return!0}}return!1},e.prototype.canLoad=function(e){return this.fragments[e].state<=v.idle},e.prototype.load=function(e,t,n,a,i){var r=this,o=this,s=o.fragments,c=s[e],d="media",l=function(t){for(var n=e+t,a=s.length;n<a;n++)s[n].state=v.endOfStream};if(c&&c.state<=v.idle){c.state=v.downloading,c.qualityIndex=isNaN(a)?o.qualityIndex:a,c.qualityId=this._streamInfo.qualities[c.qualityIndex].id,o._loadInitSegment(c.qualityIndex,t,e);var u=new U({url:o._getUrl(c),fragmentIndex:e,fragment:c,requestType:d,qualityIndex:c.qualityIndex,qualityId:c.qualityId,clearDataAfterAppend:!0,isArrayBuffer:!0,qualityIndexAttempted:n,currentRetryCount:i,onSuccess:function(e){o._isDisposed||("video"===o.streamType&&"media"===e.requestType&&o._videoSegmentsDownloadCount++,r._decryptResponseIfNeeded(e,function(){c.state=v.downloaded,e.hasStreamEnded&&l(1);var n=Math.round(e.timeAtLastByte-e.timeAtFirstByte),a=e.timeAtLastByte-n;F("Download complete: ".concat(e.qualityId," ").concat(e.requestType," index: ").concat(e.fragmentIndex," waiting: ").concat(a,"ms receiving: ").concat(n),o._settings),t()},function(e){var t;t=e,o._events.raise("sessionStateChange",{state:g.error,errorType:"segmentDecryptionError",errorMessage:N(t,r._settings)})}))},onError:function(n){if(!o._isDisposed)if(n.state===v.disconnected)c.state=v.idle,c.activeRequest=null,c.requests=[],o._events.raise("sessionStateChange",{state:g.disconnected,errorType:"mediaSegmentDownload",errorMessage:n.statusCode,httpStatus:n.httpStatus,correlationId:n.correlationId});else if((n.isTimedOut||n.isUnknownError)&&n.requestAttempt<o._settings.maxRetries){var a=n.qualityIndexAttempted;if(a&&a.length>0){var i=o._getNextQualityToTry(a);c.qualityIndex=i>=0?i:c.qualityIndex}c.state=v.idle,o.load(e,t,a,c.qualityIndex,n.requestAttempt)}else n.isAborted?(c.state=c.state===v.endOfStream?c.state:v.idle,c.activeRequest=null,c.requests=[]):(c.state=v.error,n.hasStreamEnded?l(0):o._events.raise("sessionStateChange",{state:g.error,errorType:"mediaSegmentDownload",errorMessage:n.statusCode,httpStatus:n.httpStatus,correlationId:n.correlationId}))},streamType:o.streamType},this._settings);c.activeRequest=u,c.requests.push(u),F("Download started: ".concat(c.qualityId," ").concat(d," index=").concat(e," time=").concat(W.now()-o._startTime,"ms stagger=").concat(o.getRequestStaggerTimeMs(),"ms"),o._settings);try{o.requestManager.start(u)}catch(e){o._events.raise("sessionStateChange",{state:g.error,errorType:"mediaSegmentDownload",errorMessage:o.requestManager.lastErroredReq.errorMessage,httpStatus:o.requestManager.lastErroredReq.httpStatus,correlationId:o.requestManager.lastErroredReq.correlationId,isBreakingTooManyRequestFlow:!0})}}},e.prototype.assessQuality=function(){var e=this,t=e._settings,n=e.requestManager.bytesPerSeconds.average,a=e._streamInfo,i=a.qualities.length-1;if(n?"video"===this.streamType&&this._storage.setItem(K,String(n)):n=parseFloat(this._storage.getItem(K)),t.isABREnabled&&n)if(t.isRBREnabled)e.qualityIndex=Math.round(Math.random()*i);else{for(var r=0,o="Quality check ".concat(e.streamType,": bps=").concat(Math.round(n)),s=a.timeline[0].lengthSeconds,c=.4*s,d=Math.min(i,t.abrLimitQuality&&t.abrLimitQuality[e.streamType]||i),l=0;l<=d;l++){var u=e._estimateDownloadSeconds(l,0);o+=" ".concat(l,"=").concat(u.toFixed(2),"s"),u+c<s&&(r=l)}e._async.throttle(function(){F(o,e._settings)},"assess",1e3),e.qualityIndex=r}else e.qualityIndex=Math.min(i,t.targetQuality[e.streamType])},e.prototype._getNextQualityToTry=function(e){var t=Math.min.apply(Math,e)-1;if(t<0){var n=Math.max.apply(Math,e)+1;return n<this._streamInfo.qualities.length?n:-1}return t},e.prototype._estimateDownloadSeconds=function(e,t){var n=this,a=n._streamInfo.qualities[e],i=n._streamInfo.timeline[t||0].lengthSeconds,r=a.bandwidth/8*i,o=n.requestManager.bytesPerSeconds.average;return o?"video"===this.streamType&&this._storage.setItem(K,String(o)):(o=parseFloat(this._storage.getItem(K)),this._settings.limitMaxDefaultbandwidth&&0===this._videoSegmentsDownloadCount&&(o=Math.min(o,n._settings.defaultBandwidth))),r/(o||n._settings.defaultBandwidth)},e.prototype._decryptResponseIfNeeded=function(e,t,n){this._decryptor&&(this._streamInfo.contentProtection||this._streamInfo.importedKey)&&-1!==e.requestUrl.indexOf("enableEncryption=1")&&!this._settings.NoEncryptionCDNPlayback?this._settings.isDecryptorV2Enabled?this._decryptor.decryptV2(e.data,this._streamInfo.contentProtection,this._streamInfo.contentProtection.iv,function(n){e.data=new Uint8Array(n),t()},function(e){n(e)}):this._decryptor.decrypt(e.data,this._streamInfo.importedKey,this._streamInfo.contentProtection.iv,function(n){e.data=new Uint8Array(n),t()},function(e){n(e)}):t()},e.prototype._loadInitSegment=function(e,t,n){var a=this,i=this,r=i._streamInfo.qualities[e].id,o="init";if(!i._initSegments[e]){var s=i._initSegments[e]=new U({url:this._getInitUrl(e),requestType:o,qualityIndex:e,qualityId:r,isArrayBuffer:!0,onSuccess:function(e){i._isDisposed||a._decryptResponseIfNeeded(e,function(){e.state=v.downloaded,F("Download complete : ".concat(i.streamType," ").concat(e.qualityId," ").concat(e.requestType),i._settings),t(e)},function(e){var t;t=e,i._events.raise("sessionStateChange",{state:g.error,errorType:"segmentDecryptionError",errorMessage:N(t,a._settings)})})},onError:function(t){i._isDisposed||(t.state===v.disconnected?(i._initSegments[e]=void 0,i._events.raise("sessionStateChange",{state:g.disconnected,errorType:"initSegmentDownload",errorMessage:t.statusCode,httpStatus:t.httpStatus,correlationId:t.correlationId})):t.isAborted?i._initSegments[e]=void 0:(t.state=v.error,i._events.raise("sessionStateChange",{state:g.error,errorType:"initSegmentDownload",errorMessage:t.statusCode,httpStatus:t.httpStatus,correlationId:t.correlationId})))},streamType:i.streamType},this._settings);F("Download started: ".concat(i.streamType," ").concat(r," ").concat(o),i._settings);try{i._initRequestManager.start(s)}catch(e){i._events.raise("sessionStateChange",{state:g.error,errorType:"initSegmentDownload",errorMessage:i._initRequestManager.lastErroredReq.errorMessage,httpStatus:i._initRequestManager.lastErroredReq.httpStatus,correlationId:i._initRequestManager.lastErroredReq.correlationId,isBreakingTooManyRequestFlow:!0})}}},e.prototype._getInitUrl=function(e){var t=this._streamInfo.initUrlFormat.replace("$RepresentationID$",this._streamInfo.qualities[e].id);return this._manifest.baseUrl+t},e.prototype._getUrl=function(e){var t=this._streamInfo.fragUrlFormat.replace("$RepresentationID$",e.qualityId).replace("$Time$","".concat(e.time.start));return this._manifest.baseUrl+t},e}(),Q=.5,Y="audio",J=performance&&performance.now?performance:Date;!function(e){e[e.closed=0]="closed",e[e.open=1]="open",e[e.ended=2]="ended"}(z||(z={}));var X=function(){function e(e,t,n,a){if(this._events=new C.e(this),this._async=new A(this),this._mediaSource=t,this._settings=n,this._bufferRate=new L(3),this._appendedSeconds=0,this._requestTimerIds=[0,0],this.streams=[],this._appendIndex=0,this._nextRequestTimerId=0,this._seekingTimerId=0,this.stalls=0,this._lastCurrentTime=0,this._lastTimeBeforeSeek=0,this._startTime=0,this._videoElement=e,this._playbackMonitorId=0,this._canPlay=!0,this._timeAtStall=0,this._isDisposed=!1,this._decryptor=a,this._healthCheckLastTime=0,this._intializeVideoElement(),this._initializeStreams(e,t,n),this.streams.length&&n&&n.startTime){var i=this.streams[0],r=i.fragments[0].time.lengthSeconds;this._appendIndex=Math.max(0,Math.min(i.fragments.length-1,Math.floor((n.startTime-Q)/r)))}}return e.prototype.dispose=function(){var e=this;if(!e._isDisposed){e._isDisposed=!0,e._adjustPlaybackMonitor(!1),e._events.dispose(),e._async.dispose();for(var t=0;e.streams&&t<e.streams.length;t++)e.streams[t].dispose();e._videoElement=null,e._mediaSource=null,e._decryptor=null}},e.prototype.start=function(){this._startTime=J.now(),this._setCanPlay(!1),this._loadNextFragment(),this._adjustPlaybackMonitor(!0)},e.prototype.getAvgBandwidthInBps=function(){if(!this._isDisposed)for(var e=0,t=this.streams;e<t.length;e++){var n=t[e];if("video"===n.streamType)return n.getAvgBandwidthInBps()}},e.prototype.getPlayingQuality=function(e){if(!this._isDisposed)for(var t=0,n=this.streams;t<n.length;t++){var a=n[t];if(a.streamType===e){var i=this._videoElement.currentTime,r=Math.min(a.fragments.length-1,Math.floor(i/a.fragments[0].time.lengthSeconds)),o=a.fragments[r].qualityIndex;return o>=0?o:a.qualityIndex}}return 0},e.prototype.getBufferingQuality=function(e){if(!this._isDisposed)for(var t=0,n=this.streams;t<n.length;t++){var a=n[t];if(a.streamType===e)return a.qualityIndex}return 0},e.prototype.getInitialPlaybackQuality=function(){if(!this._isDisposed)for(var e=0,t=this.streams;e<t.length;e++){var n=t[e];if("video"===n.streamType&&n.fragments.length>0)return n.fragments[0].qualityId}return null},e.prototype.getBufferRate=function(){return this._bufferRate.average},e.prototype.getRemainingBuffer=function(e){var t=this,n=0;if(!t._isDisposed){var a=(t._settings.startTime||t._videoElement.currentTime)+(e||0),i=t._videoElement.buffered;!a&&i.length>0&&i.start(0)<1&&(a=i.start(0));for(var r=0;r<i.length;r++)if(a>=i.start(r)&&a<=i.end(r)){for(var o=i.end(r);++r<i.length&&i.start(r)-o<.06;)o=i.end(r);n=o-a;break}}return n},e.prototype.getTimeUntilUnderrun=function(e){var t=Number.MAX_VALUE,n=this;if(!n._isDisposed){var a=n._settings.startTime||Math.max(.5,n._videoElement.currentTime),i=n._settings.manifest.mediaDuration-a-.5,r=this.getRemainingBuffer(e),o=this.getBufferRate(),s=Math.min(1,Math.max(0,r/this._settings.safeBufferSeconds));i>r&&(t=r+s*(r*o))>Math.min(i,.5*n._settings.maxBufferSeconds)&&(t=Number.MAX_VALUE)}return t},e.prototype.reset=function(e){this._onThrottledSeek(!0,e)},e.prototype._intializeVideoElement=function(){var e=this,t=this._videoElement;t&&this._events.onAll(t,{seeking:e._onVideoSeeking,error:e._onVideoError,play:e._onPauseStateChange,pause:e._onPauseStateChange,playing:function(){e._onPlayingStateChange(!0)},waiting:function(){e._onPlayingStateChange(!1)},ended:e._onVideoEnded,ratechange:e._onVideoRateChange})},e.prototype._initializeStreams=function(e,t,n){var a=n&&n.manifest&&n.manifest.streams||null,i=[];a&&(a.audio&&i.push(new q("audio",t,e,n,this._decryptor)),a.video&&i.push(new q("video",t,e,n,this._decryptor))),this.streams=i;for(var r=this._events,o=function(e){r.raise("sessionStateChange",e)},s=0,c=i;s<c.length;s++){var d=c[s];r.on(d,"sessionStateChange",o),d.initialize()}},e.prototype._loadNextFragment=function(){var e=this;if(!e._isDisposed){for(var t=function(t,n){if(!e._isDisposed){var a=e._requestTimerIds;a[t]&&e._async.clearTimeout(a[t]),a[t]=e._async.setTimeout(function(){a[t]=0,e._loadNextFragment()},n)}},n=e._getDownloadCandidates(),a=0;a<n.downloads.length;a++)for(var i=n.downloads[a],r=e.streams[a],o=0;o<i.length;o++){var s=i[o],c=r.fragments[s-1],d=c&&c.activeRequest,l=d&&d.state===v.downloading?d:null,u=r.getRequestStaggerTimeMs(),f=l?J.now()-l.startTime:0;if(l&&!(f>=u)){t(a,u-f);break}r.load(s,function(){e._appendNextFragment()})}n.isAtMax&&t(0,300)}},e.prototype._appendNextFragment=function(){var e,t,n=this,a=n.streams;if(!n._isDisposed){var i=n._settings.startTime||n._videoElement.currentTime,r=n._mediaSource;if(a&&a.length&&r&&!Z(r.readyState,z.closed)){for(;n._appendIndex<a[0].fragments.length;){var o=!0,s=!0;for(t=0;t<a.length;t++){e=a[t],o=o&&(e.canAppend(n._appendIndex)||e.isAppended(n._appendIndex));var c=e.fragments[n._appendIndex].state;s=this._settings.checkForPlaybackStallsOnDemand?s&&(c===v.appended||c===v.appendedButDataMissing||c===v.endOfStream):s&&(c===v.appended&&!e.isMissing(n._appendIndex,i)||c===v.endOfStream)}if(o)for(t=0;t<a.length;t++)(e=a[t]).isAppended(n._appendIndex)||e.append(n._appendIndex,function(){n._appendNextFragment()}),c=e.fragments[n._appendIndex].state,s=s&&(c===v.appended||c===v.appendedButDataMissing||c===v.endOfStream);if(!s)break;var d=n.streams[0].fragments[n._appendIndex];if(!d.activeRequest.hasUpdatedBufferRate){d.activeRequest.hasUpdatedBufferRate=!0,n._appendedSeconds+=d.time.lengthSeconds;var l=(J.now()-n._startTime)/1e3;n._bufferRate.append(n._appendedSeconds/(l||.1))}if(n._appendIndex++,n._settings.startTime)try{n._videoElement.currentTime=n._settings.startTime,n._settings.startTime=0}catch(e){}n._checkCanPlay()}n._appendIndex===a[0].fragments.length&&Z(r.readyState,z.open)&&r.endOfStream(),n._loadNextFragment()}}},e.prototype._adjustPlaybackMonitor=function(e){var t=this;!e&&t._playbackMonitorId?(t._async.clearTimeout(t._playbackMonitorId),t._playbackMonitorId=0):e&&!t._playbackMonitorId&&(t._playbackMonitorId=t._async.setInterval(function(){t._checkCanPlay()},200))},e.prototype._checkCanPlay=function(){var e=this,t=e.getTimeUntilUnderrun(),n=e._videoElement,a=e._lastCurrentTime=n.currentTime;e._canPlay&&t<.1&&!e._timeAtStall&&(e._timeAtStall=e._lastCurrentTime,e._async.setTimeout(function(){var t=e._timeAtStall;e._timeAtStall=0,e._isDisposed||n.currentTime!==t||(e.stalls++,e._setCanPlay(!1))},200)),e._canPlay||(t>e.streams[0].fragments[0].time.lengthSeconds&&e.getBufferRate()>1||t>e._settings.safeBufferSeconds?e._setCanPlay(!0):e.getTimeUntilUnderrun(.5)>e._settings.safeBufferSeconds&&(n.currentTime=Math.min(a+.5,n.duration),e._setCanPlay(!0))),e._events.raise("sessionStateChange",{state:e._canPlay?e._videoElement.paused?g.paused:g.playing:g.buffering}),e._settings.publishEventInfo&&e._decryptor&&e._decryptor.state===B.CRYPTO_INITIALIZED&&e._canPlay&&e._settings.publishEventInfo({hmacInfoState:"APPLY"})},e.prototype._getDownloadCandidates=function(){var e=this,t=e._getCurrentFragmentRange(),n=[],a=0;if(t.start>-1){e._ensureStreamsUpdated(t);var i=e._getMissingFragmentIndex(t);if(i>=0){t.start=Math.max(t.start,i);for(var r=0;r<e.streams.length;r++){var o=e.streams[r],s=e._getDownloadableIndexes(o,t);n.push(s),a+=s.length}}}return{downloads:n,isAtMax:!a&&t.end>=0&&t.end<e.streams[0].fragments.length-1}},e.prototype._getCurrentFragmentRange=function(){var e=this,t=e._videoElement,n=e._settings.manifest.mediaDuration;if(n>0){var a=e._settings.startTime||t.currentTime,i=a+.005>=n,r=e.streams[0],o=r.fragments.length,s=r.fragments[0].time.lengthSeconds;if(!i)return a>Q&&(a-=Q),{start:Math.max(0,Math.min(o-1,Math.floor(a/s))),end:Math.max(0,Math.min(o-1,Math.ceil((a+e._settings.maxBufferSeconds)/s)))}}return{start:-1,end:-1}},e.prototype._ensureStreamsUpdated=function(e){for(var t=this,n=t._videoElement.currentTime,a=0,i=t.streams;a<i.length;a++){var r=i[a];if(r.assessQuality(),!this._settings.checkForPlaybackStallsOnDemand)for(var o=e.start;o<=e.end;o++)if(r.isMissing(o,n)){var s=r.fragments[o];F("Missing fragment reset: stream=".concat(r.streamType,"index=").concat(o," [").concat(s.time.startSeconds,"]"),t._settings),r.fragments[o].state=v.idle}}},e.prototype._getMissingFragmentIndex=function(e){for(var t=e.start;t<=e.end;t++)for(var n=0,a=this.streams;n<a.length;n++)if(a[n].fragments[t].state<=v.idle)return t;return-1},e.prototype._getDownloadableIndexes=function(e,t){for(var n=[],a=Math.min(t.end,t.start+this._settings.maxSegmentLeadCount[e.streamType]),i=this._settings.maxConcurrentRequests[e.streamType]-e.getActiveRequestCount(),r=t.start;n.length<i&&r<=a;r++)e.fragments[r].state<=v.idle&&n.push(r);return n},e.prototype._setCanPlay=function(e){this._canPlay!==e&&(this._canPlay=e,this._onVideoRateChange())},e.prototype._onVideoSeeking=function(){this._lastTimeBeforeSeek||(this._lastTimeBeforeSeek=this._lastCurrentTime),this._seekingTimerId&&this._async.clearTimeout(this._seekingTimerId),this._setCanPlay(!1),this._settings.startTime=0,this._seekingTimerId=this._async.setTimeout(this._onThrottledSeek,300),this._onPlayingStateChange(!1)},e.prototype._onThrottledSeek=function(e,t){var n=this;if(!n._isDisposed){var a=n._videoElement.currentTime,i=Math.floor(Math.max(0,a-Q)/n.streams[0].fragments[0].time.lengthSeconds),r=n._videoElement.buffered,o=!1;if(this._settings.checkForPlaybackStallsOnDemand)for(var s=n._videoElement.buffered,c=0;c<s.length;c++)if(s.start(c)<=a&&s.end(c)>a){o=!0;break}var d=!1;this._settings.checkForPlaybackStallsOnDemand&&(d=this.streams.some(function(e){return e.fragments[i].state===v.appendedButDataMissing}));var l=o||d||1===r.length&&r.start(0)<=Math.max(0,a-2)&&r.end(0)>a;F("Throttled seek: "+n._videoElement.currentTime,n._settings),n._seekingTimerId=0,n._lastTimeBeforeSeek=0,n._async.clearTimeout(n._nextRequestTimerId),n._nextRequestTimerId=0;var u=e||n._appendIndex<i,f=e||n._settings.manifest.mediaDuration>n._settings.maxBufferSeconds&&!l;n._appendIndex=i,F("Clearing buffer",n._settings);for(var p=0,m=n.streams;p<m.length;p++){var _=m[p];u&&(t?_.streamType===Y&&_.abortAll():_.abortAll()),f&&(t?_.streamType===Y&&_.clearBuffer():_.clearBuffer())}this._timeAtLastSeek=J.now(),n._appendNextFragment()}},e.prototype._onPlayingStateChange=function(e){var t=this;this._settings.checkForPlaybackStallsOnDemand&&(this._async.clearTimeout(this._stallCheckTimer),e||(this._stallCheckTimer=this._async.setTimeout(function(){t._checkPlaybackHealth(!1)},1e3)))},e.prototype._checkPlaybackHealth=function(e){if(!this._isDisposed){var t=J.now()-this._timeAtLastSeek<3e3,n=!e||this._healthCheckLastTime===this._videoElement.currentTime,a=1e3;if(!this._videoElement.paused&&!this._videoElement.ended&&(!this._videoElement.seeking||!t)&&n){var i=this._videoElement.currentTime+.5;if(!this.streams.some(function(e){var t=e.getFragmentByTimeSeconds(i);return t&&t.state!==v.appended&&t.state!==v.appendedButDataMissing})){this._events.raise("sessionStateChange",{state:g.playerStallDetected});for(var r=this._videoElement.buffered,o=!1,s=0;s<r.length;s++)if(r.start(s)<=i&&r.end(s)>i){o=!0;break}if(o)this._videoElement.currentTime=i,a*=2;else{var c=!1;for(s=0;s<r.length;s++)if(r.start(s)>=i){this._videoElement.currentTime=r.start(s),a*=2,c=!0;break}if(!c&&!this.streams.some(function(e){var t=e.getNextFragmentAfterTimeSeconds(i);return!t||t.state!==v.appended&&t.state!==v.appendedButDataMissing})){var d=this._videoElement.duration-i,l=0;for(s=0;s<this.streams.length;s++){var u=this.streams[s].getLastSegmentDuration();u>l&&(l=u)}d<l&&(this._videoElement.currentTime=i,a*=2)}}}}this._healthCheckLastTime=this._videoElement.currentTime,this._stallCheckTimer=this._async.setTimeout(this._checkPlaybackHealth,a)}},e.prototype._onVideoError=function(){var e,t;this._events.raise("sessionStateChange",{state:g.error,errorType:"videoElementError",errorMessage:(e=this._videoElement,t=e.error,t?y[t.code]||String(t.code):"")})},e.prototype._onPauseStateChange=function(){this._adjustPlaybackMonitor(!this._videoElement.paused),this._checkCanPlay()},e.prototype._onVideoEnded=function(){this._events.raise("sessionStateChange",{state:g.paused})},e.prototype._onVideoRateChange=function(){var e=this._canPlay?1:0,t=this._videoElement;t.playbackRate!==e&&(t.playbackRate=t.defaultPlaybackRate=e)},e}();function Z(e,t){return e===t||e===z[t]}function $(e){var t=e.querySelector("ContentProtection"),n={schemeIdUri:"",keyUri:"",iv:void 0,keySystemUri:""};if(t){var a=t.querySelector("SegmentEncryption"),i=t.querySelector("KeySystem"),r=t.querySelector("CryptoPeriod");return n.schemeIdUri=a.getAttribute("schemeIdUri"),n.keyUri=r.getAttribute("keyUriTemplate"),n.iv=function(e){void 0===e&&(e="");var t=e,n=t.substr(2);t.length%2!=0&&(n="0"+n);for(var a=new Uint8Array(n.length/2),i=0;i<n.length;i+=2){var r=parseInt(n.substr(i,2),16);if(isNaN(r))throw new Error("Invalid hexString");a[i/2]=r}return a}(r.getAttribute("IV")),n.keySystemUri=i.getAttribute("keySystemUri"),n}return null}function ee(e,t){return e.getAttribute(t)}var te,ne=performance&&performance.now?performance:Date,ae=function(){function e(e){this._parseIndex=0,this._settings=e,this._requestManager=new M(e)}return e.prototype.dispose=function(){this._requestManager&&(this._requestManager.dispose(),this._requestManager=null)},e.prototype.parse=function(e,t,n){var a=this,r=++this._parseIndex,o=new U({url:e,requestType:"manifest",onSuccess:function(e){if(a._parseIndex===r)try{var o=ne.now(),s=function(e,t){return Object(i.__assign)(Object(i.__assign)({},function(e,t){for(var n=(new DOMParser).parseFromString(e,"text/xml"),a=t.baseUrlOverride||function(e,t,n){var a=e.getElementsByTagName("BaseURL")[0],i=a&&a.childNodes[0];return i?i.nodeValue:""}(n),i=(w=void 0,E=void 0,A=void 0,w=0,(A=(E=ee(n.documentElement,"mediaPresentationDuration").slice(2)).indexOf("H"))>-1&&(w+=60*Number(E.slice(0,A))*60,E=E.slice(A+1)),(A=E.indexOf("M"))>-1&&(w+=60*Number(E.slice(0,A)),E=E.slice(A+1)),(A=E.indexOf("S"))>-1&&(w+=Number(E.slice(0,A))),w),r={},o=n.querySelectorAll("AdaptationSet"),s=0;s<o.length;s++){var c=o[s];if(c){var d=$(c),l=c.querySelectorAll("S");if(!l||!l.length)throw"Missing timeline";for(var u=ee(c,"contentType"),f=c.querySelectorAll("Representation"),p=c.querySelector("SegmentTemplate"),m=Number(ee(p,"timescale")),_=[],h=[],b=0;b<f.length;b++){var g=f[b],v=ee(g,"height"),y={id:ee(g,"id"),bandwidth:Number(ee(g,"bandwidth")),width:v&&Number(ee(g,"width"))||0,height:v&&Number(v)||0};_.push(y)}for(var S=0,D=0;D<l.length;D++)for(var I=l[D],x=Number(ee(I,"r"))||0,C=Number(ee(I,"d")),O=0;O<=x;O++)h.push({start:S,startSeconds:S/m,length:C,lengthSeconds:C/m}),S+=C;r[u]={streamType:u,mimeType:ee(c,"mimeType"),codecs:ee(c,"codecs"),initUrlFormat:ee(p,"initialization"),fragUrlFormat:ee(p,"media"),qualities:_,timeline:h},d&&(r[u].contentProtection={schemeIdUri:d.schemeIdUri,keyUri:d.keyUri,iv:d.iv,keySystemUri:d.keySystemUri})}}var w,E,A;return{baseUrl:a,mediaDuration:i,streams:r}}(e.data,t)),{request:e})}(e,a._settings),c=ne.now()-o;a._settings.publishOperationStats&&a._settings.publishOperationStats({operationName:"manifestParse",processingTimeMs:c}),t(s)}catch(t){"object"==typeof t&&(t.data="".concat(e.data)),n("manifestParse",t,e.httpStatus,e.correlationId)}},onError:function(e){a._parseIndex===r&&n(e.state===v.disconnected?"networkDisconnected":"manifestDownload",e.statusCode,e.httpStatus,e.correlationId)}},this._settings);this._requestManager.start(o)},e}(),ie=0,re=performance&&performance.now?performance:Date,oe=function(){function e(e){this.isDisposed=!1,this.settings=Object(i.__assign)(Object(i.__assign)({},x),e||{}),this._events=new C.e(this),this.reset()}return e.supportsDecryption=function(){return!(!(e=window).crypto&&!e.msCrypto);var e},e.prototype.dispose=function(){this.isDisposed||(this.isDisposed=!0,this._events.dispose(),this.reset(),this._decryptor&&this._decryptor.dispose())},e.prototype.load=function(e,t){this.reset(),this._sessionIndex=++ie,this.startTime=re.now(),this._setState(g.initializing),this.videoElement=e,this._initializeManifest(t)},e.prototype.getAvgBandwidthInBps=function(){return this.streamController?this.streamController.getAvgBandwidthInBps():void 0},e.prototype.reset=function(){if(this.timeAtFirstCanPlay=null,this.startTime=null,this.lastError=null,this.initialPlaybackQuality=null,this.streamController&&this.streamController.dispose(),this.streamController=null,this._parser&&this._parser.dispose(),this._parser=null,this.videoElement){this.settings.manifest=null;try{this.videoElement.pause()}catch(e){}}this.videoElement=null,this._mediaSource=null,this._setState(g.idle)},e.prototype.resetStreams=function(e){this.streamController&&this.streamController.reset(e)},e.prototype.getRemainingBuffer=function(){return this.streamController?this.streamController.getRemainingBuffer():0},e.prototype.getBufferRate=function(){return this.streamController?this.streamController.getBufferRate():0},e.prototype.getPlayingQuality=function(e){return this.streamController?this.streamController.getPlayingQuality(e):this.settings.targetQuality[e]},e.prototype.getBufferingQuality=function(e){return this.streamController?this.streamController.getBufferingQuality(e):this.settings.targetQuality[e]},e.prototype.getMaxQuality=function(e){var t=this.settings.manifest?this.settings.manifest.streams[e]:null;return t?t.qualities.length-1:0},e.prototype.getInitialPlaybackQuality=function(){return this.initialPlaybackQuality||(this.initialPlaybackQuality=this.streamController.getInitialPlaybackQuality()),this.initialPlaybackQuality},e.prototype._setState=function(e,t,n,a,i,r){if(!this.isDisposed&&this.state!==e&&(this.state=e,this.lastErrorType=t,this.lastErrorMessage=n,this.lastHttpStatus=a,this.lastCorrelationId=i,this.lastIsBreakingTooManyRequestFlow=r,this.lastError=t?"".concat(t," ").concat(n?"(".concat(n,")"):""):null,e===g.error&&this.streamController&&this.streamController.dispose(),this.timeAtFirstCanPlay||e!==g.playing&&e!==g.paused||(this.timeAtFirstCanPlay=re.now()-this.startTime),this._events.raise("sessionStateChange",{state:e,errorType:t,errorMessage:n,httpStatus:a}),this.videoElement))switch(e){case g.initializing:this.settings.manifest||C.e.raise(this.videoElement,"sourceset",null);break;case g.buffering:C.e.raise(this.videoElement,"waiting",null);break;case g.aeskeyfetched:C.e.raise(this.videoElement,"aeskeyfetched",null);break;case g.manifestFetched:C.e.raise(this.videoElement,"manifestfetched",null);break;case g.playing:C.e.raise(this.videoElement,"playing",null);break;case g.missingSegmentDetected:C.e.raise(this.videoElement,"missingsegmentdetected",null);break;case g.mediaSourceInitStarted:C.e.raise(this.videoElement,"mediasourceinitstarted",null);break;case g.mediaSourceInitialized:C.e.raise(this.videoElement,"mediasourceinitialized",null);break;case g.playerStallDetected:C.e.raise(this.videoElement,"playerstalldetected",null);break;case g.error:case g.disconnected:C.e.raise(this.videoElement,"error",null)}},e.prototype._initializeMediaSource=function(e){var t=this,n=t._sessionIndex;try{var a=new MediaSource,i=function(){a.removeEventListener("sourceopen",i),t._sessionIndex===n&&(t._mediaSource=a,t._setState(g.mediaSourceInitialized),t._tryStart())};t._setState(g.mediaSourceInitStarted),a.addEventListener("sourceopen",i,!1),e.src=URL.createObjectURL(a)}catch(e){t._setState(g.error,"mediaSourceInit",e.message)}},e.prototype._isDataEncrypted=function(){var e=this.settings&&this.settings.manifest&&this.settings.manifest.streams?this.settings.manifest.streams:null;if(e)for(var t=0,n=Object.values(e);t<n.length;t++){var a=n[t];if(a.contentProtection&&a.contentProtection.keySystemUri)return!0}return!1},e.prototype._initializeManifest=function(e){var t=this,n=this._sessionIndex,a=function(e){t._sessionIndex===n&&t.state!==g.error&&(t.settings.manifest=e,t._setState(g.manifestFetched),t._isDataEncrypted()?t._initializeDecryptor():(t.settings.publishTelemetryInfo&&t.settings.publishTelemetryInfo({isNoEncryptionCDNPlayback:t.settings.NoEncryptionCDNPlayback,isServerSideFallback:!t.settings.NoEncryptionCDNPlayback}),t._initializeMediaSource(t.videoElement)))};this.settings.manifest?a(this.settings.manifest):(this._parser=new ae(this.settings)).parse(e,a,function(e,a,i,r){t._sessionIndex===n&&t._setState("networkDisconnected"===e?g.disconnected:g.error,e,a,i,r)})},e.prototype._initializeDecryptor=function(){var e=this,t=this.settings&&this.settings.manifest&&this.settings.manifest.streams?this.settings.manifest.streams:null,n=function(t){switch(t.step){case"keyfetch":e._setState(g.error,"aesKeyFetchError",t.request.statusCode,t.request.httpStatus,t.request.correlationId);break;case"init":e._setState(g.error,"webcryptoInitError",N(t,e.settings))}},a=function(e,n){for(var a=!1,r=0,o=Object.values(t);r<o.length;r++){var s=o[r];s.contentProtection&&s.contentProtection.keySystemUri===n.keySystemUri&&s.contentProtection.keyUri===n.keyUri&&!s.importedKey&&(s.importedKey=e,a=!0)}a&&i()},i=function(){for(var n=0,a=Object.values(t);n<a.length;n++){var i=a[n];if(i.contentProtection&&!i.importedKey)return}e._initializeMediaSource(e.videoElement)},r=!1;if(t){var o=[];try{for(var s=function(t){t.contentProtection&&t.contentProtection.keyUri&&(o&&o.some(function(e){return e.keyUri===t.contentProtection.keyUri})||(c._decryptor||(c._decryptor=new G(c.settings),c._events.on(c._decryptor,"sessionStateChange",function(t){e._setState(t.state,t.errorType,t.errorMessage,t.httpStatus,t.correlationId)})),c.settings.isDecryptorV2Enabled?c._decryptor.initV2(t.contentProtection,n):(r=!0,c._decryptor.init(t.contentProtection,a,n)),o.push(t.contentProtection)))},c=this,d=0,l=Object.values(t);d<l.length;d++)s(l[d])}catch(e){return void this._setState(g.error,"webcryptoInitError")}r||this._initializeMediaSource(this.videoElement)}},e.prototype._tryStart=function(){var e=this,t=this._mediaSource,n=this.videoElement,a=this.settings;if(!this.isDisposed&&this.state!==g.error&&t&&n&&a.manifest){t.duration=a.manifest.mediaDuration;var i=new X(n,t,a,this._decryptor);this.streamController=i,this._events.on(i,"sessionStateChange",function(t){e._setState(t.state,t.errorType,t.errorMessage,t.httpStatus,t.correlationId,t.isBreakingTooManyRequestFlow)}),i.start()}},e}(),se=n(2297),ce=n(60),de=n(61),le=n(1134),ue=n(10),fe=n(68),pe=n(16),me=n(128),_e=performance&&performance.now?performance:Date,he=function(){function e(e){this._previousActiveCueIndex=0,this._videoItem=e.item.peek(),this._context=e}return e.prototype.fetchAndParseCaptions=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,t;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return this._captionCues?[3,4]:(e=_e.now(),[4,this._context.getVideoItemDataSource().fetchVTTCaptions(this._videoItem)]);case 1:return t=n.sent(),this._context.vttFetchTimeMS=_e.now()-e,t?t.data?[4,this._parseVTTCaptions(t.data)]:[3,3]:[3,4];case 2:return n.sent(),[3,4];case 3:t.error&&(this._context.vttFetchError=t.error),n.label=4;case 4:return[2,this._captionCues&&this._captionCues.length>0]}})})},e.prototype.getCaptionsEndpoint=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return[4,this._context.getVideoItemDataSource().getCaptionsSrcUrl(this._videoItem)];case 1:return[2,e.sent()]}})})},e.prototype.getActiveCues=function(e){var t=[];if(this._captionCues){this._captionCues[this._previousActiveCueIndex].startTime>e&&(this._previousActiveCueIndex=0);for(var n=this._previousActiveCueIndex;n<this._captionCues.length;n++){var a=this._captionCues[n];if(this._isActiveCue(e,a)&&(t.length||(this._previousActiveCueIndex=n),t.push(new VTTCue(a.startTime,a.endTime,a.text))),e<a.startTime)break}}return t},e.prototype.getWebVTT=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(t){switch(t.label){case 0:return this.WebVTT?[3,2]:(e=this,[4,n.e(564).then(n.t.bind(null,4480,7))]);case 1:e.WebVTT=t.sent().WebVTT,t.label=2;case 2:return[2,this.WebVTT]}})})},e.prototype._isActiveCue=function(e,t){return t.startTime<=e&&e<t.endTime||t.startTime===t.endTime&&t.startTime<=e&&t.startTime+.5>e},e.prototype._parseVTTCaptions=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,n,a,r;return Object(i.__generator)(this,function(i){switch(i.label){case 0:t=new me.e({name:"Video.ParseCaptions"}),this._captionCues=[],i.label=1;case 1:return i.trys.push([1,3,,4]),[4,this.getWebVTT()];case 2:return n=i.sent(),(a=new n.Parser(window,n.StringDecoder())).oncue=function(e){this._captionCues.push(e)}.bind(this),a.onparsingerror=function(e){this._context.vttParseError=e.name,t.end({resultType:c.e.Failure,error:e.name,extraData:{vttJsErrorCode:e.code}})}.bind(this),a.onflush=function(){t.end({resultType:c.e.Success}),this._context.vttParseTimeMS=t.endTime-t.startTime}.bind(this),a.parse(e),a.flush(),[3,4];case 3:return r=i.sent(),t.end({resultType:c.e.Failure,error:r.name}),[3,4];case 4:return[2]}})})},e}(),be=n(101),ge=["sourceset","loadstart","loadedmetadata","canplaythrough","canplay","aeskeyfetched","error","waiting","pause","playing","ended","timeupdate","missingsegmentdetected","manifestfetched","mediasourceinitstarted","mediasourceinitialized","playerstalldetected"],ve=["audioEnhancementEnabled","audioEnhancementDisabled","onLoadRequestFailure"];!function(e){e.None="None",e.FFMPEG="FFMPEG",e.MediaFoundation="Media Foundation"}(te||(te={}));var ye,Se,De,Ie=n(130),xe="video",Ce="cs",Oe="OneUpWebPlayer",we="metaQsp_",Ee=["provider","docid","format","part","quality","access_token","tempauth","correlationid",Ce,"si","ci","action","ctag"],Ae=performance&&performance.now?performance:Date;!function(e){e[e.MEDIA_ERR_ABORTED=1]="MEDIA_ERR_ABORTED",e[e.MEDIA_ERR_NETWORK=2]="MEDIA_ERR_NETWORK",e[e.MEDIA_ERR_DECODE=3]="MEDIA_ERR_DECODE",e[e.MEDIA_ERR_SRC_NOT_SUPPORTED=4]="MEDIA_ERR_SRC_NOT_SUPPORTED"}(ye||(ye={})),function(e){e[e.TeamsMeetingRecording=1]="TeamsMeetingRecording",e[e.Others=2]="Others"}(Se||(Se={})),function(e){e.ALT_TRANSCODE="altManifestMetadata",e.MEDIAFOUNDATION="manifestMetadata"}(De||(De={}));var Le=window.VTTCue||window.TextTrackCue,ke=pe.e.isActivated("126A864D-B398-485B-AD70-D7388DE7BA53","10/21/2021","Change video auth"),Me=pe.e.isActivated("1FC54222-CEEA-4F72-9248-AE31ED54131D","10/21/2021","Video basic connectivity test"),Pe=0;function Te(e,t){return(e&&e.streams&&e.streams[t]&&e.streams[t].qualities||[]).map(function(e){var t=e.id,n=void 0===t?"":t;return Object(ue.isFeatureEnabled)(ue.VideoParseResolutionFromAdaptationSetHeight)&&e&&e.height&&!isNaN(e.height)?e.height:parseInt(/\D*(\d+)p/.exec(n)[1],10)}).filter(function(e){return!!e})}var Ue=function(e){function t(t){var n=e.call(this,t)||this;n._retryCount=0,n.controlsDescendantBindings=!0;var a=n.observables,i=n._context=n.valueAccessor();return n._errors={},n._platformDetection=new Ie.e,n.subscribe(i.url,n._onUrlChanged),a.backgroundCompute(n._computeVolume),a.backgroundCompute(n._computeIsMuted),n.subscribe(i.seekPercentage,n.async.debounce(n._onSeekPercentageChanged,100)),n.subscribe(i.isScrubbing,n._onIsScrubbingChanged),n.subscribe(i.desiredQuality,n._onDesiredQualityChanged),n.subscribe(i.isABREnabled,n._onIsABREnabledChanged),n.subscribe(i.isPlaying,n._onIsPlayingChanged),n.subscribe(i.isRefreshingToken,n._onIsRefreshingToken),n._onUrlChanged(i.url()),n._onIsPlayingChanged(i.isPlaying.peek()),n}return Object(i.__extends)(t,e),t.prototype.dispose=function(){this._disposeVideo(),e.prototype.dispose.call(this)},t.prototype._disposeVideo=function(){this._dashling&&(this._context.dashling(null),this._dashling.dispose(),this._dashling=null),this._context.correlationId("");var e=this._videoElement,t=this._errorTrack;if(t&&(this.events.off(t),this._errorTrack=void 0),this._errors={},e){this.events.off(e);try{e.pause(),this.element.removeChild(e)}catch(e){}this._videoElement=void 0}},t.prototype._onErrorChange=function(){var e=this._errorTrack,t=e&&e.activeCues,n=t&&t[0];if(n){var a=this._errors[n.id];this._context.setVideoStatus(a)}},t.prototype._onUrlChanged=function(e){var t,n=this;if(this._videoElement){var a=this._videoElement.currentTime;t=Number(a.toFixed(5))}if(this._disposeVideo(),e){var i=this._videoElement=document.createElement("video");this.events.onAll(i,{loadstart:this._handleLoadStart,canplay:this._handleCanPlay,canplaythrough:this._handleCanPlayThrough,error:this._handleVideoElementError,ended:this._handleEnded,volumechange:this._handleVolumeChanged,play:this._handlePlay,pause:this._handlePause,waiting:this._handleWaiting,playing:this._handlePlaying,durationchange:this._handleBufferChange,ratechange:this._handleRateChange,timeupdate:this._handleBufferChange,progress:this._handleBufferChange});var r=["error","audioEnhancementEnabled","audioEnhancementDisabled"];if(ge.filter(function(e){return-1===r.indexOf(e)}).forEach(function(e){n.events.on(i,e,function(){be.t.raise(n._context,e)})}),"addTextTrack"in i&&Le&&!pe.e.isActivated("7A9A6457-BF63-4EA9-9402-1A67FA1A8CD6","10/21/2021","Defer video segment errors")){var o=this._errorTrack=i.addTextTrack("metadata","segmenterror","");this.events.on(o,"cuechange",this._onErrorChange)}i.className="od-VideoCanvas-video",this._context.shouldUseNativeControls?(this.events.on(i,"loadedmetadata",this._handleCanPlay),i.setAttribute("controls",""),i.setAttribute("poster",this._context.coverImageUrl.peek()||""),i.setAttribute("preload","auto"),this._addOrSubscribeForNativeCaptions(i)):this._context.shouldAutoPlay&&i.setAttribute("autoplay","autoplay");var s=isNaN(t)?void 0:t;if(Object(ue.isFeatureEnabled)(ue.VideoSetCorrelationIdAsQSP)){var c=I.generate();this._context.correlationId(c),this._context.dashlingVideoTelemetry.manifestCorrelationId=c,e=this._setQueryParameter(e,"correlationId",c)}if(Object(ue.isFeatureEnabled)(ue.VideoSetPsiAndCcatQspToManifestKillSwitch)){e=this._setQueryParameter(e,"psi",this._context.playbackSessionId);var d=this.mapContentCategory(this._context.getContentCategory());d&&(e=this._setQueryParameter(e,"ccat",d.toString()))}Object(ue.isFeatureEnabled)(ue.VideoIdentifyOneUpPlayerToMetaKillswitch)||(e=this._setCallstackQueryStringParameter(e)),this._context.playbackType()===se.n.htmlDashling||this._context.playbackType()===se.n.htmlDashlingMediaFoundationFallback||this._context.playbackType()===se.n.htmlDashlingFFMPEGFallback?this.async.setTimeout(function(){n._initializeDashling(e,s)},0):(Object(ue.isFeatureEnabled)(ue.VideoSetQueryParamForNative)&&(e=this._setQueryParameter(e,"App","OneDriveWebVideo")),i.setAttribute("src",e),be.t.raise(this._context,"sourceset"),s&&(i.currentTime=s)),this._computeVolume(),this._computeIsMuted(),this.element.appendChild(i),this._checkPlayState(!0)}},t.prototype.mapContentCategory=function(e){return"Meeting"===e?Se.TeamsMeetingRecording:Se.Others},t.prototype.getParameterByName=function(e,t){var n=RegExp("[?&]"+e+"=([^&]*)").exec(t);return n&&decodeURIComponent(n[1].replace(/\+/g," "))},t.prototype.getProtectionKeyUrl=function(e){try{var t="1"===this.getParameterByName("altTranscode",e)?De.ALT_TRANSCODE:De.MEDIAFOUNDATION,n=this.getParameterByName(t,e),a="";if(n){var i=atob(n);if(i){var r=JSON.parse(i);r&&(a=r.CryptographicDataKid)}}if(a){var o=this.getParameterByName("provider",e),s=this.getParameterByName("docid",e),c=this.getParameterByName("cTag",e),d=this.getParameterByName("cs",e),l=this.getParameterByName("access_token",e),u=document.createElement("a");u.href=e;var f=u.pathname,p=u.origin;p+=f.replace("videomanifest","VideoProtectionKey");var m="".concat(p,"?&provider=").concat(o,"&docId=").concat(s,"&cTag=").concat(c,"&cs=").concat(d,"&kid=").concat(a);return this.getParameterByName("tempauth",m)||(m="".concat(m,"&access_token=").concat(l)),m}return""}catch(e){return""}},t.prototype._initializeDashling=function(e,t){var n=this,a=this._videoElement;if(a){var r=this._context;r.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingHybridPlayback)&&(e=this._setQueryParameter(e,"hybridPlayback","true"));var o=Object(ue.isFeatureEnabled)(ue.VideoABRQualityThrottle240)?240:Object(ue.isFeatureEnabled)(ue.VideoABRQualityThrottle360)?360:Object(ue.isFeatureEnabled)(ue.VideoABRQualityThrottle480)?480:Object(ue.isFeatureEnabled)(ue.VideoABRQualityThrottle720)?720:null;o&&(e=this._setQueryParameter(e,"supportsDefaultQualityLimits","1"));var s=x;s.getDiagnosticInfo=r.getDiagnosticInfo.bind(r),ke||(s.getRequestParametersAsync=r.getRequestParametersAsync.bind(r)),r.isPlaybackCDNEnabled()&&(s.publishResponseMetaData=r.publishResponseMetaData.bind(r),Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingTelemetryInfo)&&(s.publishTelemetryInfo=r.publishTelemetryInfo.bind(r))),Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingTelemetry)&&(s.publishAPIStats=r.publishAPIStats.bind(r),s.publishOperationStats=r.publishOperationStats.bind(r)),Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingDecryptorV2)?s.isDecryptorV2Enabled=!0:s.isDecryptorV2Enabled=!1,Object(ue.isFeatureEnabled)(ue.VideoDecryptionErrorsInvestigation)?s.isDecryptionErrorsInvestigationEnabled=!0:s.isDecryptionErrorsInvestigationEnabled=!1,Object(ue.isFeatureEnabled)(ue.FlushBufferredDataDuringStreamReset)&&(s.flushBufferredDataDuringStreamReset=!0),Object(ue.isFeatureEnabled)(ue.VideoDashlingMaxBuffer30Seconds)?s.maxBufferSeconds=30:Object(ue.isFeatureEnabled)(ue.VideoDashlingMaxBuffer60Seconds)?s.maxBufferSeconds=60:Object(ue.isFeatureEnabled)(ue.VideoDashlingMaxBuffer90Seconds)&&(s.maxBufferSeconds=90);var c=4e4;r.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingOptimizations)&&(s.safeBufferSeconds=5,c=5e4),Object(ue.isFeatureEnabled)(ue.DashlingRequestTimeout15s)&&(c=15e3),Object(ue.isFeatureEnabled)(ue.VideoRequestStaggerMultiple1)&&(s.requestStaggerTimeMultiple=1),r.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingHybridPlayback)&&(s.publishEventInfo=r.publishEventInfo.bind(r)),s.checkForCorsErrors=Object(ue.isFeatureEnabled)(ue.VideoCorsErrorTest),Me||(s.testConnectivity=r.testConnectivity.bind(r)),r.dashlingSettings=s,s.enableMaxRetriesCheckInRequestManager=!0;var d=new ae(s),l="";if(this._context.isPlaybackEncryptionEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingParallelKeyCall)&&(this._context.playbackType()===se.n.htmlDashling||this._context.playbackType()===se.n.htmlDashlingMediaFoundationFallback||this._context.playbackType()===se.n.htmlDashlingFFMPEGFallback)&&(l=this.getProtectionKeyUrl(e))){var u=r.correlationId.peek(),f="&correlationId=";u||(u=I.generate(),r.correlationId(u),this._context.dashlingVideoTelemetry.manifestCorrelationId=u,e=e+f+u),l=l+f+u,Object(ue.isFeatureEnabled)(ue.VideoEnableRefreshToken)?this._context.getRequestParametersAsync(l).then(function(e){var t=e.url;n._getProtectionKey(t)}):this._getProtectionKey(l),pe.e.isActivated("c1a2497d-8acd-4c62-a8d3-94f5f6527f9d","04/27/2022","Add enableCdn for all manifest requests in dashling")||(e=this._setQueryParameter(e,"enableCdn","1"))}Object(ue.isFeatureEnabled)(ue.EnableRobustLoggingForManifestRequests)&&(e=this._setQueryParameter(e,"rulog","1")),e=this._appendPassthroughQsps(e),be.t.raise(this._context,"sourceset"),d.parse(e,function(i){var s,d,u,f,p={manifest:i,isABREnabled:r.isABREnabled(),requestTimeout:c,startTime:t},m=Te(i,xe),_=m.length-1;n._context.totalQualityLevels(m.length);var h=function(e){var t=e&&e.streams&&e.streams.video&&e.streams.video.timeline;if(t&&t.length>0){var n=t[0].lengthSeconds;return t.forEach(function(e){n<e.lengthSeconds&&(n=e.lengthSeconds)}),n}}(i);if(h&&n._context.maxGOPSize(Math.round(h)),o)for(var b=0;b<m.length;b++)if(m[b]>o){b>0&&(p.abrLimitQuality={video:b-1});break}var g=m.indexOf(r.desiredQuality());if(-1===g&&(g=_),p.targetQuality={audio:1,video:g},ke||(p.getRequestParametersAsync=r.getRequestParametersAsync.bind(r)),Me||(p.testConnectivity=r.testConnectivity.bind(r)),Object(ue.isFeatureEnabled)(ue.VideoEndOfStream)&&(p.missingSegmentThreshold=-2),r.isSeeking()&&r.duration()&&(p.startTime=r.duration()*r.seekPercentage()),l&&(p.getKeyAsync=r.getKeyAsync.bind(r)),p.checkForCorsErrors=Object(ue.isFeatureEnabled)(ue.VideoCorsErrorTest),p.checkForPlaybackStallsOnDemand=!0,Object(ue.isFeatureEnabled)(ue.VideoLimitDefaultStartingQuality480p)&&(p.defaultBandwidth=34e4,p.limitMaxDefaultbandwidth=!0),Object(ue.isFeatureEnabled)(ue.EnablePretranscodeSupport)){var v=i.request.getPreTranscodeInfo();p.preTranscode={enabled:v.enabled,segmentCount:v.segmentCount}}p.playbackSessionId=n._context.playbackSessionId;var y=n._dashling=new oe(p);n._manifestQualityMap=null,null===(d=null===(s=null==i?void 0:i.streams.video)||void 0===s?void 0:s.qualities)||void 0===d||d.forEach(function(e){"vcopy"===e.id&&(n._context.isCopyCodecEnabled=!0)}),n._context.isCopyCodecEnabled||null===(f=null===(u=null==i?void 0:i.streams.audio)||void 0===u?void 0:u.qualities)||void 0===f||f.forEach(function(e){"audcopy"===e.id&&(n._context.isCopyCodecEnabled=!0)}),n._context.isCopyCodecEnabled=!!n._context.isCopyCodecEnabled,y.load(a,e),r.dashling(y)},function(e,t,a,r){var o={statusMessage:h.o,errorCode:"",errorType:S.htmlOther,errorMessage:void 0,isRetriable:!0,isExpected:!1,isDisconnected:!1,requiresNewUrl:!1,correlationId:"",isBreakingTooManyRequestFlow:!1};o=Object(i.__assign)(Object(i.__assign)({},o),n._parseDashlingErrorData({state:"networkDisconnected"===e?g.disconnected:g.error,lastErrorType:e,lastErrorMessage:t,lastHttpStatus:a,lastCorrelationId:r,lastError:e?"".concat(e," ").concat(t?"(".concat(t,")"):""):null})),n._setError(Object(i.__assign)({},o))})}},t.prototype._publishProtectionKeyTelemetryStats=function(e){this._context.publishAPIStats(e)},t.prototype._getProtectionKey=function(e){var t=this,n=Ae.now();try{le.e.start({url:e,method:"GET",responseType:"arraybuffer"}).then(function(e){t._publishProtectionKeyTelemetryStats({requestType:"key",isRetry:!1,isFailure:!1,responseTimeMs:Ae.now()-n}),t._context.key(new Uint8Array(e.response)),t._context.isKeyFetchReqComplete(!0)}).catch(function(e){t._publishProtectionKeyTelemetryStats({requestType:"key",isRetry:!1,isFailure:!0,responseTimeMs:Ae.now()-n}),t._context.keyError(e),t._context.isKeyFetchReqComplete(!0)})}catch(e){this._publishProtectionKeyTelemetryStats({requestType:"key",isRetry:!1,isFailure:!0,responseTimeMs:Ae.now()-n}),this._context.keyError(e),this._context.isKeyFetchReqComplete(!0)}},t.prototype._appendPassthroughQsps=function(e){if(Object(ue.isFeatureEnabled)(ue.MeTAVideoManifestQspPassthrough)&&"undefined"!=typeof URLSearchParams){var t=new URLSearchParams(window.location.search),n=new fe.t(e);return t.forEach(function(e,t){if(t.startsWith(we)){var a=t.slice(we.length);-1===Ee.indexOf(a.toLowerCase())&&n.setQueryParameter(a,e)}}),n.toString()}return e},t.prototype._setCallstackQueryStringParameter=function(e){var t,n;try{var a=this.getParameterByName(Ce,e),i=null!==(t=this.getParameterByName("ci",e))&&void 0!==t?t:"",r=null!==(n=this.getParameterByName("si",e))&&void 0!==n?n:"";if(a){var o=atob(a),s=null==o?void 0:o.split("|");s.length&&(i=s[0]?s[0]:i,r=s[1]?s[1]:r)}if(Object(ue.isFeatureEnabled)(ue.CallstackQueryStringParameter)){var c=e&&e.indexOf("?")>-1,d=btoa("".concat(i,"|").concat(r,"|").concat(Oe));return a?e.replace(RegExp("[?&]cs=([^&]*)"),"".concat(c?"&":"?").concat(Ce,"=").concat(d)):e+"".concat(c?"&":"?").concat(Ce,"=").concat(d)}return this._setQueryParameter(e,Ce,btoa("".concat(i,"|").concat(r,"|").concat(Oe)))}catch(t){return e}},t.prototype._setQueryParameter=function(e,t,n){var a=new fe.t(e);return a.setQueryParameter(t,n),a.toString()},t.prototype._onIsPlayingChanged=function(e){this._checkPlayState(),e?this._updatePlaybackStateId||(this._updatePlaybackStateId=this.async.setInterval(this._updatePlaybackState,100)):(this.async.clearInterval(this._updatePlaybackStateId),this._updatePlaybackStateId=0)},t.prototype._onDesiredQualityChanged=function(e){var t=this._getManifestVideoQualities();t&&(this._dashling.settings.targetQuality.video=t.indexOf(e),this._dashling.settings.isABREnabled=!1,this._dashling.resetStreams())},t.prototype._onIsABREnabledChanged=function(e){this._dashling&&(this._dashling.settings.isABREnabled=e)},t.prototype._onIsRefreshingToken=function(e){var t=this;e&&(this._retryCount++,this._retryTimeoutId||(this._retryTimeoutId=window.setTimeout(function(){t._retryTimeoutId=void 0,t._retryCount=0},1e4)),this._retryCount>=3&&(clearTimeout(this._retryTimeoutId),this._retryTimeoutId=void 0,this._retryCount=3))},t.prototype._computeVolume=function(){var e=this._context.volume(),t=this._videoElement;t&&(t.volume=e)},t.prototype._computeIsMuted=function(){var e=this._context.isMuted(),t=this._videoElement;t&&(t.muted=e)},t.prototype._onSeekPercentageChanged=function(e){var t=this._videoElement;t&&t.duration&&!this._context.videoStatus().isVisible&&(t.currentTime=e?e*t.duration:0,this._context.isSeeking(!0))},t.prototype._onIsScrubbingChanged=function(e){this._onSeekPercentageChanged(this._context.seekPercentage());var t=this._videoElement;!e&&t&&this._context.position(t.currentTime)},t.prototype._handleLoadStart=function(e){this._context.isLoading(!0)},t.prototype._handleCanPlay=function(e){this._context.canPlay(!0)},t.prototype._handleCanPlayThrough=function(e){this._context.isLoading(!1)},t.prototype._parseDashlingErrorData=function(e){var t=e.state,n=e.lastErrorType,a=e.lastErrorMessage,i=e.lastHttpStatus,r=e.lastCorrelationId,o=e.lastError,s=e.lastIsBreakingTooManyRequestFlow,c={};c.correlationId=r,c.isBreakingTooManyRequestFlow=s;var d=t===g.disconnected;if(d||t===g.error){c.errorMessage=o;var l=i,u=a;if(u&&(u instanceof Error?c.errorMessage="".concat(u.message):c.errorMessage=u),c.errorCode="number"==typeof l?"".concat(l,".").concat(c.errorMessage):"",429===l&&(c.statusMessage=h.E),406===l&&(c.statusMessage=h.L,c.isExpected=!0),Object(ue.isFeatureEnabled)(ue.DisableSKCompliance)&&(405===l||500===l)&&c.errorMessage.toLowerCase()===S.geoLocInvalidRequest.toLowerCase())return c.isExpected=!0,c.isRetriable=!1,c.requiresNewUrl=!1,c.errorType=S.geoLocInvalidRequest,c.errorMessage=h.r,c;Object(ue.isFeatureEnabled)(ue.VideoForcedTokenRefresh)&&401===l&&!this._context.isRefreshingToken.peek()&&this._retryCount<3&&this._context.isRefreshingToken(!0);var f=c.errorMessage&&c.errorMessage.toLowerCase();if(f&&f.indexOf("videoprocessing_bitratetoohigh")>-1&&(c.statusMessage=h.e,c.isExpected=!0),f&&f.indexOf("fileempty")>-1)return c.errorType=S.emptyFile,c.statusMessage=h.i,c.isExpected=!0,c;switch(!pe.e.isActivated("a3389fc5-4924-44b4-9618-46f83f24b108","07/23/2021","Make errors with .Expected as expected errors")&&c.errorCode&&c.errorCode.indexOf(".Expected")>-1&&(c.isExpected=!0),n){case"initSegmentDownload":c.errorType=S.htmlDashlingInitSegmentDownload;break;case"manifestDownload":c.errorType=S.htmlDashlingManifestDownload,c.requiresNewUrl=!1;break;case"manifestParse":c.errorType=S.htmlDashlingManifestParse;break;case"mediaSegmentDownload":c.errorType=S.htmlDashlingMediaSegmentDownload,this._videoElement.buffered.length&&(c.statusMessage=h.c),c.requiresNewUrl=!1;break;case"mediaSourceInit":c.errorType=S.htmlDashlingMediaSourceInit;break;case"sourceBufferAppendException":c.errorType=S.htmlDashlingSourceBufferAppendException,c.statusMessage=h.c;break;case"sourceBufferAppendMissing":c.errorType=S.htmlDashlingSourceBufferAppendMissing,c.statusMessage=h.c;break;case"sourceBufferInit":c.errorType=S.htmlDashlingSourceBufferInit;break;case"videoElementError":break;case"networkDisconnected":c.isDisconnected=!0,c.statusMessage=h.s;break;case"aesKeyFetchError":c.errorType=S.htmlDashlingAesKeyFetchError,c.requiresNewUrl=!0,c.isExpected=!1;break;case"webcryptoInitError":c.errorType=S.htmlDashlingWebCryptoInitError,c.requiresNewUrl=!0,c.isExpected=!0;break;case"segmentDecryptionError":c.errorType=S.htmlDashlingSegmentDecryptionError,c.isExpected=!1,c.requiresNewUrl=!0;break;default:c.errorType=S.htmlDashlingOther}this._context.isPlaybackCDNEnabled()&&(de.e.log("Error occurred in CDN Encryption Flight enabled. ErrorType: "+c.errorType+" ErrorMessage: "+c.errorMessage+" ErrorCode: "+c.errorCode),c.requiresNewUrl=!0),d&&(c.isDisconnected=!0,c.statusMessage=h.s)}return c},t.prototype._getDashlingErrorInfo=function(){var e=this._dashling;return this._parseDashlingErrorData({state:e.state,lastErrorType:e.lastErrorType,lastErrorMessage:e.lastErrorMessage,lastHttpStatus:e.lastHttpStatus,lastCorrelationId:e.lastCorrelationId,lastError:e.lastError,lastIsBreakingTooManyRequestFlow:!1})},t.prototype._handleVideoElementError=function(){var e=this._videoElement,t=this._dashling,n={statusMessage:h.o,errorCode:"",errorType:S.htmlOther,errorMessage:void 0,isRetriable:!0,isExpected:!1,isDisconnected:!1,requiresNewUrl:!1,correlationId:t&&t.lastCorrelationId,isBreakingTooManyRequestFlow:!1},a=e&&e.error;if(a){var r=a.code;switch("string"==typeof r&&(r=ye[r]),n.errorMessage=a.message||"",n.errorCode=this._parseErrorMessageForCode(a.message),r){case ye.MEDIA_ERR_DECODE:n.errorType=S.htmlElementDecode,n.statusMessage=h.a,n.isRetriable=!1,n=Object(i.__assign)(Object(i.__assign)({},n),this._getDashlingErrorInfo());break;case ye.MEDIA_ERR_NETWORK:n.errorType=S.htmlElementNetwork,n.statusMessage=h.s,t?n=Object(i.__assign)(Object(i.__assign)({},n),this._getDashlingErrorInfo()):Me||(n.isDisconnected=!1===navigator.onLine);break;case ye.MEDIA_ERR_SRC_NOT_SUPPORTED:n.errorType=S.htmlElementSrcNotSupported,n.statusMessage=h.d,n.isExpected=!0;break;case ye.MEDIA_ERR_ABORTED:return;default:n.errorType=S.htmlElementOther}}else n=Object(i.__assign)(Object(i.__assign)({},n),this._getDashlingErrorInfo());this._setError(n)},t.prototype._parseErrorMessageForCode=function(e){var t=function(e,t){if(t){var n=t.split(e);if(n&&n.length>1)return n[0]}};if(e){if(this._platformDetection.isChrome)return t(":",e);if(this._platformDetection.isFirefox)return t(":",e)||t(" ",e)}},t.prototype._setError=function(e){var t=new D({code:e.errorCode,correlationId:e.correlationId,isExpected:e.isExpected||e.isDisconnected,isRetriable:e.isRetriable&&!e.isExpected,message:e.errorMessage,requiresNewUrl:e.requiresNewUrl,type:e.errorType,isBreakingTooManyRequestFlow:e.isBreakingTooManyRequestFlow}),n={statusMessage:e.statusMessage,error:t};this._tryDeferError(n)||Object(ue.isFeatureEnabled)(ue.VideoForcedTokenRefresh)&&this._context.isRefreshingToken.peek()&&!(this._retryCount>=3)||this._context.setVideoStatus(n)},t.prototype._tryDeferError=function(e){try{var t=this._errorTrack;if(!t||!Le)return!1;switch(e.error.type){case S.htmlDashlingMediaSegmentDownload:case S.htmlDashlingSourceBufferAppendException:case S.htmlDashlingSourceBufferAppendMissing:break;default:return!1}for(var n=this._videoElement,a=n.currentTime,i=n.buffered,r=-1,o=0;o<i.length;o++){var s=i.end(o);if(i.start(o)<a&&(r=s,s>a))break}if(r<=0)return!1;var c="".concat(++Pe),d=new Le(Math.max(0,r-1),1e10,"");return d.id=c,t.addCue(d),this._errors[c]=e,!0}catch(e){return de.e.log(e),!1}},t.prototype._checkPlayState=function(e){var t=this,n=this._videoElement,a=!1,i=this._context;(e=e||!i.canPlay())||(this._stalePlayStateId=0),n&&(i.isPlaying()&&!i.isScrubbing()&&n.paused?e?a=!0:(Math.abs(i.position()-i.duration())<.5&&(n.currentTime=0),ce.n.resolve(n.play()).then(function(){},function(){i.isPlaying(!1)})):i.isPlaying()&&!i.isScrubbing()||n.paused||(e?a=!0:n.pause()),a&&!this._stalePlayStateId&&(this._stalePlayStateId=this.async.setTimeout(function(){t._stalePlayStateId=0,t._checkPlayState()},300)))},t.prototype._checkEndState=function(e){var t=this._videoElement,n=this._context;e||(this._staleEndStateId=0),t&&(!e||n.isPlaying())&&t.duration-t.currentTime<=.4&&(e?this._staleEndStateId||(this._staleEndStateId=this.async.setTimeout(this._checkEndState,400)):(n.position(n.duration()),this._handleEnded(null)))},t.prototype._addOrSubscribeForNativeCaptions=function(e){var t=this;this._context.areCaptionsAvailable.peek()?this._addNativeCaptions(e):this.subscribe(this._context.areCaptionsAvailable,function(n){n&&t._addNativeCaptions(e)})},t.prototype._addNativeCaptions=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,n;return Object(i.__generator)(this,function(a){switch(a.label){case 0:return[4,this._context.closedCaptionsManager.getCaptionsEndpoint()];case 1:return(t=a.sent())&&(e.crossOrigin="anonymous",(n=document.createElement("track")).src=t,n.kind="captions",n.label="English",e.appendChild(n)),[2]}})})},t.prototype._updatePlaybackState=function(){this._videoElement&&this._handleBufferChange()},t.prototype._getManifestVideoQualities=function(){if(!this._manifestQualityMap){var e=this._dashling,t=e&&e.settings,n=t&&t.manifest;if(n){var a=Te(n,xe);0!==a.length&&(this._manifestQualityMap=a)}}return this._manifestQualityMap},t.prototype._updateDashlingState=function(){var e=this._dashling,t=this._context;e.settings.isABREnabled=t.isABREnabled();var n=this._getManifestVideoQualities();n?(t.dashQualities(n),t.maxQuality(n[e.getMaxQuality(xe)]),e.settings.isABREnabled?t.playingQuality(n[e.getPlayingQuality(xe)]):t.playingQuality(n[e.getBufferingQuality(xe)])):t.maxQuality(0)},t.prototype._handleEnded=function(e){this._context.isPlaying(!1),this._context.internalTechPlaying(!1)},t.prototype._handleVolumeChanged=function(e){var t=this._platformDetection.isIOS||window&&window.navigator&&"MacIntel"===window.navigator.platform&&window.navigator.maxTouchPoints>1;if(pe.e.isActivated("11aab7e9-5ea2-4539-927f-bea8d7674d84","06/29/2021","volume control issue inside ios safari")||!this._platformDetection.isSafari||!t){var n=this._videoElement;n&&this._context.volume(n.volume)}},t.prototype._handlePlay=function(e){this._context.isPlaying(!0)},t.prototype._handlePause=function(e){this._context.isScrubbing()||this._context.isPlaying(!1),this._context.internalTechPlaying(!1),this._context.isLoading(!1)},t.prototype._handleWaiting=function(e){this._context.isLoading(!0),this._onErrorChange(),this._context.internalTechPlaying(!1)},t.prototype._handlePlaying=function(e){this._context.isLoading(!1),this._context.isSeeking(!1),this._context.isPlaying(!0),this._context.internalTechPlaying(!0)},t.prototype._handleRateChange=function(){var e=this._videoElement.playbackRate;this._context.isLoading(e<.5)},t.prototype._handleBufferChange=function(){var e=this._videoElement,t=e.buffered,n=e.duration,a=this._context.bufferedRanges;if(this._checkPlayState(!0),this._checkEndState(!0),this._context.position(e.currentTime),this._context.duration(e.duration),this._context.rawBufferedTimeRanges(t),n&&t){for(;a().length>t.length;)a.pop();for(var i=0;t&&i<t.length;i++){var o=a()[i],s=t.start(i),c=100*s/n+"%",d=100*(t.end(i)-s)/n+"%";o?(o.left(c),o.width(d)):a.push({left:r.observable(c),width:r.observable(d)})}}this._dashling&&this._updateDashlingState()},t}(_.t),Fe="readystatechange",He=0,Re=new Ie.e,Ne={},Be=function(e){function t(t){var n=e.call(this,t)||this;return n.controlsDescendantBindings=!0,n._context=n.valueAccessor(),n._isPlayerReady=r.observable(!1),n.subscribe(n._context.url,n._onUrlChanged),n.createBackgroundComputed(n._computeVolume),n.createBackgroundComputed(n._computeIsMuted),n.subscribe(n._context.seekPercentage,n.async.debounce(n._onSeekPercentageChanged,100)),n.subscribe(n._context.isScrubbing,n._onIsScrubbingChanged),n.subscribe(n._context.isPlaying,n._onIsPlayingChanged),n._onUrlChanged(),n}return Object(i.__extends)(t,e),t.prototype.dispose=function(){this._removeFlashPlayer(),e.prototype.dispose.call(this)},t.prototype.handlePlaybackEvent=function(e,t){var n=this._playerElement;if(n||(n=this._playerElement=document.getElementById(this._playerId)),this._isPlayerReady(!0),n)switch(e){case"onJavaScriptBridgeCreated":case"durationchange":case"volumechange":break;case"loadstart":this._context.isLoading(!0),this._context.internalTechPlaying(!1),this._loadTimeoutId=this.async.setTimeout(this._onLoadTimeout,1e4);break;case"error":this._context.setVideoStatus({statusMessage:h.o,error:new D({code:"unspecified",type:S.flashOther})});break;case"emptied":this._context.canPlay(!0);break;case"play":this._context.isPlaying(!0),this._context.internalTechPlaying(!0);break;case"pause":this._context.internalTechPlaying(!1);break;case"loadedmetadata":this._loadTimeoutId&&this.async.clearTimeout(this._loadTimeoutId),this._context.canPlay(!0);break;case"seeking":this._context.isSeeking(!0);break;case"seeked":this._context.isSeeking(!1),this._context.isLoading(!1);break;case"timeupdate":this._loadTimeoutId&&this.async.clearTimeout(this._loadTimeoutId),this._context.position(t.currentTime),this._context.duration(t.duration);break;case"progress":var a=this._context.bufferedRanges,i=this._context.duration();if(i&&a){for(;a().length>t.buffered.length;)a.pop();for(var o=0;t.buffered&&o<t.buffered.length;o++){var s=a()[o],c=t.buffered._start[o],d=100*c/i+"%",l=100*(t.buffered._end[o]-c)/i+"%";s?(s.left(d),s.width(l)):a.push({left:r.observable(d),width:r.observable(l)})}}break;case"complete":this._context.position(this._context.duration.peek()),this._context.isPlaying(!1)}be.t.raise(this._context,e)},t.prototype._onUrlChanged=function(){this._removeFlashPlayer(),this._createFlashPlayer()},t.prototype._computeVolume=function(){var e=this._context.volume();if(this._isPlayerReady()&&this._playerElement)try{this._playerElement.setVolume(e)}catch(e){}},t.prototype._computeIsMuted=function(){var e=this._context.isMuted();if(this._isPlayerReady()&&this._playerElement)try{this._playerElement.setMuted(e)}catch(e){}},t.prototype._onSeekPercentageChanged=function(e){var t=this._context.duration();if(this._isPlayerReady()&&this._playerElement&&t&&!this._context.videoStatus().isVisible){try{this._playerElement.seek(e*t)}catch(e){}this._context.isSeeking(!0)}},t.prototype._onIsScrubbingChanged=function(e){this._onSeekPercentageChanged(this._context.seekPercentage())},t.prototype._onIsPlayingChanged=function(e){if(this._isPlayerReady()&&this._playerElement)try{e?this._playerElement.play2():this._playerElement.pause()}catch(e){}},t.prototype._createFlashPlayer=function(){if(this._context.url.peek()){var e=window.require.toUrl("odsp-media/flash/osmf.swf"),t=window.require.toUrl("odsp-media/flash/strobe.swf");if(!Object(ue.isFeatureEnabled)(ue.UseFlashVideoPlayerFromManifest)){var n=window.FilesConfig.imgBaseUrl||"";n&&(e="".concat(n,"flash/v1/osmf.swf"),t="".concat(n,"flash/v1/strobe.swf"))}var a="",i=this._context;this._playerId="player-".concat(++He);var r=this._playerId;Ne[r]=this;var o="javascriptCallbackFunction=flashVideoCallback"+"&autoPlay=".concat(!!this._context.shouldAutoPlay)+"&loop=false&controlBarMode=none&enableStageVideo=true&controlBarAutoHide=false&playButtonOverlay=false"+"&id=".concat(r)+"&useHTML5=false&bufferingOverlay=false"+"&src=".concat(encodeURIComponent(i.url()))+"&plugin_AdaptiveStreamingPlugin=".concat(encodeURIComponent(e));a=Re.isIE&&Re.browserMajor<9?'<object id="'.concat(r,'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000">')+'<param name="movie" value="'.concat(t,'" />'):'<object id="'.concat(r,'" name="').concat(r,'" type="application/x-shockwave-flash" data="').concat(t,'">'),a+='<param name="allowfullscreen" value="false" /><param name="wmode" value="transparent" /><param name="bgcolor" value="000000"/><param name="allowscriptaccess" value="always"/>'+'<param name="flashvars" value="'.concat(o,'" />')+"</object>",this.element.innerHTML=a,this._playerElement=document.getElementById(r),be.t.raise(this._context,"sourceset")}},t.prototype._removeFlashPlayer=function(){if(this._playerId){delete Ne[this._playerId],delete this._playerId,this._isPlayerReady(!1);var e=this._playerElement;if(this._playerElement=null,e)if(Re.isIE)e.style.display="none",4===e.readyState?this._removeFlashPlayerIE(e):this.events.on(e,Fe,this._onIEFlashPlayerReadyStateChange);else try{e.parentNode&&e.parentNode.removeChild(e)}catch(e){}}},t.prototype._removeFlashPlayerIE=function(e){for(var t in e)"function"==typeof e[t]&&(e[t]=null);e.parentNode&&e.parentNode.removeChild(e)},t.prototype._onIEFlashPlayerReadyStateChange=function(e){var t=e.target;4===t.readyState&&(this._removeFlashPlayerIE(t),this.events.off(t,Fe,this._onIEFlashPlayerReadyStateChange))},t.prototype._onLoadTimeout=function(){this._context.setVideoStatus({statusMessage:h.o,error:new D({code:"timeout",type:S.flashLoadTimeout})})},t}(_.t);window.flashVideoCallback=function(e,t,n){Ne[e]&&Ne[e].handlePlaybackEvent(t,n)},Object(a.n)([{rawString:".c-DashMonitor{background:rgba(44,44,44,.7);position:absolute;top:-10px;left:0;right:0;min-height:15px;display:block;opacity:0;color:#aaa}.c-DashMonitor.isVisible{transition:opacity .2s linear,top .25s ease-out;top:0;opacity:1}.c-DashMonitor .key,.c-DashMonitor .streamData{display:none}.c-DashMonitor .isVisible{display:block}.c-DashMonitor .streamMetrics{list-style-type:none;padding:5px 5px 0 5px;margin:0}.c-DashMonitor .streamMetrics li{margin-right:5px;margin-bottom:5px;border:1px solid rgba(255,255,255,.5);background:#313131;overflow:hidden;vertical-align:top;font-size:11px;display:none}.c-DashMonitor .streamMetrics li.hasValue{display:inline-block}.c-DashMonitor .streamTitle{font-size:15px;display:inline-block;width:80px;text-align:right;float:left;margin-right:5px;line-height:30px}.c-DashMonitor .metricTitle{padding:3px 5px;display:inline-block;font-weight:700}.c-DashMonitor .metricValue{display:inline-block;padding:3px 5px;white-space:nowrap;background:#5f5f5f;color:#fff}.c-DashMonitor .row{line-height:15px;height:15px;padding-bottom:1px;position:relative;border-top:1px solid rgba(255,255,255,.1);border-bottom:1px solid rgba(255,255,255,.1);margin-top:-1px;font-weight:700;font-size:9px;background:#222}.c-DashMonitor .traffic{position:relative}.c-DashMonitor .seekContainer{margin-left:3px}.c-DashMonitor .seekBar{position:absolute;top:0;left:0;width:2px;margin-left:-2px;background:rgba(255,255,255,.7);height:100%}.c-DashMonitor .rowHeader{position:absolute;width:80px;text-align:right}.c-DashMonitor .rowFragments,.c-DashMonitor .seekContainer{position:absolute;top:0;left:85px;right:0;bottom:0}.c-DashMonitor .rowRequest{position:absolute;top:2px;bottom:2px;border-radius:4px;box-shadow:inset -4px 0 7px 0 rgba(0,0,0,.6);min-width:5px}.c-DashMonitor .key{box-shadow:inset 0 8px 15px -10px rgba(0,0,0,.2);font-size:11px;padding:10px}.c-DashMonitor .keyItem{display:inline-block;margin-right:10px}.c-DashMonitor .keyBox{display:inline-block;position:relative;top:-1px;width:10px;height:10px;margin:0 5px;border:1px solid #888;vertical-align:middle}.c-DashMonitor .waiting{background:#adadad url(data:image/gif;base64,R0lGODlhBAAEAIAAANLS0paWliH/C05FVFNDQVBFMi4wAwEAAAAh+QQEBQAAACwAAAAABAAEAAACBkwAl2h5BQAh+QQEBQAAACwAAAAABAAEAAACBURiaLBZACH5BAQFAAAALAAAAAAEAAQAAAIGBBKXaHkFACH5BAQFAAAALAAAAAAEAAQAAAIFDGBosVkAOw==)}.c-DashMonitor .downloading{background:#727272 url(data:image/gif;base64,R0lGODlhBAAEAIAAADZn96m++yH/C05FVFNDQVBFMi4wAwEAAAAh+QQEBQAAACwAAAAABAAEAAACBgQSl2h5BQAh+QQEBQAAACwAAAAABAAEAAACBQxgaLFZACH5BAQFAAAALAAAAAAEAAQAAAIGTACXaHkFACH5BAQFAAAALAAAAAAEAAQAAAIFRGJosFkAOw==)}.c-DashMonitor .downloaded{background:#3747ff}.c-DashMonitor .appending{background:#85b98f}.c-DashMonitor .appended{background:#00bd24}.c-DashMonitor .error{background:#df4242}"}]);var je=0,Ve=performance&&performance.now?performance:Date,ze=function(){function e(){var e=this;this._updateSeekBar=function(){var t=e,n=t._videoElement,a=t.subElements;if(n&&a){var i=100*n.currentTime/n.duration+"%";a.audioSeekBar.style.left=i,a.videoSeekBar.style.left=i}},this.id="DashMonitorView-".concat(je++),this.isActive=!1,this.isVisible=!0,this._dataContext=null,this._videoElement=null,this._interval=0,this._events=null,this._dashling=null,this.element=null,this.subElements=null,this.reset()}return e.prototype.dispose=function(){var e=this;e._interval&&(clearInterval(e._interval),e._interval=0),e._events&&e._events.dispose(),e._videoElement&&(e._videoElement=null),e._dashling&&(e._dashling=null)},e.prototype.attachTo=function(e){var t=We("div");t.innerHTML=this.renderHtml(),this.element?e.replaceChild(t.firstChild,this.element):e.appendChild(t.firstChild),this.activate()},e.prototype.observe=function(e,t){var n=this;n._events&&n._events.dispose(),n._events=new C.e(n),t&&(n._videoElement=t,n._events.onAll(t,{timeupdate:n._updateSeekBar,seeking:n._updateSeekBar})),e&&(n._dashling=e,n._events.on(e,"sessionStateChange",n._onSessionChanged),n._onSessionChanged())},e.prototype.reset=function(){this._dataContext=this._createContext(),this.element&&this.attachTo(this.element.parentElement)},e.prototype.setVisibility=function(e){e!==this.isVisible&&(this.isVisible=e,this.isActive&&this._update())},e.prototype.setDataContext=function(e){this._dataContext=e,this._update()},e.prototype.renderHtml=function(){return'<div id="'.concat(this.id,'" class="c-DashMonitor">')+'<ul class="streamMetrics"></ul><div class="audio streamData"><span class="streamTitle">Audio</span><ul class="streamMetrics"></ul><div class="traffic"><div class="qualities"></div><div class="seekContainer"><div class="seekBar"></div></div></div></div><div class="video streamData"><span class="streamTitle">Video</span><ul class="streamMetrics"></ul><div class="traffic"><div class="qualities"></div><div class="seekContainer"><div class="seekBar"></div></div></div></div><div class="key"><div class="keyItem"><div class="keyBox waiting"></div><span>Waiting for response</span></div><div class="keyItem"><div class="keyBox downloading"></div><span>Receiving bytes</span></div><div class="keyItem"><div class="keyBox downloaded"></div><span>Downloaded</span></div><div class="keyItem"><div class="keyBox appending"></div><span>Appending</span></div><div class="keyItem"><div class="keyBox appended"></div><span>Appended</span></div><div class="keyItem"><div class="keyBox error"></div><span>Error</span></div><div><button id ="diagnosticButton">Copy Diagnostics</button><input id ="infos" style="border: none; background: transparent; color: transparent"/></div></div>'},e.prototype.activate=function(){var e=this,t=this.element=Ge("#"+this.id);this.subElements={metrics:Ge(".streamMetrics",t),audioElement:Ge(".audio"),audioMetrics:Ge(".audio .streamMetrics",t),audioQualities:Ge(".audio .qualities",t),audioSeekBar:Ge(".audio .seekBar",t),videoElement:Ge(".video"),videoMetrics:Ge(".video .streamMetrics",t),videoQualities:Ge(".video .qualities",t),videoSeekBar:Ge(".video .seekBar",t),key:Ge(".key")},Ge("#diagnosticButton").onclick=function(){e.copyDiagnosticsInfo()},this.isActive=!0,this._update()},e.prototype.deactivate=function(){this.subElements=null,this.isActive=!1},e.prototype.copyDiagnosticsInfo=function(){var e=Ke(".streamMetrics .metricTitle"),t=Ke(".streamMetrics .metricValue"),n=this._appendInfo(e,t);e=Ke(".audio .streamMetrics .metricTitle"),t=Ke(".audio .streamMetrics .metricValue");var a=this._appendInfo(e,t);e=Ke(".video .streamMetrics .metricTitle"),t=Ke(".video .streamMetrics .metricValue");var i={GeneralInfo:n,Audio:a,Video:this._appendInfo(e,t)},r=document.getElementById("infos");r.value=JSON.stringify(i),r.select(),document.execCommand("copy"),alert("Diagnostic Information Copied to Clipboard"),r.setSelectionRange(0,0),r.blur()},e.prototype._appendInfo=function(e,t){for(var n={},a=0;a<e.length;a++){var i=e[a],r=t[a];n[i.innerText]=r.innerText}return n},e.prototype._onSessionChanged=function(){var e=this,t=e._dashling,n=t.state;n===g.error||n===g.idle?(clearInterval(e._interval),e._interval=0,e.setDataContext(e._getStats(t))):t.state>g.idle&&!e._interval&&(e._interval=setInterval(function(){e.isVisible&&e.setDataContext(e._getStats(t))},100))},e.prototype._update=function(){var e=this._dataContext,t=void 0!==e.state&&!!this._dashling&&e.state!==g.idle;if(this.isActive){var n=this.subElements;Qe(this.element,"isVisible",t&&this.isVisible),this._updateMetrics(n.metrics,e.metrics);var a=e&&e.streams,i=a&&a.audio||{},r=a&&a.video||{};Qe(n.audioElement,"isVisible",!(!i.metrics&&!i.qualities)),Qe(n.videoElement,"isVisible",!(!r.metrics&&!r.qualities)),Qe(n.key,"isVisible",!(!i.qualities&&!r.qualities)),this._updateMetrics(n.audioMetrics,i.metrics),this._updateQualities(n.audioQualities,i.qualities),this._updateMetrics(n.videoMetrics,r.metrics),this._updateQualities(n.videoQualities,r.qualities)}},e.prototype._updateMetrics=function(e,t){if(Qe(e,"isVisible",!!t),t)for(var n=e._metricLookup=e._metricLookup||{},a=0;a<t.length;a++){var i=t[a],r=n[i.title];r||((r=We("li")).innerHTML='<span class="metricTitle">'+i.title+'</span><span class="metricValue"></span>',Ge(".metricTitle",r).textContent=i.title,e.appendChild(r),r=n[i.title]=Ge(".metricValue",r)),r.parentElement.className=i?"hasValue":"",r.textContent=i.value}},e.prototype._updateQualities=function(e,t){if(Qe(e,"isVisible",!!t),t)for(var n=e._qualityRowLookup=e._qualityRowLookup||{},a=0;a<t.length;a++){var i=t[a];if(i){var r=n[a];if(!r){r=n[a]=We("div","row"),We("div","rowHeader",i.title,r),We("div","rowFragments",null,r),r.qualityIndex=i.index;for(var o=e.firstElementChild;o;){if(i.index>Number(o.qualityIndex)){e.insertBefore(r,o);break}o=o.nextElementSibling}r.parentNode||e.appendChild(r)}this._updateFragments(Ge(".rowFragments",r),i.fragments)}}},e.prototype._updateFragments=function(e,t){if(Qe(e,"isVisible",!!t),t){for(var n=e._fragmentListLookup=e._fragmentListLookup||{},a={},i=this._dataContext.duration,r=0;r<t.length;r++){var o=t[r],s=n[o.index];s?delete n[o.index]:((s=We("div","rowRequest",null,e)).style.left=100*o.start/i+"%",s.style.width=100*o.length/i+"%"),a[o.index]=s,s.className="rowRequest "+o.state}for(var c in e._fragmentListLookup=a,n)n[c]&&e.removeChild(n[c])}},e.prototype._createContext=function(){return{state:g.idle,metrics:[],streams:{audio:null,video:null},duration:0}},e.prototype._getStats=function(e){var t,n,a,i=this._createContext(),r=e.streamController,o=e.settings.manifest;if(i.state=e.state,i.metrics.push({title:"State",value:g[e.state]},{title:"Last error",value:e.lastError},{title:"Load",value:(e.timeAtFirstCanPlay||Ve.now()-(e.startTime||0))+" ms"}),o&&r){i.duration=o.mediaDuration;var s=e.settings.getDiagnosticInfo(),c=r?r.getTimeUntilUnderrun():0;i.metrics.push({title:"Manifest",value:o&&o.request&&o.request.timeAtLastByte?o.request.timeAtLastByte+" ms":""},{title:"Stalls",value:String(r.stalls)||""},{title:"Recovery time",value:""},{title:"Stall chance",value:""},{title:"Buffer rate",value:qe(e.getBufferRate(),2,2)+" s/s"},{title:"Buffer left",value:qe(e.getRemainingBuffer(),2,2)+" s"},{title:"Time until stall",value:c<Number.MAX_VALUE?qe(c,2,2)+" s":""},{title:"PlaybackSessionId",value:e.settings.playbackSessionId},{title:"Transcode Type",value:String(s.transcodeType)},{title:"Fallback Count",value:String(s.fallbackCount)});for(var d=0,l=r.streams;d<l.length;d++){var u=l[d],f=[],p=[];f.push({title:"Quality",value:String(u.qualityIndex)});var m=u.requestManager.waitTimes.average;f.push({title:"Avg wait",value:m?qe(m,2)+" ms":null}),m=u.requestManager.receiveTimes.average,f.push({title:"Avg receive",value:m?qe(m,2)+" ms":null}),m=u.requestManager.bytesPerSeconds.average,f.push({title:"Avg bandwidth",value:m?(t=m,void 0,void 0,void 0,1e3,n=1e6,a=8*t,a<1e3?a+" bps":a<n?qe(a/1e3,2,2)+" kbps":qe(a/n,2,2)+" mbps"):null});for(var _=0;_<u.fragments.length;_++){var h=u.fragments[_];if(h.activeRequest){var b=h.qualityIndex,y=p[b];y||(y=p[b]={title:h.qualityId,index:b,fragments:[]});var S=h.state===v.downloading&&-1===h.activeRequest.timeAtFirstByte?"waiting":v[h.state]||"";y.fragments.push({index:_,state:S,start:h.time.startSeconds,length:h.time.lengthSeconds})}}i.streams[u.streamType]={metrics:f,qualities:p}}}return i},e}();function Ge(e,t){return(t||document).querySelector(e)}function Ke(e){return document.querySelectorAll(e)}function We(e,t,n,a){var i=document.createElement(e);return t&&(i.className=t),n&&(i.textContent=n),a&&a.appendChild(i),i}function qe(e,t,n){var a=String(parseFloat(e.toFixed(t)));if(n)for(a.indexOf(".")<0&&(a+=".");a.indexOf(".")!==a.length-3;)a+="0";return a}function Qe(e,t,n){if(e){var a=e.classList;void 0===n?a.toggle(t):n?a.add(t):a.remove(t)}}var Ye=function(e){function t(t){var n=e.call(this,t)||this;return n.controlsDescendantBindings=!0,n._videoContext=n.valueAccessor(),n.createBackgroundComputed(n._computeDashlingMonitor),n}return Object(i.__extends)(t,e),t.prototype.dispose=function(){e.prototype.dispose.call(this),this._disposeMonitor()},t.prototype._disposeMonitor=function(){this._dashlingMonitor&&(this._dashlingMonitor.dispose(),this._dashlingMonitor=null,this.element.innerHTML="")},t.prototype._computeDashlingMonitor=function(){var e=this._videoContext.dashling();this._disposeMonitor(),e&&(this._dashlingMonitor=new ze,this._dashlingMonitor.attachTo(this.element),this._dashlingMonitor.observe(e,e.videoElement))},t}(_.t),Je=n(2337),Xe=function(e){function t(t){var n=e.call(this,t)||this;return n.context=n.resources.consume(Je.e),n.addBindingHandlers({htmlVideoContext:Ue,flashVideoContext:Be,videoMonitor:Ye}),n}return Object(i.__extends)(t,e),t}(m.t);p.e({tagName:"od-videocanvas",template:'<div class="od-VideoCanvas">\x3c!--ko if:context.canvasType()===\'html\'--\x3e<div data-bind="htmlVideoContext:context"></div>\x3c!--/ko--\x3e\x3c!--ko if:context.canvasType()===\'flash\'--\x3e<div data-bind="flashVideoContext:context"></div>\x3c!--/ko--\x3e\x3c!--ko if:context.isDiagnosticsEnabled--\x3e<div data-bind="videoMonitor:context"></div>\x3c!--/ko--\x3e</div>',viewModel:Xe,synchronous:!0}),Object(a.n)([{rawString:".od-VideoPanel{width:600px;height:400px;background:"},{theme:"black",defaultValue:"#000"},{rawString:";position:relative}.od-PlaybackPanel{padding:0 28px;white-space:nowrap;background-color:"},{theme:"oneUpPaneBackground",defaultValue:"rgba(255,255,255,.75)"},{rawString:"}.od-PlaybackPanel-bottom{position:relative;height:50px}.od-PlaybackPanel-timePlayed{float:left;color:"},{theme:"neutralPrimary",defaultValue:"#323130"},{rawString:";font-size:14px}.od-PlaybackPanel-totalTime{float:right;color:"},{theme:"neutralPrimary",defaultValue:"#323130"},{rawString:";font-size:14px}.od-PlaybackPanel-buttons{position:absolute;left:0;right:0;text-align:center}.od-PlaybackPanel-button{width:40px;height:40px;padding:0;margin:0 4px;border:none;box-sizing:border-box;font-size:21px;color:"},{theme:"neutralPrimary",defaultValue:"#323130"},{rawString:";background-color:transparent;cursor:pointer}.od-PlaybackPanel-button:hover{background-color:"},{theme:"neutralLight",defaultValue:"#edebe9"},{rawString:"}.od-PlaybackPanel-button:active{background-color:"},{theme:"neutralTertiaryAlt",defaultValue:"#c8c6c4"},{rawString:"}.od-PlaybackPanel-volume{display:inline-block;position:relative}.od-PlaybackPanel-volumeMenu{position:absolute;top:0}.od-PlaybackPanel-gear{position:relative;display:inline}.od-PlaybackPanel-gearMenu{position:absolute;bottom:100%;margin-bottom:12px}[dir=ltr] .od-PlaybackPanel-gearMenu{left:50%}[dir=rtl] .od-PlaybackPanel-gearMenu{right:50%}.od-PlaybackPanel .ms-ContextualMenu{position:static}.md .od-PlaybackPanel-time,.sm .od-PlaybackPanel-time{width:40px}"}]),n(1860);var Ze=n(21),$e=n(1108),et=n(444),tt=n(154),nt=n(812),at=n(1113),it=function(e){function t(t){var n=e.call(this,t)||this;return n.name="SetVideoQuality",n._context=n.resources.consume(Je.e),n._quality=t.quality,n}return Object(i.__extends)(t,e),t.prototype.onExecute=function(e,t){return this._context.desiredQuality(this._quality),this._context.isABREnabled(!1),ce.n.wrap({resultType:c.e.Success})},t.prototype.onIsAvailable=function(){var e=this._context;return!!e.canAdjustQuality()&&(e.maxQuality(),e.hasVideoQuality(this._quality))},t.prototype.onIsToggled=function(){var e=this._context;return this.isAvailable()&&this._quality===(e.isABREnabled()?e.playingQuality():e.desiredQuality())},t}(at.e),rt=function(e){function t(){var t=e.call(this,{})||this;return t.name="ToggleVideoABR",t._context=t.resources.consume(Je.e),t}return Object(i.__extends)(t,e),t.prototype.onExecute=function(e,t){var n=this._context.isABREnabled();return n&&this._context.desiredQuality(this._context.playingQuality()),this._context.isABREnabled(!n),ce.n.wrap({resultType:c.e.Success})},t.prototype.onIsToggled=function(){return this._context.isABREnabled()},t}(at.e),ot=function(e){function t(){var t=e.call(this,{})||this;return t.name="ToggleVideoDiagnostics",t._context=t.resources.consume(Je.e),t}return Object(i.__extends)(t,e),t.prototype.onExecute=function(e,t){return this._context.isDiagnosticsEnabled(!this._context.isDiagnosticsEnabled.peek()),ce.n.wrap({resultType:c.e.Success})},t.prototype.onIsToggled=function(){return this._context.isDiagnosticsEnabled()},t}(at.e),st=n(96),ct=n(2402);Object(a.n)([{rawString:".od-ScrubBar{position:relative}.od-ScrubBar .ProgressSpinnerFlat{display:none}.od-ScrubBar--isLoading .ProgressSpinnerFlat{display:block;color:"},{theme:"white",defaultValue:"#fff"},{rawString:";position:absolute;left:0;right:0;bottom:4px}.od-ScrubBar-content{overflow:hidden;position:relative}.od-ScrubBar-bar{height:26px;position:relative;cursor:pointer}.od-ScrubBar-bar:focus{outline:1px solid transparent;box-shadow:0 0 0 1px #767676 inset}.od-ScrubBar-scrubArea{height:100%;position:relative}.od-ScrubBar-thumb{background-color:"},{theme:"themeDarkAlt",defaultValue:"#106ebe"},{rawString:';height:2px;position:absolute;top:12px;left:0}.od-ScrubBar-thumb::after{content:"";position:absolute;top:-10px;right:-11px;width:18px;height:18px;background-color:'},{theme:"neutralLight",defaultValue:"#edebe9"},{rawString:";border-radius:50px;border:2px solid "},{theme:"themeDarkAlt",defaultValue:"#106ebe"},{rawString:"}.od-ScrubBar-fill{top:12px;width:100%;height:2px;position:absolute;background-color:"},{theme:"neutralLight",defaultValue:"#edebe9"},{rawString:';box-shadow:0 0 1px rgba(255,255,255,.5);overflow:hidden;-webkit-mask-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC)}.od-ScrubBar-bar:hover .od-ScrubBar-fill::after{content:"";position:absolute;left:0;top:0;height:2px;right:0;background:rgba(255,255,255,.1)}.od-ScrubBar-buffered{position:absolute;left:0;top:0;height:2px;background-color:'},{theme:"neutralTertiary",defaultValue:"#a19f9d"},{rawString:"}.od-ScrubBar-tooltip{position:absolute;pointer-events:none;min-width:30px;height:25px;line-height:25px;background:"},{theme:"white",defaultValue:"#fff"},{rawString:";color:"},{theme:"black",defaultValue:"#000"},{rawString:';top:-22px;box-shadow:0 0 10px -3px;border-radius:1px;padding:0 8px;font-size:12px;text-align:center;transform:translate(-50%,50%);opacity:0}.od-ScrubBar-tooltip--isScrubbing{transition:transform .2s ease-out,opacity .2s linear;transform:translate(-50%,0);opacity:1}.od-ScrubBar-tooltip:before{content:"";position:absolute;width:10px;height:10px;background:'},{theme:"white",defaultValue:"#fff"},{rawString:";bottom:-5px;left:50%;margin-left:-5px;transform:rotate(45deg)}"}]),n(1871);var dt=function(e){function t(t){var n=e.call(this,t)||this,a=t.valueAccessor();return n._options=a,(a.value||a.isScrubbing)&&(n.events.on(n.element,"click",n._onMouseClick),n.events.on(n.element,"mousedown",n._onMouseDown),n.events.on(n.element,"touchstart",n._onTouchStart,!0)),(a.isHovering||a.isHovering||a.clientX)&&n.events.on(n.element,"mouseenter",n._onMouseEnter),n}return Object(i.__extends)(t,e),t.prototype._updateContainerRect=function(){var e=this.element.getBoundingClientRect();this._containerRect={left:e.left,top:e.top,width:e.width,height:e.height}},t.prototype._onTouchStart=function(e){e.touches&&e.touches.length&&this._onMouseDown(e.touches[0])},t.prototype._onTouchMove=function(e){e.touches&&e.touches.length&&this._onMouseMove(e.touches[0])},t.prototype._onMouseEnter=function(e){this._updateContainerRect(),this.events.on(this.element,"mouseleave",this._onMouseLeave),this.events.on(window,"mousemove",this._onMouseMove),this.events.on(window,"touchmove",this._onTouchMove),this._onMouseMove(e),this._isHovering=!0},t.prototype._onMouseLeave=function(e){this._isHovering=!1,this.events.off(this.element,"mouseleave"),this._isScrubbing||(this.events.off(window,"mousemove"),this.events.off(window,"touchmove"))},t.prototype._onMouseDown=function(e){return this._updateContainerRect(),this.events.on(window,"mouseup",this._onMouseUp),this.events.on(window,"touchend",this._onMouseUp,!0),this._isHovering||(this.events.on(window,"mousemove",this._onMouseMove),this.events.on(window,"touchmove",this._onTouchMove,!0)),this._isScrubbing=!0,this._onMouseMove(e),!1},t.prototype._onMouseMove=function(e){var t=e.clientX-this._containerRect.left,n=Math.min(1,Math.max(0,t/this._containerRect.width));return this._hoverValue=n,this._clientX=t,this._isScrubbing&&(this._value=n),!1},t.prototype._onMouseUp=function(){return this.events.off(window,"mouseup"),this.events.off(window,"touchend"),this._isScrubbing=!1,this._isHovering||(this.events.off(window,"mousemove"),this.events.off(window,"touchmove")),!1},t.prototype._onMouseClick=function(e){return this._onMouseDown(e),this._onMouseUp(),!1},Object.defineProperty(t.prototype,"_value",{set:function(e){this._options.value&&this._options.value(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isScrubbing",{get:function(){return!!this._options.isScrubbing&&this._options.isScrubbing.peek()},set:function(e){this._options.isScrubbing&&this._options.isScrubbing(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_hoverValue",{set:function(e){this._options.hoverValue&&this._options.hoverValue(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_isHovering",{get:function(){return!!this._options.isHovering&&this._options.isHovering.peek()},set:function(e){this._options.isHovering&&this._options.isHovering(e)},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"_clientX",{set:function(e){this._options.clientX&&this._options.clientX(e)},enumerable:!1,configurable:!0}),t}(_.t),lt=function(e){function t(t){var n=e.call(this,t)||this;return n.context=n.resources.consume(Je.e),n.addBindingHandlers({scrub:dt,keyboard:$e.e}),n.percentPlayed=n.createPureComputed(n._computePercentPlayed),n.seekTooltipPercentage=r.observable(0),n.isHovering=r.observable(!1),n.isSeekTooltipVisible=n.createPureComputed(n._computeTooltipVisible),n.seekTooltipTime=n.createPureComputed(n._computeSeekTooltipTime),n.seekTooltipLeft=r.observable(0),n}return Object(i.__extends)(t,e),t.prototype.onLeftKey=function(){return this.context.seekPercentage(Math.max(0,this.context.seekPercentage.peek()-.05)),!1},t.prototype.onRightKey=function(){return this.context.seekPercentage(Math.min(1,this.context.seekPercentage.peek()+.05)),!1},t.prototype._computePercentPlayed=function(){var e;return e=this.context.isSeeking()||this.context.isScrubbing()?100*this.context.seekPercentage():100*this.context.position()/this.context.duration(),"".concat(e,"%")},t.prototype._computeSeekTooltipTime=function(){return ct.e(1e3*this.context.duration()*this.seekTooltipPercentage())},t.prototype._computeTooltipVisible=function(){return this.context.duration()&&this.isHovering()},t}(m.t),ut=p.e({tagName:"od-scrub-bar",template:'<div class="od-ScrubBar" data-bind="keyboard:{mappings:{Left:onLeftKey,Right:onRightKey,preventDefault:true}},css:{\'od-ScrubBar--isLoading\':context.isPlaying()&&context.isLoading()}"><div data-bind="component:{name:\'ms-progressSpinnerFlat\'}"></div><div class="od-ScrubBar-bar" tabindex="0" data-bind="scrub:{value:context.seekPercentage,hoverValue:seekTooltipPercentage,isScrubbing:context.isScrubbing,isHovering:isHovering,clientX:seekTooltipLeft}"><div class="od-ScrubBar-fill" data-bind="foreach:context.bufferedRanges"><div class="od-ScrubBar-buffered" data-bind="style:{left:left,width:width}"></div></div><div class="od-ScrubBar-scrubArea"><div class="od-ScrubBar-thumb" data-bind="style:{width:percentPlayed}"></div></div></div><div class="od-ScrubBar-tooltip" data-bind="css:{\'od-ScrubBar-tooltip--isScrubbing\':isSeekTooltipVisible},text:seekTooltipTime,style:{left:seekTooltipLeft()+\'px\'}"></div></div>',viewModel:lt,synchronous:!0});Object(a.n)([{rawString:".od-VolumeMenu{width:310px;height:56px;position:absolute;top:-56px;border:1px solid "},{theme:"neutralTertiaryAlt",defaultValue:"#c8c6c4"},{rawString:";background-color:"},{theme:"white",defaultValue:"#fff"},{rawString:";opacity:.9}[dir=ltr] .od-VolumeMenu{left:-132px}[dir=rtl] .od-VolumeMenu{right:-132px}.od-VolumeMenu-button{width:40px;height:40px;margin:8px 4px;border:none;vertical-align:top;box-sizing:border-box;font-size:21px;color:"},{theme:"neutralPrimary",defaultValue:"#323130"},{rawString:";background-color:transparent;cursor:pointer}.od-VolumeMenu-button:hover{background-color:"},{theme:"neutralLight",defaultValue:"#edebe9"},{rawString:"}.od-VolumeMenu-button:active{background-color:"},{theme:"neutralTertiaryAlt",defaultValue:"#c8c6c4"},{rawString:"}.od-VolumeMenu-volume{display:inline-block;vertical-align:top;line-height:58px;margin:0 8px;color:"},{theme:"neutralPrimary",defaultValue:"#323130"},{rawString:";width:26px}.od-VolumeMenu-bar{width:204px;height:30px;margin:13px 8px;display:inline-block;position:relative;cursor:pointer}.od-VolumeMenu-bar:focus{outline:1px solid transparent;box-shadow:0 0 0 1px #767676 inset}.od-VolumeMenu-scrubArea{height:100%;margin-right:10px;position:relative}.od-VolumeMenu-scrubThumb{background-color:"},{theme:"themeDarkAlt",defaultValue:"#106ebe"},{rawString:';height:10px;position:absolute;top:10px;left:0;border-radius:5px 0 0 5px;padding-left:5px}.od-VolumeMenu-scrubThumb::after{content:"";position:absolute;top:0;right:-5px;width:10px;height:10px;background-color:'},{theme:"neutralPrimary",defaultValue:"#323130"},{rawString:";border-radius:5px}.od-VolumeMenu-scrubFill{top:10px;width:100%;height:10px;position:absolute;background-color:"},{theme:"neutralTertiary",defaultValue:"#a19f9d"},{rawString:';border-radius:5px;box-shadow:0 0 1px rgba(255,255,255,.5);overflow:hidden;-webkit-mask-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAIAAACQd1PeAAAAGXRFWHRTb2Z0d2FyZQBBZG9iZSBJbWFnZVJlYWR5ccllPAAAAA5JREFUeNpiYGBgAAgwAAAEAAGbA+oJAAAAAElFTkSuQmCC)}.od-VolumeMenu-bar:hover .od-VolumeMenu-scrubFill::after{content:"";position:absolute;left:0;top:0;height:10px;right:0;background:rgba(255,255,255,.1);border-radius:5px}'}]);var ft,pt=n(1825),mt=function(e){function t(t){var n=e.call(this,t)||this;return n.overlayComponent={name:pt.e.tagName,params:{alignToParent:!0}},n.context=n.resources.consume(Je.e),n.addBindingHandlers({dismiss:nt.e,scrub:dt,keyboard:$e.e}),n.volume=n.createPureComputed(n._computeVolume),n.percentVolume=n.createPureComputed(n._computePercentVolume),n.volumeLabel=n.createComputed(n._computeVolumeLabel),n.icon=n.createPureComputed(n._computeIcon),n}return Object(i.__extends)(t,e),t.prototype.onLeftKey=function(){return this.context.volume(Math.max(0,this.context.volume.peek()-.01)),!1},t.prototype.onRightKey=function(){return this.context.volume(Math.min(1,this.context.volume.peek()+.01)),!1},t.prototype.onMuteToggleClicked=function(e,t){return this.context.isMuted(!this.context.isMuted.peek()),!1},t.prototype.getMuteButtonClass=function(){var e=this.context.volume();return this.context.isMuted()?"VolumeDisabled":0===e?"Volume0":e<=.3?"Volume1":e<=.6?"Volume2":"Volume3"},t.prototype._computeVolume=function(){return Math.round(100*this.context.volume())},t.prototype._computePercentVolume=function(){return this.volume()+"%"},t.prototype._computeVolumeLabel=function(){return this.context.isMuted()?h.A:h.m},t.prototype._computeIcon=function(){return Object(Ze.O)(this.getMuteButtonClass())},t}(m.t),_t=p.e({tagName:"od-volume-menu",template:'\x3c!--ko component:overlayComponent--\x3e<div role="slider" class="od-VolumeMenu" data-bind="keyboard:{mappings:{Left:onLeftKey,Right:onRightKey,preventDefault:true}}"><button class="od-VolumeMenu-button" data-bind="hasFocus:true,attr:{\'aria-label\':volumeLabel},click:onMuteToggleClicked"><i data-bind="class:icon"></i></button><div class="od-VolumeMenu-bar" tabindex="0" data-bind="scrub:{value:context.volume,isScrubbing:context.isAdjustingVolume}"><div class="od-VolumeMenu-scrubFill"></div><div class="od-VolumeMenu-scrubArea"><div class="od-VolumeMenu-scrubThumb" data-bind="style:{width:percentVolume}"></div></div></div><div class="od-VolumeMenu-volume" data-bind="text:volume"></div></div>\x3c!--/ko--\x3e',viewModel:mt,synchronous:!0}),ht=function(e){function t(){var t=e.call(this,{})||this;return t.name="ToggleVideotranscode",t._context=t.resources.consume(Je.e),t}return Object(i.__extends)(t,e),t.prototype.onExecute=function(e,t){var n=this._context.disableTranscode.peek();return this._context.disableTranscode(!n),ce.n.wrap({resultType:c.e.Success})},t.prototype.onIsToggled=function(){return this._context.disableTranscode()},t}(at.e),bt=function(e){function t(){var t=e.call(this,{})||this;return t.name="ToggleVideoBetatranscode",t._context=t.resources.consume(Je.e),t}return Object(i.__extends)(t,e),t.prototype.onExecute=function(e,t){var n=this._context.useBetaTranscode.peek();return this._context.useBetaTranscode(!n),ce.n.wrap({resultType:c.e.Success})},t.prototype.onIsAvailable=function(){return!this._context.disableTranscode()},t.prototype.onIsToggled=function(){return this.isAvailable()&&this._context.useBetaTranscode()},t}(at.e),gt=function(e){function t(t){var n=e.call(this,t)||this;n.context=n.resources.consume(Je.e),n.scrubBarComponent={name:ut.tagName,params:{}},n.volumeMenuComponent={name:_t.tagName,params:{}},n.addBindingHandlers({dismiss:nt.e,keyboard:$e.e});var a=n.observables;return n.currentTime=a.pureCompute(n._computeCurrentTime),n.totalTime=a.pureCompute(n._computeTotalTime),n.percentVolume=a.pureCompute(n._computePercentVolume),n.showVolumeMenu=n.createObservable(!1),n.showContextMenu=n.createObservable(!1),n.contextualMenuParams=void 0,n.labels={fullScreenLabel:a.pureCompute(n._computeFullSreenLabel),gearLabel:h.O,playPauseLabel:a.pureCompute(n._computePlayPauseLabel),volumeLabel:h.M,captionsLabel:a.pureCompute(n._computeCaptionsLabel),audioEnhancementLabel:a.pureCompute(n._computeAudioEnhancementLabel)},n.showFullScreen=a.pureCompute(n._computeShowFullScreen),n.playState=a.pureCompute(n._computePlayState),n.playStateIcon=a.pureCompute(n._computePlayStateIcon),n.volumeStateIcon=a.pureCompute(n._computeVolumeStateIcon),n.maximizeStateIcon=a.pureCompute(n._computeMaximizeStateIcon),n.showSettings=a.pureCompute(n._computeShowSettings),n.showAudioEnhancementButton=a.pureCompute(n._computeShowAudioEnhancementButton),n.ccStateIcon=a.pureCompute(n._computeCCStateIcon),n.audioEnhancementStateIcon=a.pureCompute(n._computeAudioEnhancementStateIcon),n.audioEnhancementState=a.pureCompute(n._computeAudioEnhancementState),n.gearIcon=Object(Ze.O)("Settings"),n._allowBeta=Object(ue.isFeatureEnabled)(ue.UseAltTranscodeForDashManifests),n._captionsEngagementEventEmitted=!1,n}return Object(i.__extends)(t,e),t.prototype.onPlayToggleClicked=function(e,t){return this.context.isPlaying(!this.context.isPlaying.peek()),!1},t.prototype.onAudioEnhancementToggleClicked=function(e,t){return this.context.audioEnhancementButtonState(!this.context.audioEnhancementButtonState.peek()),!1},t.prototype.onGearClicked=function(e,t){var n=this;if(!this.contextualMenuParams){var a=this.observables,r=[{value:1080,text:h.y},{value:720,text:h.x},{value:480,text:h.I},{value:360,text:h.D},{value:240,text:h.S}],o=Object(i.__spreadArray)(Object(i.__spreadArray)([],r.map(function(e){return new(n.managed(et.e))({text:e.text,isToggleable:!0,action:new(n.managed(it))({quality:e.value})})}),!0),[new et.e({text:h.C,isToggleable:!0,hasLineBreakBefore:!0,action:new(this.managed(rt))})],!1);this.context.canShowDiagnostics&&(o.push(new et.e({text:h.w,isToggleable:!0,action:new(this.managed(ot))}),new et.e({text:h.f,isToggleable:!0,action:new(this.managed(ht))})),this._allowBeta&&o.push(new et.e({text:h.k,isToggleable:!0,action:new(this.managed(bt))}))),this.contextualMenuParams={items:a.createArray(o),alignment:tt.e.BottomCenter,allowHorizontalMenuNudging:!0,isOpen:this.showContextMenu,isBeakVisible:a.create(!1),target:t.target,anchorElement:t.target}}return this.showContextMenu(!this.showContextMenu.peek()),!1},t.prototype.onVolumeClicked=function(e,t){return this.showVolumeMenu(!this.showVolumeMenu.peek()),!1},t.prototype.onMaximizedToggleClicked=function(e,t){return this.context.isMaximized(!this.context.isMaximized.peek()),!1},t.prototype.onClosedCaptionToggleClicked=function(e,t){var n=!this.context.areCaptionsEnabled.peek();n&&!this._captionsEngagementEventEmitted&&(st.e.logData({name:"Video.CaptionsEnabled"}),this._captionsEngagementEventEmitted=!0),this.context.areCaptionsEnabled(n)},t.prototype.getMuteButtonClass=function(){var e=this.context.volume();return this.context.isMuted()?"VolumeDisabled":0===e?"Volume0":e<=.3?"Volume1":e<=.6?"Volume2":"Volume3"},t.prototype._computeShowSettings=function(){return this.context.canShowDiagnostics||this.context.canAdjustQuality()},t.prototype._computeShowAudioEnhancementButton=function(){return this.context.showAudioEnhancementButton()},t.prototype._computeFullSreenLabel=function(){return this.context.isMaximized()?h.u:h.p},t.prototype._computePlayPauseLabel=function(){return this.context.isPlaying()?h.b:h.g},t.prototype._computeCaptionsLabel=function(){return this.context.areCaptionsEnabled()?h.t:h.n},t.prototype._computeShowFullScreen=function(){return!!this.context.item().video},t.prototype._computeCurrentTime=function(){return ct.e(1e3*this.context.position())},t.prototype._computeTotalTime=function(){var e=1e3*this.context.duration();return isNaN(e)?"":ct.e(e)},t.prototype._computePercentVolume=function(){return Math.round(100*this.context.volume())+"%"},t.prototype._computePlayState=function(){return this.context.isPlaying()?"Pause":"Play"},t.prototype._computePlayStateIcon=function(){return Object(Ze.O)(this.playState())},t.prototype._computeVolumeStateIcon=function(){return Object(Ze.O)(this.getMuteButtonClass())},t.prototype._computeMaximizeStateIcon=function(){return Object(Ze.O)(this.context.isMaximized()?"BackToWindow":"FullScreen")},t.prototype._computeCCStateIcon=function(){return Object(Ze.O)(this.context.areCaptionsEnabled()?"CCSolid":"CC")},t.prototype._computeAudioEnhancementLabel=function(){return this.context.audioEnhancementButtonState()?h._:h.h},t.prototype._computeAudioEnhancementStateIcon=function(){return Object(Ze.O)(this.context.audioEnhancementButtonState()?"Speech":"SpeechOff")},t.prototype._computeAudioEnhancementState=function(){return this.context.audioEnhancementButtonState()?"On":"Off"},t}(m.t),vt=p.e({tagName:"od-playback-panel",template:'<div class="od-PlaybackPanel">\x3c!--ko component:scrubBarComponent--\x3e\x3c!--/ko--\x3e<div class="od-PlaybackPanel-bottom"><span class="od-PlaybackPanel-timePlayed" data-bind="text:currentTime"></span><span class="od-PlaybackPanel-buttons"><button class="od-PlaybackPanel-button" data-automationid="od-PlaybackPanel-playpause-button" data-bind="click:onPlayToggleClicked,attr:{\'aria-label\':labels.playPauseLabel,\'data-playstate\':playState},keyboard:{target:document,mappings:{Space:onPlayToggleClicked}}"><i class="ms-Icon" data-bind="class:playStateIcon"></i></button><div class="od-PlaybackPanel-volume" data-bind="dismiss:{isOpen:showVolumeMenu}"><button class="od-PlaybackPanel-button" data-bind="attr:{\'aria-label\':labels.volumeLabel},click:onVolumeClicked"><i class="ms-Icon" data-bind="class:volumeStateIcon"></i></button>\x3c!--ko if:showVolumeMenu--\x3e<div class="od-PlaybackPanel-volumeMenu" data-bind="component:volumeMenuComponent"></div>\x3c!--/ko--\x3e</div>\x3c!--ko if:showFullScreen--\x3e<button class="od-PlaybackPanel-button" data-bind="attr:{\'aria-label\':labels.fullScreenLabel},click:onMaximizedToggleClicked,keyboard:{target:document,mappings:{AltEnter:onMaximizedToggleClicked}}"><i class="ms-Icon" data-bind="class:maximizeStateIcon"></i></button>\x3c!--/ko--\x3e<div class="od-PlaybackPanel-gear" data-bind="dismiss:{isOpen:showContextMenu}"><button class="od-PlaybackPanel-button" data-bind="attr:{\'aria-label\':labels.gearLabel},visible:showSettings,click:onGearClicked"><i class="ms-Icon" data-bind="class:gearIcon"></i></button>\x3c!--ko if:showContextMenu--\x3e<div class="od-PlaybackPanel-gearMenu" data-bind="component:{name:\'ms-contextual-menu\',params:contextualMenuParams}"></div>\x3c!--/ko--\x3e</div>\x3c!--ko if:context.areCaptionsAvailable()--\x3e<button class="od-PlaybackPanel-button" data-bind="click:onClosedCaptionToggleClicked,attr:{\'aria-label\':labels.captionsLabel}"><i class="ms-Icon" data-bind="class:ccStateIcon"></i></button>\x3c!--/ko--\x3e\x3c!--ko if:showAudioEnhancementButton--\x3e<button class="od-PlaybackPanel-button" data-automationid="od-PlaybackPanel-audioenhancement-button" data-bind="click:onAudioEnhancementToggleClicked,attr:{\'aria-label\':labels.audioEnhancementLabel,\'data-audioenhancementstate\':audioEnhancementState},visible:showAudioEnhancementButton,keyboard:{target:document,mappings:{E:onAudioEnhancementToggleClicked}}"><i data-bind="class:audioEnhancementStateIcon"></i></button>\x3c!--/ko--\x3e</span><span class="od-PlaybackPanel-totalTime" data-bind="text:totalTime"></span></div></div>',viewModel:gt,synchronous:!0}),yt=n(1879),St=n(347),Dt=n(39),It=n(58),xt=n(64),Ct=n(104),Ot=function(e){function t(t,n){void 0===n&&(n=xt.e.none);var a=e.call(this)||this;return a.dataStore=new Ct.e(t,n),a}return Object(i.__extends)(t,e),t.prototype.persistBoolean=function(e,t){var n=this,a=this.getValue(t);void 0!==a&&e("true"===a),this.subscribe(e,function(e){return n.setValue(t,String(e))})},t.prototype.persistNumber=function(e,t){var n=this,a=this.getValue(t);void 0!==a&&e(Number(a)),this.subscribe(e,function(e){return n.setValue(t,String(e))})},t.prototype.persistString=function(e,t){var n=this,a=this.getValue(t);void 0!==a&&e(a),this.subscribe(e,function(e){return n.setValue(t,e)})},t.prototype.setValue=function(e,t,n){this.dataStore.setValue(e,t,n)},t.prototype.getValue=function(e,t){return this.dataStore.getValue(e,t)},t.prototype.remove=function(e,t){this.dataStore.remove(e,t)},t}(It.n),wt=n(322),Et=n(680),At=n(33),Lt=Object(Et.e)({eventName:"VideoLoad,Qos,",shortEventName:"VideoLoad"},{playbackType:{typeRef:se.t,type:At.e.Enum},errorType:{typeRef:f,type:At.e.Enum},errorMessage:At.e.String,sequence:At.e.Number,instance:At.e.Number,fileExtension:At.e.String,fileDuration:At.e.Number,fileBitrate:At.e.Number,width:At.e.Number,height:At.e.Number,fourCC:At.e.String,audioFormat:At.e.String,videoUseCdn:At.e.Boolean,videoEnableEncryption:At.e.Boolean,playbackSessionId:At.e.String,reason:At.e.String,contentCategory:At.e.String},me.e);!function(e){e[e.unknown=0]="unknown",e[e.closed=1]="closed",e[e.paused=2]="paused",e[e.ended=3]="ended",e[e.failed=4]="failed"}(ft||(ft={}));var kt,Mt=ft,Pt=Object(Et.e)({eventName:"VideoSession,Qos,",shortEventName:"VideoSession"},{playbackType:{typeRef:se.t,type:At.e.Enum},errorType:{typeRef:f,type:At.e.Enum},errorMessage:At.e.String,sequence:At.e.Number,instance:At.e.Number,fileExtension:At.e.String,fileDuration:At.e.Number,fileBitrate:At.e.Number,cameraMake:At.e.String,cameraModel:At.e.String,quality:At.e.Number,maxQuality:At.e.Number,width:At.e.Number,height:At.e.Number,fourCC:At.e.String,audioFormat:At.e.String,endReason:{typeRef:ft,type:At.e.Enum},videoUseCdn:At.e.Boolean,videoEnableEncryption:At.e.Boolean,videoSegmentCacheHitCount:At.e.Number,videoSegmentCacheMissCount:At.e.Number,playTimeMs:At.e.Number,rebufferingTimeMs:At.e.Number,playbackSessionId:At.e.String,isFallback:At.e.Boolean,contentCategory:At.e.String},me.e),Tt=n(1651),Ut=!n(8).e.isActivated("DA910F66-8C98-428B-8A0F-C9BDE6481EB9","08/26/2022","Perform extra sanitization prior to logging extension, part 2");!function(e){e.seeking="seeking",e.rebuffering="rebuffering",e.startup="startup"}(kt||(kt={}));var Ft,Ht,Rt=0,Nt=function(e){function t(t){var n=e.call(this,t)||this,a=t.context,i=t.clientId;return n._context=a,n._clientId=i,n.createComputed(n._computeResetInstance),n.createBackgroundComputed(n._computeReportLoad).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}}),n.createBackgroundComputed(n._computeReportSession).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}}),n}return Object(i.__extends)(t,e),t.prototype.dispose=function(){this._loadEvent&&this._reportLoadEnd({isDisposed:!0}),this._sessionEvent&&this._reportSessionEnd({isDisposed:!0}),e.prototype.dispose.call(this)},t.prototype._computeResetInstance=function(){this._context.itemKey(),this._instanceNumber=++Rt,this._loadSequenceNumber=0,this._sessionSequenceNumber=0},t.prototype._computeReportLoad=function(){this._loadEvent?this._context.isLoading()||this._reportLoadEnd():this._context.isLoading()&&this._reportLoadStart()},t.prototype._computeReportSession=function(){this._sessionEvent?this._context.isPlaying()||this._reportSessionEnd():this._context.isPlaying()&&this._reportSessionStart()},t.prototype._reportLoadStart=function(){var e,t,n=this._context.item.peek(),a=n.audio,r=n.video,o=(n.extension||"").toLowerCase(),s=Ut&&o?Object(Tt.e)(o):o,c=Object(i.__assign)(Object(i.__assign)({clientId:this._clientId},(null===(e=n.photo)||void 0===e?void 0:e.isLivePhoto)&&Object(ue.isFeatureEnabled)(ue.EnableLivePhotoVideos)?{isLivePhoto:!0}:{}),(null===(t=n.photo)||void 0===t?void 0:t.isSamsungMotionPhoto)&&Object(ue.isFeatureEnabled)(ue.EnableSamsungMotionPhotoVideos)?{isSamsungMotionPhoto:!0}:{});this._loadEvent=new Lt(Object(i.__assign)(Object(i.__assign)({name:"Video.Load",videoUseCdn:this._context.isPlaybackCDNEnabled(),videoEnableEncryption:this._context.isPlaybackEncryptionEnabled(),fileExtension:s,fileDuration:(r||a).duration,playbackSessionId:this._context.playbackSessionId,reason:this._context.isSeeking.peek()?kt.seeking:this._context.startupCompleted?kt.rebuffering:kt.startup},r?{fileBitrate:r.bitrate,width:r.width,height:r.height,audioFormat:r.audioFormat,fourCC:r.fourCC}:{}),{instance:this._instanceNumber,sequence:this._loadSequenceNumber,extraData:c})),this._loadSequenceNumber++},t.prototype._reportLoadEnd=function(e){var t,n=(void 0===e?{}:e).isDisposed,a=void 0!==n&&n,r=this._context.videoStatus.peek(),o=r.error,s=o&&o.type,d=o&&o.message,l=o&&o.stack,u=o&&o.data,f=o&&o.isExpected;t=a?c.e.ExpectedFailure:r.isVisible?c.e.Failure:c.e.Success,t=f?c.e.ExpectedFailure:t;var p=!1,m=!1;this._context.isPlaybackCDNEnabled()&&(p=this._context.dashlingVideoTelemetry.isServerSideFallback,m=this._context.dashlingVideoTelemetry.isNoEncryptionCDNPlayback),this._loadEvent.end({resultType:t,errorType:s,errorMessage:d,contentCategory:this._getContentCategory(),playbackType:this._context.playbackType.peek(),extraData:Object(i.__assign)(Object(i.__assign)({VideoError_stack:l,VideoError_data:u},this._context.dashlingVideoTelemetry.getExtraData()),{isServerSideFallback:p,isNoEncryptionCDNPlayback:m,isHybridPlaybackEnabled:this._context.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingHybridPlayback),clientId:this._clientId}),videoUseCdn:this._context.isPlaybackCDNEnabled()&&!p,videoEnableEncryption:this._context.isPlaybackEncryptionEnabled()&&!m&&!p}),this._loadEvent=null,this._context.resetLoadTelemetry()},t.prototype._reportSessionStart=function(){var e,t,n=this._context.item.peek(),a=n.audio,r=n.video,o=(n.extension||"").toLowerCase(),s=Ut&&o?Object(Tt.e)(o):o;this._sessionEvent=new Pt(Object(i.__assign)(Object(i.__assign)(Object(i.__assign)(Object(i.__assign)({name:"Video.Session",videoUseCdn:this._context.isPlaybackCDNEnabled(),videoEnableEncryption:this._context.isPlaybackEncryptionEnabled(),fileExtension:s,fileDuration:(r||a).duration,playbackSessionId:this._context.playbackSessionId},r?{fileBitrate:r.bitrate,cameraMake:r.cameraMake,cameraModel:r.cameraModel,width:r.width,height:r.height,audioFormat:r.audioFormat,fourCC:r.fourCC}:{}),{quality:this._context.playingQuality.peek(),maxQuality:this._context.maxQuality.peek(),instance:this._instanceNumber,sequence:this._sessionSequenceNumber}),(null===(e=n.photo)||void 0===e?void 0:e.isLivePhoto)&&Object(ue.isFeatureEnabled)(ue.EnableLivePhotoVideos)?{extraData:{isLivePhoto:!0}}:{}),(null===(t=n.photo)||void 0===t?void 0:t.isSamsungMotionPhoto)&&Object(ue.isFeatureEnabled)(ue.EnableSamsungMotionPhotoVideos)?{extraData:{isSamsungMotionPhoto:!0}}:{}));var c=r?"Video":"Audio";this._sessionQosEvent=new me.e({name:"ItemViewer.".concat(c,".Session"),extraData:{extension:s}}),this._sessionSequenceNumber++},t.prototype._reportSessionEnd=function(e){var t,n,a=(void 0===e?{}:e).isDisposed,r=void 0!==a&&a,o=this._context,s=o.videoStatus.peek(),d=s.error,l=d&&d.code,u=d&&d.correlationId,p=d&&d.isExpected,m=d&&d.message,_=d&&d.type,h=d&&d.stack,b=d&&d.data,g=this._sessionQosEvent,v=g.data.extraData,y=u?Object(i.__assign)(Object(i.__assign)({},v),{CorrelationId:u}):v,S=_?f[_]:"";if(l&&(S+=".".concat(l)),r)t=c.e.ExpectedFailure,n=Mt.closed;else if(s.isVisible)t=c.e.Failure,n=Mt.failed;else{var D=o.position.peek()/o.duration.peek()>.99,I=!o.isPlaying.peek();t=c.e.Success,n=D?Mt.ended:I?Mt.paused:Mt.unknown}t=p?c.e.ExpectedFailure:t,g.end({resultCode:S||Mt[n],resultType:t,error:m,extraData:y});var x=0,C=0,O=0,w=0,E=!1,A=!1;this._context.isPlaybackCDNEnabled()&&(x=this._context.dashlingVideoTelemetry.cacheHitCount,C=this._context.dashlingVideoTelemetry.cacheMissCount,O=this._context.dashlingVideoTelemetry.cacheHitBytes,w=this._context.dashlingVideoTelemetry.cacheMissBytes,E=this._context.dashlingVideoTelemetry.isServerSideFallback,A=this._context.dashlingVideoTelemetry.isNoEncryptionCDNPlayback),this._sessionEvent.end({resultType:t,errorType:_,resultCode:S,endReason:n,errorMessage:m,playTimeMs:this._context.getTotalPlayTimeMs(),rebufferingTimeMs:this._context.getTotalRebufferingTimeMs(),contentCategory:this._getContentCategory(),playbackType:this._context.playbackType.peek(),extraData:{VideoError_stack:h,VideoError_data:b,videoSegmentCacheHitBytes:O,videoSegmentCacheMissBytes:w,sessionSegmentReqCount:this._context.dashlingVideoTelemetry.sessionSegmentReqCount,isServerSideFallback:E,isNoEncryptionCDNPlayback:A,isHybridPlaybackEnabled:this._context.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingHybridPlayback),totalNonCDNTranscodeCount:this._context.dashlingVideoTelemetry.totalNonCDNCount},videoSegmentCacheHitCount:x,videoSegmentCacheMissCount:C,isFallback:this._context.isFallback,videoUseCdn:this._context.isPlaybackCDNEnabled()&&!E,videoEnableEncryption:this._context.isPlaybackEncryptionEnabled()&&!A&&!E}),this._sessionEvent=null,this._sessionQosEvent=null,this._context.resetSessionTelemetry()},t.prototype._getContentCategory=function(){var e,t=this._context.videoMetaData.peek();return(null===(e=null==t?void 0:t.media)||void 0===e?void 0:e.mediaSource)?t.media.mediaSource.contentCategory:"Unknown"},t}(It.n),Bt=function(){function e(e){this.cacheHitCount=0,this.cacheMissCount=0,this.cacheHitBytes=0,this.cacheMissBytes=0,this.sessionSegmentReqCount=0,this.manifestCalls=0,this.manifestCallsRetries=0,this.manifestCallsFailures=0,this.protectionKeyCalls=0,this.protectionKeyCallsRetries=0,this.protectionKeyCallsFailures=0,this.transcodeCalls=0,this.transcodeCallsRetries=0,this.transcodeCallsFailures=0,this.manifestResponseTimeMs=0,this.protectionKeyResponseTimeMs=0,this.transcodeResponseTimeMs=0,this.transcodeCallsFromBrowserCache=0,this.transcodeCallsCDNCacheHitCount=0,this.transcodeCallsCDNCacheMissCount=0,this.manifestCallsFromBrowserCache=0,this.manifestParseTimeMs=0,this.transcodeDecryptionTimeMs=0,this.manifestCorrelationId="",this.transcodeCdnRefIds="",this.totalCacheHitCount=0,this.totalCacheMissCount=0,this.isServerSideFallback=!1,this.isNoEncryptionCDNPlayback=!1,this.transcodeCallsUnknown=0,this.transcodeCallsNonCdn=0,this.totalNonCDNCount=0,this.totalConsecutiveRetries=0,this.maxConsecutiveRetries=0,this.totalTranscodeCallsFailures=0,this.totalTranscodeCallsRetries=0,this.totalTranscodeCallsFromBrowserCache=0,this.loadRequestFailureCount=0,this.lastManifestResponseTimeMs=0,this.lastTranscodeResponseTimeMs=0,this.transcodeResponseTimes={count_under250ms:0,count_250msTo499ms:0,count_500msTo999ms:0,count_1000msTo2499ms:0,count_2500msTo4999ms:0,count_5000msTo9999ms:0,count_10000msTo24999ms:0,count_above25000ms:0},this.requestedSegmentsDistanceFromPlayPosition={previousSegments:0,zeroSegments:0,oneSegment:0,twoSegments:0,threeToSixSegments:0,sevenToTenSegments:0,elevenToFourteenSegments:0,fifteenPlusSegments:0},this._context=e}return e.prototype.resetDashlingLoadTelemetry=function(){this.manifestCalls=0,this.manifestCallsRetries=0,this.manifestCallsFailures=0,this.protectionKeyCalls=0,this.protectionKeyCallsRetries=0,this.protectionKeyCallsFailures=0,this.transcodeCalls=0,this.transcodeCallsRetries=0,this.transcodeCallsFailures=0,this.manifestResponseTimeMs=0,this.protectionKeyResponseTimeMs=0,this.transcodeResponseTimeMs=0,this.transcodeCallsFromBrowserCache=0,this.transcodeCallsCDNCacheHitCount=0,this.transcodeCallsCDNCacheMissCount=0,this.manifestCallsFromBrowserCache=0,this.manifestParseTimeMs=0,this.transcodeDecryptionTimeMs=0,this.manifestCorrelationId="",this.transcodeCdnRefIds="",this.transcodeCallsUnknown=0,this.transcodeCallsNonCdn=0},e.prototype.resetDashlingSessionTelemetry=function(){this.cacheHitCount=0,this.cacheMissCount=0,this.cacheHitBytes=0,this.cacheMissBytes=0,this.sessionSegmentReqCount=0,this.isServerSideFallback=!1,this.isNoEncryptionCDNPlayback=!1,this.totalNonCDNCount=0},e.prototype.getExtraData=function(){return{manifestCalls:this.manifestCalls,manifestCallsRetries:this.manifestCallsRetries,manifestCallsFailures:this.manifestCallsFailures,protectionKeyCalls:this.protectionKeyCalls,protectionKeyCallsRetries:this.protectionKeyCallsRetries,protectionKeyCallsFailures:this.protectionKeyCallsFailures,transcodeCalls:this.transcodeCalls,transcodeCallsRetries:this.transcodeCallsRetries,transcodeCallsFailures:this.transcodeCallsFailures,manifestResponseTimeMs:this.manifestResponseTimeMs,protectionKeyResponseTimeMs:this.protectionKeyResponseTimeMs,transcodeResponseTimeMs:this.transcodeResponseTimeMs,transcodeCallsFromBrowserCache:this.transcodeCallsFromBrowserCache,transcodeCallsCDNCacheHitCount:this.transcodeCallsCDNCacheHitCount,transcodeCallsCDNCacheMissCount:this.transcodeCallsCDNCacheMissCount,manifestCallsFromBrowserCache:this.manifestCallsFromBrowserCache,manifestParseTimeMs:this.manifestParseTimeMs,transcodeDecryptionTimeMs:this.transcodeDecryptionTimeMs,manifestCorrelationId:this.manifestCorrelationId,transcodeCdnRefIds:this.transcodeCdnRefIds,transcodeCallsUnknown:this.transcodeCallsUnknown,transcodeCallsNonCdn:this.transcodeCallsNonCdn}},e.prototype.handleResponseMetaData=function(e){if(e&&e.headers&&-1!==["init","media"].indexOf(e.requestType)){var t=e.headers;"TCP_HIT"===t["x-cache"]||"TCP_REMOTE_HIT"===t["x-cache"]?(this.cacheHitCount++,this.totalCacheHitCount++,e.bytesLoaded&&(this.cacheHitBytes+=e.bytesLoaded)):"TCP_MISS"===t["x-cache"]?(this.cacheMissCount++,this.totalCacheMissCount++,e.bytesLoaded&&(this.cacheMissBytes+=e.bytesLoaded)):e.isCDNEnabled||this.totalNonCDNCount++}},e.prototype.handleAPIStats=function(e){if(e)switch(e.requestType){case"manifest":this._publishManifestAPIStats(e);break;case"key":this._publishProtectionKeyAPIStats(e);break;case"init":case"media":this._publishTranscodeAPIStats(e)}},e.prototype.handleOperationStats=function(e){if(e)switch(e.operationName){case"manifestParse":this.manifestParseTimeMs+=e.processingTimeMs?e.processingTimeMs:0;break;case"decryptionTime":this.transcodeDecryptionTimeMs+=e.processingTimeMs?e.processingTimeMs:0}},e.prototype.handleTelemetryInfo=function(e){e&&(this.isServerSideFallback=e.isServerSideFallback,this.isNoEncryptionCDNPlayback=e.isNoEncryptionCDNPlayback)},e.prototype._publishTranscodeAPIStats=function(e){if(e.isRequestStarted){if(this.sessionSegmentReqCount++,e.fragment&&this._context.maxGOPSize.peek()){var t=Math.round((e.fragment.time.startSeconds-this._context.position.peek())/this._context.maxGOPSize.peek());t<=-1?this.requestedSegmentsDistanceFromPlayPosition.previousSegments++:t<1?this.requestedSegmentsDistanceFromPlayPosition.zeroSegments++:t<2?this.requestedSegmentsDistanceFromPlayPosition.oneSegment++:t<3?this.requestedSegmentsDistanceFromPlayPosition.twoSegments++:t<7?this.requestedSegmentsDistanceFromPlayPosition.threeToSixSegments++:t<11?this.requestedSegmentsDistanceFromPlayPosition.sevenToTenSegments++:t<15?this.requestedSegmentsDistanceFromPlayPosition.elevenToFourteenSegments++:this.requestedSegmentsDistanceFromPlayPosition.fifteenPlusSegments++}}else this.transcodeCalls++,e.isCDNEnabled||this.transcodeCallsNonCdn++;if(e.isFailure){this.transcodeCallsFailures++,this.totalTranscodeCallsFailures++,this._context.isLoading.peek()&&this.loadRequestFailureCount++;var n=void 0;try{n=e.xhr&&("arraybuffer"===e.xhr.responseType?String.fromCharCode.apply(null,new Uint8Array(e.xhr.response)):e.xhr.responseText)}catch(e){n="Failed to parse message"}be.t.raise(this._context,"onLoadRequestFailure",{error:e.xhr&&e.xhr.status,message:n,streamType:e.streamType,requestType:e.requestType,segmentStartTime:e.fragment&&e.fragment.time&&e.fragment.time.start,correlationId:e.correlationId})}if(e.isRequestStarted||(e.isRetry?(this.transcodeCallsRetries++,this.totalConsecutiveRetries++,this.totalTranscodeCallsRetries++,this.maxConsecutiveRetries=this.maxConsecutiveRetries<this.totalConsecutiveRetries?this.totalConsecutiveRetries:this.maxConsecutiveRetries):this.totalConsecutiveRetries=0),e.responseTimeMs){var a=e.responseTimeMs;this.transcodeResponseTimeMs+=a,this.lastTranscodeResponseTimeMs=a,a<250?this.transcodeResponseTimes.count_under250ms++:a<500?this.transcodeResponseTimes.count_250msTo499ms++:a<1e3?this.transcodeResponseTimes.count_500msTo999ms++:a<2500?this.transcodeResponseTimes.count_1000msTo2499ms++:a<5e3?this.transcodeResponseTimes.count_2500msTo4999ms++:a<1e4?this.transcodeResponseTimes.count_5000msTo9999ms++:a<25e3?this.transcodeResponseTimes.count_10000msTo24999ms++:this.transcodeResponseTimes.count_above25000ms++}e.isBrowserCached&&(this.transcodeCallsFromBrowserCache++,this.totalTranscodeCallsFromBrowserCache++),e.isCDNCacheHit&&this.transcodeCallsCDNCacheHitCount++,e.isCDNCacheMiss&&this.transcodeCallsCDNCacheMissCount++,e.isRequestStarted||e.isBrowserCached||e.isFailure||e.isCDNCacheHit||e.isCDNCacheMiss||!e.isCDNEnabled||this.transcodeCallsUnknown++,e.cdnRefIds&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingCdnRefIdsTelemetry)&&(this.transcodeCdnRefIds+="###"+e.cdnRefIds+"###")},e.prototype._publishProtectionKeyAPIStats=function(e){e.isRequestStarted||this.protectionKeyCalls++,e.isFailure&&this.protectionKeyCallsFailures++,e.isRetry&&this.protectionKeyCallsRetries++,e.responseTimeMs&&(this.protectionKeyResponseTimeMs+=e.responseTimeMs)},e.prototype._publishManifestAPIStats=function(e){e.isRequestStarted||this.manifestCalls++,e.isFailure&&this.manifestCallsFailures++,e.isRetry&&this.manifestCallsRetries++,e.isBrowserCached&&this.manifestCallsFromBrowserCache++,e.responseTimeMs&&(this.manifestResponseTimeMs+=e.responseTimeMs,this.lastManifestResponseTimeMs=e.responseTimeMs),e.correlationId&&(this.manifestCorrelationId=e.correlationId)},e}(),jt=n(253),Vt=function(){function e(){}return e.checkFlashSupport=function(t,n){Ft?n(e._isVersionAcceptable(t)):e._evaluateFlash(t,n)},e._evaluateFlash=function(t,n){var a,i=10,r=document.body;if(window.ActiveXObject)try{var o=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");Ft=o?e._parseVersionString(o.Getletiable("$version")):[]}catch(e){Ft=[]}finally{s(e._isVersionAcceptable(t))}else(a=jt.e.ce("OBJECT")).style.position="absolute",a.style.left="99999px",a.setAttribute("type","application/x-shockwave-flash"),r.appendChild(a),function n(){var o;try{o=a.GetVariable("$version")}catch(e){}o?(Ft=e._parseVersionString(o),s(e._isVersionAcceptable(t))):i>0?(i--,setTimeout(n,10)):(r.removeChild(a),Ft=[],s(!1))}();function s(e){try{n(e)}catch(e){de.e.log(e)}}},e._parseVersionString=function(e){var t=(e||"").split(" "),n=t.length>1?t[1].split(","):"";return n.length>2?[parseInt(n[0],10),parseInt(n[1],10),parseInt(n[2],10)]:[]},e._isVersionAcceptable=function(e){return!(!e||3!==e.length||3!==Ft.length||!(Ft[0]>e[0]||Ft[0]===e[0]&&Ft[1]>e[1]||Ft[0]===e[0]&&Ft[1]===e[1]&&Ft[2]>=e[2]))},e}(),zt=function(){function e(){}return e.flash="flash",e.html="html",e}(),Gt=n(67),Kt=n(119),Wt=n(2486),qt=function(){function e(e,t){this._offlineDetection=t.offlineDetection}return e.prototype.testConnectivity=function(e){return this._offlineDetection.offline?Promise.reject(new b.e({code:"Offline",message:"Device is offline",isExpected:!0})):Promise.resolve()},e}(),Qt=Object(Kt.r)("ConnectivityTester",qt,{offlineDetection:Wt.e}),Yt=n(244);!function(e){e.sourceset="sourceset",e.loadedmetadata="loadedmetadata",e.aeskeyfetched="aeskeyfetched",e.canplaythrough="canplaythrough",e.canplay="canplay",e.pause="pause",e.waiting="waiting",e.playing="playing",e.ended="ended",e.intervalHeartbeat="intervalheartbeat",e.error="error",e.closed="closed",e.sourcesetTimeout="sourcesettimeout",e.longwait="longwait",e.audioEnhancementEnabled="audioEnhancementEnabled",e.audioEnhancementDisabled="audioEnhancementDisabled",e.onLoadRequestFailure="onLoadRequestFailure",e.missingsegmentdetected="missingsegmentdetected",e.manifestfetched="manifestfetched",e.mediasourceinitstarted="mediasourceinitstarted",e.mediasourceinitialized="mediasourceinitialized",e.playerstalldetected="playerstalldetected"}(Ht||(Ht={}));var Jt,Xt,Zt,$t,en,tn,nn=Object(Yt.e)({eventName:"VideoHeartbeat,",shortEventName:"VideoHeartbeat",requiresParent:!1},{name:At.e.String,triggerType:At.e.String,itemId:At.e.String,autoplay:At.e.Boolean,playTime:At.e.Number,timeToSourceSetMS:At.e.Number,rebufferingTime:At.e.Number,rebufferingCount:At.e.Number,waitingTime:At.e.Number,waitingCount:At.e.Number,currrentTime:At.e.Number,playbackType:At.e.String,playbackTech:At.e.String,enableCdn:At.e.Boolean,enableEncryption:At.e.Boolean,videoSegmentCacheHitCount:At.e.Number,videoSegmentCacheMissCount:At.e.Number,duration:At.e.Number,playbackSessionId:At.e.String,loadTimeMS:At.e.Number,contentCategory:At.e.String,maxQuality:At.e.Number,totalQualityLevels:At.e.Number,averageBandwidthBPS:At.e.Number,captionsEnabled:At.e.Boolean,captionsAvailable:At.e.Boolean,mediaType:At.e.String,timeSinceSourceSetMS:At.e.Number,clientId:At.e.String,isEmbed:At.e.Boolean,isFallback:At.e.Boolean,fallbackCount:At.e.Number,isPageVisible:At.e.Boolean,modeBitrate:At.e.Number,isABREnabled:At.e.Boolean,abrQualityLimit:At.e.Number,errorInfo:At.e.Object,extraData:At.e.Object,isLoaded:At.e.Boolean,isDownloadBlocked:At.e.Boolean,largestRebufferingInterval:At.e.Number,largestWaitingInterval:At.e.Number,gopSize:At.e.Number,bufferAheadTimeRanges:At.e.String,correlationId:At.e.String,isOnline:At.e.Number,numLongWaits:At.e.Number,captionsInfo:At.e.Object,metaDataInfo:At.e.Object,audioEnhancementEnabled:At.e.Boolean,audioEnhancementAvailable:At.e.Boolean,intentionalSeekCount:At.e.Number,dashlingLoadedSegmentsDistanceFromPlayPosition:At.e.Object,dashlingTranscodeResponseTimes:At.e.Object,dashlingTranscodeFailureCount:At.e.Number,dashlingTranscodeRetryCount:At.e.Number,dashlingTranscodeServedFromBrowserCache:At.e.Number,transcodeType:At.e.String,isNoEncryptionCDNPlayback:At.e.Boolean,fileBitrate:At.e.Number,cameraMake:At.e.String,cameraModel:At.e.String,width:At.e.Number,height:At.e.Number,audioFormat:At.e.String,fourCC:At.e.String,metaUrl:At.e.String,isHybridPlaybackEnabled:At.e.Boolean,isServerSideFallback:At.e.Boolean,wasPageInBackgroundDuringLoad:At.e.Boolean,extension:At.e.String,dashlingMaxBufferSeconds:At.e.Number,featureFlag:At.e.Object,clientStreamingSupportType:At.e.String,isServiceStreamingSupported:At.e.Boolean,timeFromCanPlayThroughToPlayingMS:At.e.Number,timeToFirstPlayingMS:At.e.Number,timeFromPlayButtonPressToPlayingMS:At.e.Number,timeToPlayerCreationMS:At.e.Number,timeToManifestFetchMS:At.e.Number,timeToAesKeyFetchMS:At.e.Number,timeToMediaSourceInitMS:At.e.Number,playerStallDetectedCount:At.e.Number,missingSegmentDetectedCount:At.e.Number,timeSpentWaitingForMediaSrcInitMS:At.e.Number,timeToCanPlayMS:At.e.Number,isCopyCodecEnabled:At.e.Boolean,debugInfo:At.e.Object,isUsingDownloadAspxForProgressive:At.e.Boolean,isSettingManifestMetadataQsp:At.e.Boolean,mediaServiceName:At.e.String,timeSpentInBackgroundDuringLoadMS:At.e.Number,totalTimeSpentInBackgroundMS:At.e.Number,transcodeFailureCountDuringWaiting:At.e.Number,dashlingRequestTimeoutMS:At.e.Number,dashlingRequestStaggerTimeMultiple:At.e.Number,isPretranscodeEnabled:At.e.Boolean,pretranscodeSegmentCount:At.e.Number,initialPlaybackQuality:At.e.String,lastManifestResponseTimeMs:At.e.Number,lastTranscodeResponseTimeMs:At.e.Number}),an=n(1022),rn=n(267),on=performance&&performance.now?performance:Date,sn=document,cn=function(){function e(){var e=this;this.handleVisibilityChange=function(){sn.visibilityState===e.hidden?e.timeAtStartInBackgroundMS=on.now():(e.timeAtEndInBackgroundMS=on.now(),e.timeSpentInBackgroundMS+=e.timeAtEndInBackgroundMS-e.timeAtStartInBackgroundMS)},this.timeSpentInBackgroundMS=0,void 0!==sn.hidden?(this.hidden="hidden",this.visibilityChange="visibilitychange"):void 0!==sn.msHidden?(this.hidden="msHidden",this.visibilityChange="msvisibilitychange"):void 0!==sn.webkitHidden&&(this.hidden="webkitHidden",this.visibilityChange="webkitvisibilitychange"),void 0===document.addEventListener||void 0===this.hidden?console.log("The browser does not support loading video telemtry"):(sn.hidden&&(this.timeAtStartInBackgroundMS=on.now()),sn.addEventListener(this.visibilityChange,this.handleVisibilityChange,!1))}return e.prototype.getTimeInBackgroundMS=function(){return!this.timeAtEndInBackgroundMS&&this.timeAtStartInBackgroundMS?on.now()-this.timeAtStartInBackgroundMS:this.timeAtEndInBackgroundMS<this.timeAtStartInBackgroundMS?this.timeSpentInBackgroundMS+on.now()-this.timeAtStartInBackgroundMS:this.timeSpentInBackgroundMS},e.prototype.dispose=function(){sn.removeEventListener(this.visibilityChange,this.handleVisibilityChange,!1)},e}(),dn=performance&&performance.now?performance:Date,ln=1e3,un=2e3,fn=!pe.e.isActivated("8FF9D4EB-4EA1-414A-80F5-E317C2BA3B02","09/04,2020","Controls if regular interval heartbeat are sent or not"),pn=!pe.e.isActivated("57dbfea7-5c1d-4334-a701-2d79f3ff6deb","06/21,2021","Controls if log precise current time"),mn=!pe.e.isActivated("48630fd0-31e2-4652-8c3f-ba5698058823","07/26,2022","Controls if the log should include mediaServiceName that is calculated by this.getMediaStorageServiceName"),_n=function(e){function t(t){var n=e.call(this,t)||this;return n._handlePlaybackEvent=function(e,t){var a=n._mapToTriggerTypes(e);if(n._isLoaded||n._wasPageInBackgroundDuringLoad||(n._wasPageInBackgroundDuringLoad="visible"!==document.visibilityState),a){if(a===Ht.canplay&&n._isLoaded)return;if(a===Ht.canplaythrough&&n._isLoaded)return;if(a===Ht.sourceset){var i=n._context.transcodeType();if(i===te.FFMPEG||i===te.MediaFoundation){n._isSettingManifestMetadataQsp=!1;try{var r=(/[Mm]anifestMetadata=([^&]*)/g.exec(n._context.url.peek())||[])[1];null!=r&&(n._isSettingManifestMetadataQsp=""!==r)}catch(e){n._isSettingManifestMetadataQsp=!1}}if(n._sourceSetReceived)return;n._loadingVideoTelemetry=new cn,n._timeAtSourceSetMS=dn.now(),n._timeToSourceSetMS=n._timeAtSourceSetMS-n._timeAtStart,n._sourceSetReceived=!0,n._sourceSetTimeoutTimer=n.async.setTimeout(function(){n._sendHeartbeat(Ht.sourcesetTimeout)},2e4)}else if(a===Ht.pause){if(n._cleanUpAllTimers(),!n._isPlaying)return;n._isPlaying=!1}else if(a===Ht.waiting){if(!n._isPlaying)return;n._isPlaying=!1,n._isWaiting=!0,n._waitingCount++,n._context.isSeeking.peek()||(n._timeAtBufferingStart=dn.now(),n._rebufferingCount++),n._timeAtWaitingStart=dn.now(),n._setLongWaitingTimer()}else if(a===Ht.playing){if(n._clearLongWaitTimer(),n._updateRebufferingAndWaitingTime(),!n._timeToFirstPlayingMS){var o=dn.now();n._timeToFirstPlayingMS=o-n._timeAtSourceSetMS,n._context.timeAtFirstPlay&&(n._timeFromPlayButtonPressToPlayingMS=o-n._context.timeAtFirstPlay)}if(!n._timeFromCanPlayThroughToPlayingMS&&n._timeToFirstPlayingMS&&n._timeToCanPlayThroughMS&&(n._timeFromCanPlayThroughToPlayingMS=n._timeToFirstPlayingMS-n._timeToCanPlayThroughMS),n._isPlaying)return;n._isPlaying=!0,n._recordLoadTime()}else if(a===Ht.ended){if(n._cleanUpAllTimers(),!n._isPlaying)return;n._isPlaying=!1}else if(a===Ht.error)n._cleanUpAllTimers(),n._isPlaying=!1,n._stopListeningForPlaybackEvents();else{if(a===Ht.closed&&!n._isPlaying&&!n._isWaiting&&n._isLoaded)return;if(a===Ht.loadedmetadata)n._initCorrelationId();else if(a!==Ht.manifestfetched||n._timeToManifestFetchMS)if(a!==Ht.aeskeyfetched||n._timeToAesKeyFetchMS){if(a===Ht.playerstalldetected)return void n._playerStallDetectedCount++;if(a===Ht.onLoadRequestFailure)n._currentLoadRequestFailureInfo=t;else{if(a===Ht.missingsegmentdetected)return void n._missingSegmentDetectedCount++;if(a===Ht.mediasourceinitstarted&&!n._isLoaded)return void(n._timeToMediaSourceInitStarted=dn.now()-n._timeAtSourceSetMS);a===Ht.mediasourceinitialized&&!n._isLoaded&&n._timeToMediaSourceInitStarted&&(n._timeToMediaSourceInitMS=dn.now()-n._timeAtSourceSetMS,n._timeSpentWaitingForMediaSrcInitMS=n._timeToMediaSourceInitMS-n._timeToMediaSourceInitStarted)}}else n._timeToAesKeyFetchMS=dn.now()-n._timeAtSourceSetMS;else n._timeToManifestFetchMS=dn.now()-n._timeAtSourceSetMS}n._sendHeartbeat(a)}},n._handleTimeUpdate=function(){n._updateRebufferingAndWaitingTime(),n._isPlaying=!0;var e=Math.round(n._context.position.peek());e>=n._postionAtLastTimeUpdate+1&&!n._context.isSeeking.peek()&&(n._playTime+=1,n._totalPlayedSecondsSinceLastHeartbeat+=1,fn&&n._totalPlayedSecondsSinceLastHeartbeat>Math.round(60)&&n._sendHeartbeat(Ht.intervalHeartbeat)),n._postionAtLastTimeUpdate=e},n._context=t.context,Object(i.__spreadArray)(Object(i.__spreadArray)([],ge,!0),ve,!0).forEach(function(e){"timeupdate"===e?n.events.on(n._context,e,n._handleTimeUpdate):n.events.on(n._context,e,function(t){n._handlePlaybackEvent(e,t)})}),n._clientId=t.clientId,n._postionAtLastTimeUpdate=0,n._playTime=0,n._activeHeartbeatTimer=0,n._iOSVisibilityTimer=0,n._rebufferingTime=0,n._waitingTime=0,n._timeAtLastHeartbeatTimerActivation=0,n._largestRebufferingInterval=0,n._largestWaitingInterval=0,n._numLongWaits=0,n._isPlaying=n._isLoaded=n._isWaiting=n._sourceSetReceived=!1,n._timeAtStart=dn.now(),n._seekCount=0,n._playerStallDetectedCount=0,n._missingSegmentDetectedCount=0,n._platform=new Ie.e,n._isLoaded=!1,n._rebufferingCount=0,n._waitingCount=0,t.timeAtUserInteractionInitiated&&(n._timeToPlayerCreationMS=n._timeAtStart-t.timeAtUserInteractionInitiated),n.createBackgroundComputed(n._onSeekingUpdated),n.scope.attach({dispose:function(){n._handlePlaybackEvent("closed"),n._loadingVideoTelemetry&&n._loadingVideoTelemetry.dispose()}}),n}return Object(i.__extends)(t,e),t.prototype._cleanUpAllTimers=function(){this._updateRebufferingAndWaitingTime(),this.async.clearTimeout(this._activeHeartbeatTimer),this.async.clearTimeout(this._sourceSetTimeoutTimer),this.async.clearInterval(this._iOSVisibilityTimer),this._clearLongWaitTimer()},t.prototype.recordTimeToCanPlay=function(){this._timeToCanPlayMS||(this._timeToCanPlayMS=dn.now()-this._timeAtSourceSetMS)},t.prototype._recordLoadTime=function(){this._isLoaded||(this._isLoaded=!0,this._timeToCanPlayThroughMS=dn.now()-this._timeAtSourceSetMS,this._loadTimeMs=this._timeToCanPlayThroughMS,this.async.clearTimeout(this._sourceSetTimeoutTimer),this._timeSpentInBackgroundDuringLoadMS=this._loadingVideoTelemetry.getTimeInBackgroundMS())},t.prototype._stopListeningForPlaybackEvents=function(){var e=this;ge.forEach(function(t){e.events.off(e._context,t)})},t.prototype._onSeekingUpdated=function(){this._context.isSeeking()&&(this.async.clearTimeout(this._seekTimer),this._seekTimer=this.async.setTimeout(function(){this._seekCount++,this._seekTimer=null}.bind(this),200))},t.prototype._initCorrelationId=function(){this._correlationId=this._context.dashlingVideoTelemetry.manifestCorrelationId},t.prototype._updateRebufferingAndWaitingTime=function(){if(this._isWaiting){if(this._timeAtBufferingStart>0){var e=dn.now()-this._timeAtBufferingStart;this._rebufferingTime+=e,this._timeAtBufferingStart=0;var t=Math.round(e/ln);e>this._largestRebufferingInterval&&(this._largestRebufferingInterval=t)}if(this._timeAtWaitingStart>0){var n=dn.now()-this._timeAtWaitingStart;this._waitingTime+=n,this._timeAtWaitingStart=0;var a=Math.round(n/ln);n>this._largestWaitingInterval&&(this._largestWaitingInterval=a)}this._isWaiting=!1}},t.prototype._isDocumentVisible=function(){return"visible"===document.visibilityState},t.prototype._startDocumentVisibilityTimer=function(){var e=this;this.async.clearInterval(this._iOSVisibilityTimer),this._iOSVisibilityTimer=this.async.setInterval(function(){if(e._isWaiting){var t=Object(se.a)(e._context.playbackType.peek());e._isDocumentVisible()||t!==se.e.hls&&t!==se.e.hlsV6||(e._updateRebufferingAndWaitingTime(),e.async.clearInterval(e._iOSVisibilityTimer))}else e.async.clearInterval(e._iOSVisibilityTimer)},5e3)},t.prototype._setLongWaitingTimer=function(){var e=this;this._isWaiting&&(this._clearLongWaitTimer(),this._longWaitTimer=this.async.setTimeout(function(){e._isWaiting&&(e._numLongWaits++,e._sendHeartbeat(Ht.longwait),e._startDocumentVisibilityTimer())},1e4))},t.prototype._clearLongWaitTimer=function(){this.async.clearTimeout(this._longWaitTimer)},t.prototype._mapToTriggerTypes=function(e){return Ht[e]},t.prototype._getPlayTime=function(){return this._playTime},t.prototype._getRebufferingTime=function(){return this._isWaiting&&this._timeAtBufferingStart>0?dn.now()-this._timeAtBufferingStart+this._rebufferingTime:this._rebufferingTime},t.prototype._getWaitingTime=function(){return this._isWaiting&&this._timeAtWaitingStart>0?dn.now()-this._timeAtWaitingStart+this._waitingTime:this._waitingTime},t.prototype._getMinWaitTimeForHeartbeatWithTriggerType=function(e){return e===Ht.waiting?1e4:6e4},t.prototype._shouldAlwaysReportTriggerType=function(e){return e===Ht.ended||e===Ht.waiting||e===Ht.error||e===Ht.closed||e===Ht.playing||e===Ht.longwait||e===Ht.onLoadRequestFailure||e===Ht.canplaythrough&&!this._isLoaded||e===Ht.canplay&&!this._isLoaded||this._platform.isIOS},t.prototype._shouldSendHeartbeat=function(e){var t=this;if(this._lastHeartbeatTriggerType===Ht.error)return!1;if(!this._sourceSetReceived||e===Ht.intervalHeartbeat&&!fn)return!1;var n=dn.now()-this._lastHeartbeatSentTime,a=this._getMinWaitTimeForHeartbeatWithTriggerType(e),i=dn.now()-this._timeAtLastHeartbeatTimerActivation;return!(e===this._lastHeartbeatTriggerType&&n<a||(i<un||n<un)&&this._isLoaded&&!this._shouldAlwaysReportTriggerType(e)&&(this.async.clearTimeout(this._activeHeartbeatTimer),this._activeHeartbeatTimer=this.async.setTimeout(function(){t._sendHeartbeat(e)},un),this._timeAtLastHeartbeatTimerActivation=dn.now(),1))},t.prototype._getMostRecentPlaybackError=function(){var e=this._context.videoStatus.peek().error;if(e)return e;var t=this._context.fallbackErrors;return t&&t.length>0?t[t.length-1].error:void 0},t.prototype._sendHeartbeat=function(e){var t,n,a,r,o;if(this._shouldSendHeartbeat(e)){e===Ht.canplay?this.recordTimeToCanPlay():e===Ht.canplaythrough&&this._recordLoadTime(),this._totalTimeSpentInBackgroundMS=this._loadingVideoTelemetry&&this._loadingVideoTelemetry.getTimeInBackgroundMS();var s=this._context,c=s.item.peek(),d=c.video,l=this._context.videoMetaData.peek();if(e===Ht.error){var u=this._getMostRecentPlaybackError(),f=u&&u.code,p=u&&u.correlationId,m=u&&u.isExpected,_=u&&u.message,h=u&&u.type,b=u&&u.stack,g=u&&u.data;this._errorInfo={errorMessage:_,errorCode:f,errorType:h&&S[h]||h,errorStack:b,isExpected:m,correlatedId:p||this._context.correlationId.peek(),data:g}}var v=this._context.fallbackErrors;if(v&&v.length>0&&this._videoHeartbeatEvent&&this._videoHeartbeatEvent.data&&this._videoHeartbeatEvent.data.fallbackCount<v.length){this._fallbackErrors=this._fallbackErrors||{};for(var y=this._videoHeartbeatEvent.data.fallbackCount;y<s.fallbackCount;y++){var D="errorFallback_"+(y+1);this._fallbackErrors[D]=Object(i.__assign)({},v[y])}}var I=s.duration.peek();I=isNaN(I)?void 0:I;var x=s.position.peek(),C=Math.round(x),O=this._bufferAheadTimeRanges(pn?x:C),w=void 0!==typeof navigator.onLine?navigator.onLine:void 0,E=!1,A=!1,L=void 0;c&&c.urls&&c.urls[an.e.video]&&(L=new rn.e(c.urls[an.e.video]).authority),s.isPlaybackCDNEnabled()&&(E=s.dashlingVideoTelemetry.isServerSideFallback,A=s.dashlingVideoTelemetry.isNoEncryptionCDNPlayback);var k=s.transcodeType();!this._isUsingDownloadAspxForProgressive&&k===te.None&&s.url.peek()&&(this._isUsingDownloadAspxForProgressive=-1!==s.url.peek().indexOf("download.aspx?"));var M=s.dashling&&s.dashling.peek();this._videoHeartbeatEvent=nn.logData(Object(i.__assign)(Object(i.__assign)({name:"VideoHeartbeat",triggerType:e,itemId:c.itemId,isLoaded:this._isLoaded,playTime:Math.round(this._getPlayTime()),timeToSourceSetMS:this._timeToSourceSetMS,currrentTime:C,rebufferingTime:Math.round(this._getRebufferingTime()/ln),rebufferingCount:this._rebufferingCount,waitingTime:Math.round(this._getWaitingTime()/ln),waitingCount:this._waitingCount,playbackType:s.playbackType.peek(),playbackSessionId:s.playbackSessionId,playbackTech:Object(se.a)(s.playbackType.peek()),timeSinceSourceSetMS:dn.now()-this._timeAtSourceSetMS,isPageVisible:"visible"===document.visibilityState,loadTimeMS:this._loadTimeMs,enableCdn:s.isPlaybackCDNEnabled()&&!E,enableEncryption:s.isPlaybackEncryptionEnabled()&&!A&&!E,isHybridPlaybackEnabled:s.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingHybridPlayback),duration:I&&Math.round(I),isFallback:s.isFallback,isServerSideFallback:s.dashlingVideoTelemetry.isServerSideFallback,isNoEncryptionCDNPlayback:s.dashlingVideoTelemetry.isNoEncryptionCDNPlayback,fallbackCount:s.fallbackCount,clientId:this._clientId,contentCategory:null===(n=null===(t=null==l?void 0:l.media)||void 0===t?void 0:t.mediaSource)||void 0===n?void 0:n.contentCategory,mediaType:d?"video":"audio",videoSegmentCacheHitCount:s.dashlingVideoTelemetry.totalCacheHitCount,videoSegmentCacheMissCount:s.dashlingVideoTelemetry.totalCacheMissCount,maxQuality:s.maxQuality.peek(),autoplay:s.shouldAutoPlay,totalQualityLevels:s.totalQualityLevels.peek(),isABREnabled:s.isABREnabled.peek(),errorInfo:this._errorInfo,largestRebufferingInterval:this._largestRebufferingInterval,largestWaitingInterval:this._largestWaitingInterval,gopSize:this._context.maxGOPSize.peek(),bufferAheadTimeRanges:O&&JSON.stringify(O),correlationId:this._correlationId,numLongWaits:this._numLongWaits,isDownloadBlocked:this._context.isDownloadBlocked(this._context.item.peek()),isOnline:w,extraData:this._fallbackErrors&&Object(i.__assign)({},this._fallbackErrors),metaDataInfo:{externalId:null===(a=null==l?void 0:l.source)||void 0===a?void 0:a.externalId,metaDataFetchTimeMS:this._context.metaDataFetchTimeMS,metaDataFetchError:Object(i.__assign)({},this._context.metaDataFetchError)},captionsInfo:{vttFetchError:Object(i.__assign)({},this._context.vttFetchError),vttFetchTimeMS:this._context.vttFetchTimeMS,vttParseError:this._context.vttParseError,vttParseTimeMS:this._context.vttParseTimeMS,areCaptionsEnabled:!!s.areCaptionsEnabled.peek(),captionsAvailable:!!s.areCaptionsAvailable.peek(),wereCaptionsEnabled:!!this._context.wereCaptionsEnabled},audioEnhancementEnabled:s.showAudioEnhancementButton()?s.audioEnhancementButtonState.peek():void 0,audioEnhancementAvailable:s.showAudioEnhancementButton()},d?{fileBitrate:d.bitrate,cameraMake:d.cameraMake,cameraModel:d.cameraModel,width:d.width,height:d.height,audioFormat:d.audioFormat,fourCC:d.fourCC}:{}),{averageBandwidthBPS:s.dashling.peek()&&this._context.dashling.peek().getAvgBandwidthInBps?Math.round(this._context.dashling.peek().getAvgBandwidthInBps()):void 0,intentionalSeekCount:this._seekCount,dashlingLoadedSegmentsDistanceFromPlayPosition:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.requestedSegmentsDistanceFromPlayPosition?Object(i.__assign)({},s.dashlingVideoTelemetry.requestedSegmentsDistanceFromPlayPosition):void 0,dashlingTranscodeResponseTimes:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.transcodeResponseTimes?Object(i.__assign)({},s.dashlingVideoTelemetry.transcodeResponseTimes):void 0,dashlingTranscodeFailureCount:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.totalTranscodeCallsFailures>=0?s.dashlingVideoTelemetry.totalTranscodeCallsFailures:void 0,dashlingTranscodeRetryCount:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.totalTranscodeCallsRetries>=0?s.dashlingVideoTelemetry.totalTranscodeCallsRetries:void 0,dashlingTranscodeServedFromBrowserCache:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.totalTranscodeCallsFromBrowserCache>=0?s.dashlingVideoTelemetry.totalTranscodeCallsFromBrowserCache:void 0,debugInfo:{dashlingMaxConsecutiveRetries:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.maxConsecutiveRetries,lastLoadRequestFailure:this._currentLoadRequestFailureInfo?Object(i.__assign)({},this._currentLoadRequestFailureInfo):void 0,dashlingRequestTimeoutMS:s.dashling&&s.dashling.peek()&&s.dashling.peek().settings&&s.dashling.peek().settings.requestTimeout},transcodeType:k,metaUrl:L,wasPageInBackgroundDuringLoad:this._wasPageInBackgroundDuringLoad,extension:(c.extension||"").toLowerCase(),dashlingMaxBufferSeconds:s.dashlingSettings&&s.dashlingSettings.maxBufferSeconds?s.dashlingSettings.maxBufferSeconds:void 0,featureFlag:{TMRtoMetaRedirect:Object(ue.isFeatureEnabled)(ue.TMRMetaRedirect),ForceTMRToMediaFoundation:Object(ue.isFeatureEnabled)(ue.ForceTMRToMediaFoundation),EnableHlsPretranscode:Object(ue.isFeatureEnabled)(ue.EnableHlsPretranscode),EnableMaxRequestCount2:Object(ue.isFeatureEnabled)(ue.VideoEnableReducedMaxRequestCount2),EnableMaxRequestCount4:Object(ue.isFeatureEnabled)(ue.VideoEnableReducedMaxRequestCount4),LimitStartingQualityTo480p:Object(ue.isFeatureEnabled)(ue.VideoLimitDefaultStartingQuality480p),EnableForceProgressivePlaybackOnDownloadAspx:Object(ue.isFeatureEnabled)(ue.ForceProgressivePlaybackOnDownloadAspx),FlushingOnlyAudioStreamOnReset:Object(ue.isFeatureEnabled)(ue.FlushingOnlyAudioChunksDuringResettingStreams)},clientStreamingSupportType:s.getPlatformStreamingSupportType(),isServiceStreamingSupported:!(!c.urls||!c.urls[an.e.video]),timeFromCanPlayThroughToPlayingMS:this._timeFromCanPlayThroughToPlayingMS,timeToFirstPlayingMS:this._timeToFirstPlayingMS,timeFromPlayButtonPressToPlayingMS:this._timeFromPlayButtonPressToPlayingMS,timeToPlayerCreationMS:this._timeToPlayerCreationMS,timeToAesKeyFetchMS:this._timeToAesKeyFetchMS,timeToManifestFetchMS:this._timeToManifestFetchMS,timeToMediaSourceInitMS:this._timeToMediaSourceInitMS,playerStallDetectedCount:this._playerStallDetectedCount,missingSegmentDetectedCount:this._missingSegmentDetectedCount,timeSpentWaitingForMediaSrcInitMS:this._timeSpentWaitingForMediaSrcInitMS,timeToCanPlayMS:this._timeToCanPlayMS,isCopyCodecEnabled:s.isCopyCodecEnabled,isUsingDownloadAspxForProgressive:this._isUsingDownloadAspxForProgressive,isSettingManifestMetadataQsp:this._isSettingManifestMetadataQsp,mediaServiceName:mn?this.getMediaStorageServiceName(c):void 0,timeSpentInBackgroundDuringLoadMS:this._timeSpentInBackgroundDuringLoadMS,totalTimeSpentInBackgroundMS:this._totalTimeSpentInBackgroundMS,transcodeFailureCountDuringWaiting:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.loadRequestFailureCount,dashlingRequestTimeoutMS:M&&M.settings&&M.settings.requestTimeout,dashlingRequestStaggerTimeMultiple:M&&M.settings&&M.settings.requestStaggerTimeMultiple,isPretranscodeEnabled:null===(r=null==M?void 0:M.settings)||void 0===r?void 0:r.preTranscode.enabled,pretranscodeSegmentCount:null===(o=null==M?void 0:M.settings)||void 0===o?void 0:o.preTranscode.segmentCount,initialPlaybackQuality:(null==M?void 0:M.getInitialPlaybackQuality())||void 0,lastManifestResponseTimeMs:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.lastManifestResponseTimeMs,lastTranscodeResponseTimeMs:s.dashlingVideoTelemetry&&s.dashlingVideoTelemetry.lastTranscodeResponseTimeMs}),this._videoHeartbeatEvent),this._lastHeartbeatSentTime=dn.now(),this._totalPlayedSecondsSinceLastHeartbeat=0,this._lastHeartbeatTriggerType=e,this._currentLoadRequestFailureInfo=void 0}},t.prototype._bufferAheadTimeRanges=function(e){var t=this._context.rawBufferedTimeRanges.peek();if(t&&t.length>0){for(var n=[],a=0;t&&a<t.length;a++)t.start(a)>e?n.push({start:t.start(a),end:t.end(a)}):t.start(a)<e&&t.end(a)>e&&n.push({start:e,end:t.end(a)});return n}},t.prototype.getMediaStorageServiceName=function(e){var t,n=null===(t=e.graph)||void 0===t?void 0:t.driveType;if(!n)return"mis";switch(n){case"business":return"ODB";case"personal":return"ODC";case"documentLibrary":return"SPO";default:return"unknown"}},t}(It.n),hn=n(29),bn=n(226);!function(e){e.Completed="Completed",e.InProgress="InProgress",e.Closed="Closed"}(Jt||(Jt={})),function(e){e.Play="play",e.Seek="seek",e.Pause="pause",e.None="none"}(Xt||(Xt={})),function(e){e.User="User",e.System="System"}(Zt||(Zt={})),function(e){e.AAD="AAD",e.MSA="MSA"}($t||($t={})),function(e){e.Completed="Completed",e.InProgress="InProgress",e.CompletedMissingStart="CompletedMissingStart"}(en||(en={})),function(e){e.AccessControl="AccessControl",e.CustomerContent="CustomerContent",e.EUII="EUII",e.AccountData="AccountData",e.OII="OII",e.SystemMetaData="SystemMetaData"}(tn||(tn={}));var gn,vn=Object(Yt.e)({eventName:"MediaPlayback,",shortEventName:"MediaPlayback",requiresParent:!1},{playbackType:{typeRef:se.t,type:At.e.Enum},name:At.e.String,startTime:At.e.String,endTime:At.e.String,status:{typeRef:en,type:At.e.Enum},compliance:{typeRef:tn,type:At.e.Enum},locale:At.e.String,aadAppId:At.e.String,appName:At.e.String,appVer:At.e.String,actorType:{typeRef:Zt,type:At.e.Enum},aadTenantId:At.e.String,actorIdType:{typeRef:$t,type:At.e.Enum},actorId:At.e.String,itemType:At.e.String,vroomItemId:At.e.String,containerId:At.e.String,containerType:At.e.String,clientSessionId:At.e.String,isLive:At.e.Boolean,listId:At.e.String,listItemUniqueId:At.e.String,operation:At.e.String,pageMode:At.e.String,playbackSessionId:At.e.String,playbackActivities:At.e.String,playbackPlatform:At.e.String,fileExtension:At.e.String,userType:At.e.String,fileDuration:At.e.Number,endReason:{typeRef:Jt,type:At.e.Enum},vroomDriveId:At.e.String,graphId:At.e.String,signalVersion:At.e.Number,signalGuid:At.e.String}),yn=function(){function e(e,t){this._isPulseRunning=!1,this._onTick=e,this._intervalInMs=null!=t?t:3e5}return e.prototype.start=function(){var e=this;this._isPulseRunning=!0,this._intervalId=window.setInterval(function(){e._isPulseRunning&&e._onTick()},this._intervalInMs)},e.prototype.stop=function(){this._isPulseRunning=!1,void 0!==this._intervalId&&(clearInterval(this._intervalId),this._intervalId=void 0)},e.prototype.reset=function(){this._isPulseRunning&&(this.stop(),this.start())},e}(),Sn=n(321);!function(e){e[e.VideoCompleted=1]="VideoCompleted",e[e.BufferLimitReached=2]="BufferLimitReached",e[e.Pulse=3]="Pulse",e[e.Disposed=4]="Disposed"}(gn||(gn={}));var Dn=function(e){function t(t){var n=e.call(this,t)||this;n._mediaPlaybackEventStartTime=new Date,n._catchPauseInterval=!1,n._seekIntervalStarted=!1,n._mediaPlaybackEventData=void 0,n._eventSentAfterDisposed=!1,n._onBeforeUnload=function(e){n._isDisposed=!0,n._mediaPlaybackPulse.stop(),n._reportMediaPlaybackEnd(gn.Disposed)},n.getPlaybackPlatform=function(){return JSON.stringify({Player:"Dashling"})},n.getSignalId=function(){return Sn.e.generate()},n._getDriveID=function(e){var t;return(null===(t=null==e?void 0:e.graph)||void 0===t?void 0:t.driveId)||n._getDriveIdFromDriveURL()||n._getIDsFromSPItemURL(e)[0]},n._getItemID=function(e){var t;return(null==e?void 0:e.itemId)||(null===(t=null==e?void 0:e.graph)||void 0===t?void 0:t.itemId)||n._getIDsFromSPItemURL(e)[1]},n._getIDsFromSPItemURL=function(e){var t;try{var n=null===(t=null==e?void 0:e.properties[".spItemUrl"])||void 0===t?void 0:t.split(/(?:\/(?:drives|items)\/|[?]version=)/gi);return[n[1],n[2]]}catch(e){return["",""]}},n._getDriveIdFromDriveURL=function(){var e;try{var t=null===(e=n._pageContext)||void 0===e?void 0:e.driveInfo[".driveUrl"];return null==t?void 0:t.substr((null==t?void 0:t.lastIndexOf("/"))+1)}catch(e){return""}},n._getListID=function(){var e;try{return n._parseListIDs(null===(e=n._pageContext)||void 0===e?void 0:e.listId)||n._parseListIDs(n._pageContext.pageListId)}catch(e){return""}},n._getUniqueID=function(e){var t;try{return n._parseListIDs(null===(t=null==e?void 0:e.properties)||void 0===t?void 0:t.uniqueId)||n._parseListIDs(null==e?void 0:e.properties.UniqueId)}catch(e){return""}},n._parseListIDs=function(e){return(e=e&&e.replace("{",""))&&e.replace("}","")},n._getFileDuration=function(e){var t,a,i,r;void 0===e&&(e=void 0);var o=n._context.item.peek(),s=(null===(t=null==o?void 0:o.video)||void 0===t?void 0:t.duration)&&o.video.duration/1e3||(null===(a=null==o?void 0:o.audio)||void 0===a?void 0:a.duration)&&o.audio.duration/1e3||(null===(r=null===(i=n._context)||void 0===i?void 0:i.duration)||void 0===r?void 0:r.peek());return n._isValidNumber(s,!1)?Math.floor(s):e};var a=t.context;return n._context=a,n._mediaPlaybackActivitiesBuffer=[],n._isDisposed=!1,n._pageContext=n.resources.consume(bn.s.optional),n._clientId=t.clientId||"SharePoint Online",n._isVideoCompleted=!1,n._clearCurrentPlaybackActivity(),n.createComputed(n._computeResetInstance),n._events=new be.e(n),n._events.on(window,"beforeunload",n._onBeforeUnload),n._mediaPlaybackPulse=new yn(function(){return n._reportMediaPlaybackEnd(gn.Pulse)}),n._mediaPlaybackPulse.start(),n.createBackgroundComputed(n._computeReportMediaPlayback).extend({rateLimit:{timeout:0,method:"notifyWhenChangesStop"}}),n.scope.attach({dispose:function(){n._isDisposed=!0,n._mediaPlaybackPulse.stop(),n._reportMediaPlaybackEnd(gn.Disposed)}}),n}return Object(i.__extends)(t,e),t.prototype._computeResetInstance=function(){this._context.itemKey()},t.prototype._computeReportMediaPlayback=function(){if(!this._eventSentAfterDisposed){var e={position:this._context.position.peek(),duration:this._getFileDuration(),isSeeking:this._context.isSeeking(),isScrubbing:this._context.isScrubbing(),isPlaying:this._context.isPlaying()};e.isSeeking?this._addNewSeekInterval(e):e.isScrubbing||(e.isPlaying?(this._catchPauseInterval=!0,this._addNewPlayInterval(e)):this._catchPauseInterval&&(this._catchPauseInterval=!1,this._addNewPauseInterval(e)));var t=this._getFileDuration();t&&t>0&&!e.isPlaying&&e.position===t?(this._isVideoCompleted=!0,this._reportMediaPlaybackEnd(gn.VideoCompleted)):this._mediaPlaybackActivitiesBuffer.length>=10&&(t&&t>0&&e.position===t&&(this._isVideoCompleted=!0),this._reportMediaPlaybackEnd(gn.BufferLimitReached))}},t.prototype._addNewPauseInterval=function(e){this._currentPlaybackActivity.endTime=e.position,this._isPlaybackActivityValid(this._currentPlaybackActivity)&&this._mediaPlaybackActivitiesBuffer.push(Object(i.__assign)({},this._currentPlaybackActivity)),this._clearCurrentPlaybackActivity(),this._currentPlaybackActivity={startTime:e.position,endTime:e.position,playbackEvent:Xt.Pause},this._isPlaybackActivityValid(this._currentPlaybackActivity)&&this._mediaPlaybackActivitiesBuffer.push(Object(i.__assign)({},this._currentPlaybackActivity))},t.prototype._addNewPlayInterval=function(e){this._currentPlaybackActivity.playbackEvent=Xt.Play,this._currentPlaybackActivity.startTime=e.position;var t=this._getFileDuration();e.position===t&&(this._currentPlaybackActivity.startTime=0)},t.prototype._addNewSeekInterval=function(e){this._seekIntervalStarted&&e.isScrubbing||(e.isScrubbing?(this._catchPauseInterval&&(this._catchPauseInterval=!1,this._currentPlaybackActivity.endTime=e.position,this._isPlaybackActivityValid(this._currentPlaybackActivity)&&this._mediaPlaybackActivitiesBuffer.push(Object(i.__assign)({},this._currentPlaybackActivity)),this._clearCurrentPlaybackActivity()),this._currentPlaybackActivity.playbackEvent=Xt.Seek,this._currentPlaybackActivity.startTime=e.position,this._seekIntervalStarted=!0):(this._currentPlaybackActivity.playbackEvent=Xt.Seek,this._currentPlaybackActivity.endTime=e.position,this._isPlaybackActivityValid(this._currentPlaybackActivity)&&this._mediaPlaybackActivitiesBuffer.push(Object(i.__assign)({},this._currentPlaybackActivity)),this._clearCurrentPlaybackActivity(),this._seekIntervalStarted=!1))},t.prototype._clearCurrentPlaybackActivity=function(){this._currentPlaybackActivity={startTime:-1,endTime:-1,playbackEvent:Xt.None}},t.prototype._reportMediaPlaybackEnd=function(e){var t,n,a,r,o;if(!(this._eventSentAfterDisposed||e!==gn.Pulse&&!this._isDisposed&&this._mediaPlaybackActivitiesBuffer.length<10&&!this._isVideoCompleted)){var s=this._isDisposed?this._mediaPlaybackActivitiesBuffer.splice(0):this._mediaPlaybackActivitiesBuffer.splice(0,10),c=this._context.item.peek();this._pageContext||(this._pageContext=window._spPageContextInfo),this._context.isPlaying.peek()&&this._currentPlaybackActivity&&this._currentPlaybackActivity.playbackEvent===Xt.Play&&(this._currentPlaybackActivity.endTime=this._context.position.peek(),this._isPlaybackActivityValid(this._currentPlaybackActivity)&&s.push(Object(i.__assign)({},this._currentPlaybackActivity)),this._currentPlaybackActivity={startTime:this._context.position.peek(),endTime:-1,playbackEvent:Xt.Play}),s&&s.length>0&&(void 0===this._mediaPlaybackEventData&&(this._mediaPlaybackEventData={name:"MediaPlayback",startTime:void 0,endTime:void 0,status:en.Completed,compliance:tn.EUII,locale:null===(t=this._pageContext)||void 0===t?void 0:t.currentUICultureName,aadAppId:"00000003-0000-0ff1-ce00-000000000000",appName:this._clientId,appVer:"",actorType:Zt.User,aadTenantId:null===(n=this._pageContext)||void 0===n?void 0:n.aadTenantId,actorIdType:$t.AAD,actorId:null===(a=this._pageContext)||void 0===a?void 0:a.aadUserId,itemType:"File",vroomItemId:this._getItemID(c),containerId:"",containerType:"",clientSessionId:null===(r=this._pageContext)||void 0===r?void 0:r.aadSessionId,isLive:!1,listId:this._getListID(),listItemUniqueId:this._getUniqueID(c),operation:"MediaPlaybackSignaled",pageMode:"Read",playbackType:this._context.playbackType.peek(),playbackSessionId:this._context.playbackSessionId,playbackActivities:"",playbackPlatform:this.getPlaybackPlatform(),fileExtension:((null==c?void 0:c.extension)||"").toLowerCase(),userType:"",fileDuration:void 0,endReason:void 0,vroomDriveId:this._getDriveID(c),graphId:null==c?void 0:c.itemId,signalVersion:2.1,signalGuid:""}),this._mediaPlaybackEventData.fileDuration=this._getFileDuration(-1),this._mediaPlaybackEventData.startTime=this._mediaPlaybackEventStartTime?null===(o=this._mediaPlaybackEventStartTime)||void 0===o?void 0:o.toISOString():(new Date).toISOString(),this._mediaPlaybackEventData.endTime=(new Date).toISOString(),this._mediaPlaybackEventData.playbackActivities=JSON.stringify(s),this._mediaPlaybackEventData.endReason=this._getEndReason(this._isDisposed),this._mediaPlaybackEventData.signalGuid=this.getSignalId(),this._mediaPlaybackEvent=vn.logData(this._mediaPlaybackEventData,this._mediaPlaybackEvent),this._mediaPlaybackEventData.endReason===Jt.Closed&&(this._eventSentAfterDisposed=!0),this._mediaPlaybackEventStartTime=new Date),this._isVideoCompleted=!1}},t.prototype._getEndReason=function(e){return this._getFileDuration()===this._context.position()?Jt.Completed:e?Jt.Closed:Jt.InProgress},t.prototype._isPlaybackActivityValid=function(e){return!(!this._isValidNumber(e.startTime)||!this._isValidNumber(e.endTime)||e.playbackEvent===Xt.Play&&null!==e.startTime&&null!==e.endTime&&e.startTime>=e.endTime)},t.prototype._isValidNumber=function(e,t){return void 0===t&&(t=!0),!(null==e||isNaN(e)||e<0||!t&&0===e)},t}(It.n),In=n(2512),xn=n(86),Cn=[10,0,0],On=performance&&performance.now?performance:Date,wn=!1,En=!1,An=!1,Ln=!1,kn=!1,Mn=0,Pn=!1,Tn=new Ie.e;!function(){var e=document.createElement("video");if(e&&e.canPlayType){try{e.volume=0,Pn=!0}catch(e){return}wn=Hn(e,'video/mp4; codecs="avc1.42E01E, mp4a.40.2"'),An=Hn(e,'audio/wav; codecs="1"'),En=Hn(e,'video/webm; codecs="vp9, opus"'),Ln=Hn(e,"application/vnd.apple.mpegURL")&&(Tn.isMac||Tn.isIOS),kn=!(!wn||!window.MediaSource&&!window.WebKitMediaSource),Tn.isWindows&&Tn.isChrome&&Tn.browserMajor<=34&&(kn=!1),Tn.isSafari&&!Object(ue.isFeatureEnabled)(ue.EnableDASHOnSafari)&&(kn=!1)}}();var Un=[S.htmlDashlingMediaSourceInit,S.htmlDashlingManifestDownload,S.htmlDashlingInitSegmentDownload,S.htmlDashlingMediaSegmentDownload,S.htmlDashlingManifestParse,S.htmlDashlingVideoElementError,S.htmlDashlingSourceBufferInit,S.htmlDashlingSourceBufferAppendException,S.htmlDashlingSourceBufferAppendMissing,S.htmlDashlingWebCryptoInitError,S.htmlDashlingAesKeyFetchError,S.htmlDashlingSegmentDecryptionError,S.htmlDashlingOther],Fn=function(e){function t(t){var n=e.call(this,t)||this;n.item=t.item;var a=n,i=a.observables,r=a.resources;return n._networkTester=r.consume(Qt),n._videoItemDataSource=r.consume(Gt.Oe),n._graphDataSource=r.consume(Gt.y),n._viewParams=r.consume(hn.T),n._dataStore=n.addDisposable(new Ot("VideoPlayer",xt.e.local)),n.itemKey=i.pureCompute(n._computeItemKey),n.shouldAutoPlay=t.autoplay&&!Tn.isMobile,n.shouldUseNativeControls=n._computeShouldUseNativeControls(),n.isPlaybackPanelVisible=t.isPlaybackPanelVisible,n.playbackType=i.create(se.n.htmlDashling),n.isFallback=!1,n.wereCaptionsEnabled=!1,n.url=i.create(null),n.coverImageUrl=i.create(""),n.isLoading=i.create(!1),n.canPlay=i.create(!1),n.isPlaying=i.create(!1),n.isAdjustingVolume=i.create(!1),n.position=i.create(0),n.seekPercentage=i.create(0),n.isSeeking=i.create(!1),n.isScrubbing=i.create(!1),n.isRefreshingToken=i.create(!1),n.duration=i.create(0),n.bufferedRanges=i.createArray(),n.rawBufferedTimeRanges=i.create(null),n.isMaximized=i.create(!1),n.videoStatus=i.create(null),n.playingQuality=i.create(480),n.maxQuality=i.create(720),n.totalQualityLevels=i.create(0),n.maxGOPSize=i.create(0),n.dashling=i.create(),n.dashQualities=i.create([]),n.useBetaTranscode=i.create(Object(ue.isFeatureEnabled)(ue.UseAltTranscodeForDashManifests)),n.enableAudioEnhancement=i.create(Object(ue.isFeatureEnabled)(ue.EnableAudioEnhancement)),n.disableTranscode=i.create(!1),n._errorsByType=i.create({}),n._encryptedPlaybackRequested=!1,n._forcedCdnParam=n.getForcedCdnParam(),n._isDownloadBlocked=n.getBlockDownloadParam(),n.internalTechPlaying=i.create(!1),n.areCaptionsAvailable=i.create(!1),n.areCaptionsEnabled=i.create(!1),n.videoMetaData=i.create(),n.audioEnhancementButtonState=i.create(!1),n.correlationId=i.create(""),n.key=i.create(),n.isKeyFetchReqComplete=i.create(!1),n.keyError=i.create(),n.fallbackErrors=[],n._hmacInfo={expiry:0,symmetricKey:0,algoId:0,digest:"",docidhash:"",state:"IDLE"},Object(ue.isFeatureEnabled)(ue.AllowVideoDiagnostics)&&(n.canShowDiagnostics=!0),n.isMuted=i.create(!1),n._dataStore.persistBoolean(n.isMuted,"isMuted"),n.volume=i.create(1),n._dataStore.persistNumber(n.volume,"volume"),n.desiredQuality=i.create(480),n._dataStore.persistNumber(n.desiredQuality,"desiredQuality"),n.isABREnabled=i.create(!0),n._dataStore.persistBoolean(n.isABREnabled,"isABREnabled"),n.isDiagnosticsEnabled=i.create(!1),n._dataStore.persistBoolean(n.isDiagnosticsEnabled,"isDiagnosticsEnabled"),n.totalPlayTimeMs=0,n.totalRebufferingTimeMs=0,n.lastPlayStartTime=0,n.lastLoadingStartTime=0,n.fallbackCount=0,n.isCopyCodecEnabled=void 0,n.hasError=i.pureCompute(n._computeHasError),n.canvasType=i.pureCompute(n._computeCanvasType),n.canAdjustQuality=i.pureCompute(n._computeCanAdjustQuality),n.subscribe(n.item,n._onItemChanged),n.subscribe(n.isAdjustingVolume,n._onIsAdjustingVolumeChanged),n.subscribe(n.internalTechPlaying,n._onIsInternalTechPlayingChanged),n.subscribe(n.isPlaying,n._onIsPlayingChanged),n.subscribe(n.isLoading,n._onIsLoadingChanged),n.subscribe(n.isRefreshingToken,n._onIsRefreshingToken),n.subscribe(n.isKeyFetchReqComplete,n._onIsKeyFetchReqComplete),n.subscribe(n.areCaptionsEnabled,n._onCaptionsEnabled),n.subscribe(n.audioEnhancementButtonState,n._audioEnhancementAction),n.subscribe(n.videoMetaData,n._onVideoMetaDataChanged),i.backgroundCompute(n._evaluateItemPlayability),i.backgroundCompute(n._audioEnhancementResetStreams),n.dashlingVideoTelemetry=new(n.managed(Bt))(n),n._onItemChanged(n.item.peek()),new(n.managed(Nt))({context:n,clientId:t.clientId,resources:r}),function(){try{var e=window.sessionStorage;return void 0!==e&&(e.setItem("key","value"),e.removeItem("key"),!0)}catch(e){return!1}}()&&"true"===window.sessionStorage.getItem("_isRunningTABTest")||(pe.e.isActivated("49afe775-9ba5-4df5-88a1-1f11dc5b643c","10/19/2022","Killswitch to disable mediaPlaybackSignal on dashling player")||new(n.managed(Dn))({context:n,clientId:t.clientId,resources:r}),Object(ue.isFeatureEnabled)(ue.VideoSessionHeartbeat)&&new(n.managed(_n))({context:n,clientId:t.clientId,timeAtUserInteractionInitiated:t.timeAtUserInteractionInitiated})),n}return Object(i.__extends)(t,e),t.prototype.setVideoStatus=function(e){var t,n,a=e.statusMessage,r=e.error,o=this._errorsByType.peek(),s=this.playbackType.peek();if(pe.e.isActivated("0C19CF54-979D-40E6-8FD9-20BC81221125","05/17/2021","fix existingError check logic"))n=o[s];else{var c=s===se.n.htmlDashling||s===se.n.htmlHls||s===se.n.htmlHlsV6||s===se.n.flashDash;n=o[s]&&!c}var d=Object(ue.isFeatureEnabled)(ue.VideoAttemptFfmpegToMediaFoundationFallback)&&(function(e){return!!e&&-1!==Un.indexOf(e.type)}(r)||s===se.n.htmlHls||s===se.n.htmlHlsV6);if(r&&(r.correlationId=r.correlationId||this.correlationId.peek(),this.fallbackErrors.push({playbackType:s,error:r})),pe.e.isActivated("8D4117A4-399F-4A5C-AF62-5B7CB9E3329A","10/21/2021","Video mode cascade")||n||!function(e){if(!e)return!1;var t=e.type,n=Object(ue.isFeatureEnabled)(ue.VideoModeCascadeTimeout);return t===S.htmlElementNetwork||t===S.htmlElementSrcNotSupported||t===S.htmlElementDecode||(e.isExpected||n&&function(e){var t=e.code;return!!t&&t.indexOf("timeout")>=0}(e))&&(t===S.htmlDashlingManifestDownload||t===S.htmlDashlingInitSegmentDownload||t===S.htmlDashlingMediaSegmentDownload)}(r)&&!d){var l=this.videoStatus.peek();if((!l.isVisible||l.statusMessage!==a||l.error!==r)&&(this.videoStatus({isVisible:!0,statusMessage:a,error:r}),this.isLoading(!1),this.isPlaying(!1),this.canPlay(!1),(!r||r.isRetriable)&&!this.isSeeking.peek()&&this.duration.peek())){var u=this.duration.peek(),f=u?this.position.peek()/u:0;this.seekPercentage(f),this.isSeeking(!0)}}else{var p=Object(i.__assign)(Object(i.__assign)({},o),((t={})[s]=e,t));this._errorsByType(p)}},t.prototype.getRequestParametersAsync=function(e,t){if(void 0===t&&(t=""),this.isPlaybackCDNEnabled()&&Object(ue.isFeatureEnabled)(ue.VideoEnableDashlingHybridPlayback)&&e&&!this.dashlingVideoTelemetry.isServerSideFallback){var n=this._hmacInfo;if("init"===t&&"IDLE"===n.state&&(e=e.concat("&generateHMAC=true"),n.state="INPROGRESS"),"APPLY"===n.state&&n.docidhash&&n.digest){var a=e.replace("videotranscode","videotranscode/"+n.docidhash);e="".concat(a,"&enableEncryption=1&enableCdn=1&p1=").concat(n.expiry,"&p2=").concat(n.symmetricKey,"&p3=").concat(n.algoId,"&p4=").concat(n.digest)}}var i=!!("init"===t||"media"===t&&this.isPlaybackCDNEnabled()),r=!("media"!==t||!this.allowAudioEnhancement()||!this.audioEnhancementButtonState());return this._videoItemDataSource.getRequestParametersAsync(this.item.peek(),e,i,r)},t.prototype.getDiagnosticInfo=function(){var e={};return e.fallbackCount=this.fallbackCount,e.transcodeType=this.transcodeType(),e},t.prototype.getKeyAsync=function(e,t){this.isKeyFetchReqComplete.peek()?this.key.peek()?e(this.key.peek()):t(this.keyError.peek()):(this.keySuccess=e,this.keyFailure=t)},t.prototype.testConnectivity=function(e){return ce.n.resolve(this._networkTester.testConnectivity(e))},t.prototype.isPlaybackEncryptionEnabled=function(){return this._encryptedPlaybackRequested&&(this.isEncryptionFlightEnabled()||this.isCDNFlightEnabled()&&this._isVideoUseCDNFarmSettingEnabled())},t.prototype.isPlaybackCDNEnabled=function(){return this._encryptedPlaybackRequested&&this.isCDNFlightEnabled()&&this._isVideoUseCDNFarmSettingEnabled()},t.prototype.hasVideoQuality=function(e){return-1!==this.dashQualities.peek().indexOf(e)},t.prototype.getTotalPlayTimeMs=function(){if(this.isPlaying.peek()&&this.lastPlayStartTime>0){var e=On.now();this.totalPlayTimeMs=this.totalPlayTimeMs+(e-this.lastPlayStartTime),this.lastPlayStartTime=e}return this.totalPlayTimeMs},t.prototype.resetSessionTelemetry=function(){this.totalPlayTimeMs=0,this.totalRebufferingTimeMs=0,this.lastLoadingStartTime=0,this.lastPlayStartTime=0,this.dashlingVideoTelemetry.resetDashlingSessionTelemetry()},t.prototype.resetLoadTelemetry=function(){this.dashlingVideoTelemetry.resetDashlingLoadTelemetry()},t.prototype.publishResponseMetaData=function(e){this.dashlingVideoTelemetry.handleResponseMetaData(e),e&&e.headers&&e.headers.docidhash&&(this._hmacInfo.expiry=+e.headers.p1,this._hmacInfo.symmetricKey=+e.headers.p2,this._hmacInfo.algoId=+e.headers.p3,this._hmacInfo.digest=e.headers.p4,this._hmacInfo.docidhash=e.headers.docidhash,this._hmacInfo.state="COMPLETE")},t.prototype.publishAPIStats=function(e){this.dashlingVideoTelemetry.handleAPIStats(e)},t.prototype.publishOperationStats=function(e){this.dashlingVideoTelemetry.handleOperationStats(e)},t.prototype.publishTelemetryInfo=function(e){this.dashlingVideoTelemetry.handleTelemetryInfo(e)},t.prototype.publishEventInfo=function(e){e.hmacInfoState&&(this._hmacInfo.state=e.hmacInfoState)},t.prototype.isDownloadBlocked=function(e){return this._videoItemDataSource.isDownloadBlocked(e)||this._isDownloadBlocked},t.prototype.getPlatformStreamingSupportType=function(){return kn?"MSE":Ln?"hlsNative":Mn?"flash":"None"},t.prototype.getTotalRebufferingTimeMs=function(){if(this.isLoading.peek()&&!this.isSeeking.peek()&&this.lastLoadingStartTime>0){var e=On.now();this.totalRebufferingTimeMs=this.totalRebufferingTimeMs+(e-this.lastLoadingStartTime),this.lastLoadingStartTime=e}return this.totalRebufferingTimeMs},t.prototype.showAudioEnhancementButton=function(){return this.enableAudioEnhancement()&&(this.playbackType()===se.n.htmlDashling||this.playbackType()===se.n.htmlMp4||this.playbackType()===se.n.htmlFallback)},t.prototype.getVideoItemDataSource=function(){return this._videoItemDataSource},t.prototype.transcodeType=function(){return this._currentPlaybackUrl&&this.playbackType()!==se.n.htmlMp4&&this.playbackType()!==se.n.htmlFallback?-1!==this._currentPlaybackUrl.indexOf("altTranscode=1")?te.FFMPEG:te.MediaFoundation:te.None},t.prototype.getContentCategory=function(){var e=this.videoMetaData.peek();return e&&e.media&&e.media.mediaSource&&e.media.mediaSource.contentCategory||void 0},t.prototype._audioEnhancementAction=function(){var e=this.audioEnhancementButtonState.peek()?"audioEnhancementEnabled":"audioEnhancementDisabled";be.t.raise(this,e);var t=this.playbackType()===se.n.htmlDashling;t&&this.audioEnhancementButtonState()||this._evaluateItemPlayability(!0),null!=this.dashling()&&t&&this.dashling().resetStreams(Object(ue.isFeatureEnabled)(ue.FlushingOnlyAudioChunksDuringResettingStreams))},t.prototype.allowAudioEnhancement=function(){return this.enableAudioEnhancement()&&this.playbackType()===se.n.htmlDashling},t.prototype._shouldPreferStreamingForTMR=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(e){switch(e.label){case 0:return Object(ue.isFeatureEnabled)(ue.TMRMetaRedirect)&&Object(ue.isFeatureEnabled)(ue.ForceTMRToMediaFoundation)?[4,this._isTeamsMeetingRecording()]:[3,2];case 1:return[2,e.sent()];case 2:return[2,ce.n.resolve(!1)]}})})},t.prototype._isTeamsMeetingRecording=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var e;return Object(i.__generator)(this,function(t){switch(t.label){case 0:return[4,this._getVideoMetaData()];case 1:return[2,(e=t.sent())&&e.media&&e.media.mediaSource&&"Meeting"===e.media.mediaSource.contentCategory&&e.source&&"Teams"===e.source.application]}})})},t.prototype._getVideoMetaData=function(){return Object(i.__awaiter)(this,void 0,void 0,function(){var e,t;return Object(i.__generator)(this,function(n){switch(n.label){case 0:return this._fetchedVideoMetaDataPromise?[3,2]:(t=On.now(),this._fetchedVideoMetaDataPromise=this._videoItemDataSource.fetchVideoMetaData(this.item()),[4,this._fetchedVideoMetaDataPromise]);case 1:return e=n.sent(),this.metaDataFetchTimeMS=On.now()-t,e&&(e.data?this.videoMetaData(e.data):e.error&&(this.metaDataFetchError=e.error)),[3,4];case 2:return[4,this._fetchedVideoMetaDataPromise];case 3:e=n.sent(),n.label=4;case 4:return[2,e?e.data:void 0]}})})},t.prototype._onVideoMetaDataChanged=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){return e&&this._setAreCaptionsAvailable(),[2]})})},t.prototype._onCaptionsEnabled=function(e){this.wereCaptionsEnabled||(this.wereCaptionsEnabled=e)},t.prototype._onIsKeyFetchReqComplete=function(){this.isKeyFetchReqComplete.peek()&&(this.key.peek()&&"function"==typeof this.keySuccess?this.keySuccess(this.key.peek()):this.keyError.peek()&&"function"==typeof this.keyError&&this.keyFailure(this.keyError.peek()))},t.prototype._setAreCaptionsAvailable=function(){var e,t,n;return Object(i.__awaiter)(this,void 0,void 0,function(){var a,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return[4,this._getVideoMetaData()];case 1:return a=i.sent(),this.closedCaptionsManager=new he(this),(r=Object(ue.isFeatureEnabled)(ue.TeamsMeetingRecordingPlayerCaptionSupport))?[4,this._isTeamsMeetingRecording()]:[3,3];case 2:r=i.sent(),i.label=3;case 3:return r&&!1!==(null===(e=null==a?void 0:a.media)||void 0===e?void 0:e.isTranscriptionShown)?Object(ue.isFeatureEnabled)(ue.TeamsMeetingRecordingPrecheckForCaptionsFromMeta)?(o=this.areCaptionsAvailable,[4,this.closedCaptionsManager.fetchAndParseCaptions()]):[3,5]:[3,9];case 4:return o.apply(this,[i.sent()]),[3,8];case 5:return(null===(t=null==a?void 0:a.media)||void 0===t?void 0:t.isTranscriptionShown)?(this.areCaptionsAvailable(!0),[3,8]):[3,6];case 6:return void 0!==(null===(n=null==a?void 0:a.media)||void 0===n?void 0:n.isTranscriptionShown)?[3,8]:(s=this.areCaptionsAvailable,[4,this.closedCaptionsManager.fetchAndParseCaptions()]);case 7:s.apply(this,[i.sent()]),i.label=8;case 8:return[3,10];case 9:this.areCaptionsAvailable(!1),i.label=10;case 10:return[2]}})})},t.prototype._cancelGetDownload=function(){this._pendingGetDownloadPromise&&(this._pendingGetDownloadPromise.cancel(),this._pendingGetDownloadPromise=null)},t.prototype._onIsLoadingChanged=function(e){!this.isSeeking.peek()&&this.startupCompleted&&(e?this.lastLoadingStartTime=On.now():this.lastLoadingStartTime>0&&(this.totalRebufferingTimeMs=this.totalRebufferingTimeMs+(On.now()-this.lastLoadingStartTime),this.lastLoadingStartTime=0))},t.prototype._onIsRefreshingToken=function(e){var t=this;if(e){if(Object(ue.isFeatureEnabled)(ue.VideoTokenFromGraph)){if(this._graphDataSource.refreshAccessToken){var n=(a=this.duration.peek())?this.position.peek()/a:0;this.isSeeking(!0),this.seekPercentage(n),this._graphDataSource.refreshAccessToken(this.item.peek(),{forceRefresh:!0,apiVersion:Object(In.a)()?void 0:Object(ue.isFeatureEnabled)(ue.MediaTAUseVroomV21)?"v2.1":"v2.0"}).done(function(){t.isRefreshingToken(!1)},function(){t.isRefreshingToken(!1)})}}else if(this._videoItemDataSource.getToken){var a;n=(a=this.duration.peek())?this.position.peek()/a:0,this.isSeeking(!0),this.seekPercentage(n),this._videoItemDataSource.getToken(this.item.peek(),!0).done(function(){t.isRefreshingToken(!1)},function(){t.isRefreshingToken(!1)})}}else this.getRequestParametersAsync(this.url.peek()).then(function(e){var n=e.url;t._reset(n,!0)})},t.prototype._onIsInternalTechPlayingChanged=function(e){e?(this.lastPlayStartTime=On.now(),this.startupCompleted=!0):this.lastPlayStartTime>0&&(this.totalPlayTimeMs=this.totalPlayTimeMs+(On.now()-this.lastPlayStartTime),this.lastPlayStartTime=0)},t.prototype._onIsPlayingChanged=function(e){var t=this,n=this.videoStatus.peek();if(!e||this.timeAtFirstPlay||this.shouldAutoPlay||(this.timeAtFirstPlay=On.now()),e&&n.isVisible){var a=this.url.peek(),i=n.error;this.url(null),i&&i.requiresNewUrl?this._getNewDownloadUrl(!1).done(function(e){t._reset(e,!0)}):this._reset(a,!0)}},t.prototype._computeItemKey=function(){var e=this.item();return e?e.key:null},t.prototype._computeHasError=function(){return this.videoStatus().isVisible},t.prototype._computeCanAdjustQuality=function(){return this.playbackType()===se.n.htmlDashling},t.prototype._computeShouldUseNativeControls=function(){return Tn.isIOS},t.prototype._computeCanvasType=function(){switch(this.playbackType()){case se.n.flashDash:case se.n.flashMp4:return zt.flash;default:return zt.html}},t.prototype._onItemChanged=function(e){e&&this._lastItemKey!==e.key&&(this._lastItemKey=e.key,this.areCaptionsAvailable(!1),this.areCaptionsEnabled(!1),this._fetchedVideoMetaDataPromise=null,this._reset(null),this._getVideoMetaData())},t.prototype._reset=function(e,t){var n=this.item.peek(),a=n&&n.thumbnail,i=null;a&&(i=Dt.format(a.url,a.width,a.height)),this.dashlingVideoTelemetry.resetDashlingSessionTelemetry(),this._cancelGetDownload(),this.coverImageUrl(i);var r=this.videoStatus.peek();null!==r&&!1===r.isVisible&&void 0===r.error||this.videoStatus({isVisible:!1,error:void 0}),this.canPlay(!1),t||(this.isSeeking(!1),this.seekPercentage(0),this.position(0),this.duration(0),this.totalPlayTimeMs=0,this.totalRebufferingTimeMs=0,this.lastPlayStartTime=0,this.playbackSessionId=I.generate()),this.startupCompleted=!1,this.rawBufferedTimeRanges(null),this.isLoading(!0);var o=this.url.peek();e&&o&&o!==e&&(this.isFallback=!0,this.fallbackCount++,this.isCopyCodecEnabled=void 0),this.url(e),this.shouldAutoPlay&&this.isPlaying(!0)},t.prototype._onIsAdjustingVolumeChanged=function(e){e&&this.isMuted(!1)},t.prototype._getStreamingType=function(e){if(!this.disableTranscode()&&this._videoItemDataSource.isStreamingSupported(e)){if(Object(ue.isFeatureEnabled)(ue.VideoUseCdn)&&this.isForcedMeta())return se.n.htmlDashling;if(kn)return se.n.htmlDashling;if(Ln&&this._videoItemDataSource.isHlsPlaybackSupported())return Object(ue.isFeatureEnabled)(ue.HlsV6Playback)?se.n.htmlHlsV6:se.n.htmlHls;if(0===Mn)return this._evaluateFlashSupport(),se.n.flashPending;if(1===Mn)return se.n.flashPending;if(2===Mn)return se.n.flashDash}},t.prototype.isCDNFlightEnabled=function(){return!this._forcedCdnParam&&Object(ue.isFeatureEnabled)(ue.VideoUseCdn)||"1"===this._forcedCdnParam},t.prototype.isEncryptionFlightEnabled=function(){return!this._forcedCdnParam&&Object(ue.isFeatureEnabled)(ue.VideoEnableEncryption)||"1"===this._forcedCdnParam},t.prototype.getForcedCdnParam=function(){var e=this.getURLSearchParam("cdn"),t=this.getURLSearchParam("videoUseCdnTeam");return"1"===e||"0"===e?e:"true"===t?"1":""},t.prototype.getBlockDownloadParam=function(){return"true"===this.getURLSearchParam("blockDownload")},t.prototype.getURLSearchParam=function(e){return this._viewParams.peek()[e]},t.prototype.isForcedMeta=function(){return"1"===this.getURLSearchParam("forceMeta")},t.prototype._getPlaybackType=function(e,t){return Object(i.__awaiter)(this,void 0,void 0,function(){var n,a,r,o,s,c,d,l;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return Pn?Object(ue.isFeatureEnabled)(ue.VideoEnableForceMeta)&&this.isForcedMeta()?[2,se.n.htmlDashling]:(n=t[se.n.htmlMp4],a=this._policyAllowsNative(e),[4,this._shouldPreferNative(e)]):[2,se.n.none];case 1:return r=i.sent(),o=t[se.n.htmlDashling]||t[se.n.htmlHls]||t[se.n.htmlHlsV6]||t[se.n.flashDash],s=this.audioEnhancementButtonState()&&!o,c=!n&&this._canPlayNative(e)&&a&&!s,this._encryptedPlaybackRequested&&o&&o.error&&-1!==Un.indexOf(o.error.type)?[2,this.playbackType.peek()]:c&&r?[2,se.n.htmlMp4]:(d=this._getStreamingType(e),!o&&d?[2,d]:[4,this._isTeamsMeetingRecording()]);case 2:if(i.sent()&&!this.useBetaTranscode.peek()&&Object(ue.isFeatureEnabled)(ue.TMRFallbackToFFMPEG)&&Object(ue.isFeatureEnabled)(ue.UseAltTranscodeForDashManifests)){if(d===se.n.htmlDashling&&t[se.n.htmlDashling])return[2,se.n.htmlDashlingFFMPEGFallback];if(d===se.n.htmlHlsV6&&t[se.n.htmlHlsV6])return[2,se.n.htmlHlsV6FFMPEGFallback];if(d===se.n.htmlHls&&t[se.n.htmlHls])return[2,se.n.htmlHlsFFMPEGFallback]}if(Object(ue.isFeatureEnabled)(ue.VideoAttemptFfmpegToMediaFoundationFallback)&&this.useBetaTranscode()&&o){if(this.useBetaTranscode(!1),d===se.n.htmlDashling)return[2,se.n.htmlDashlingMediaFoundationFallback];if(d===se.n.htmlHlsV6)return[2,se.n.htmlHlsV6MediaFoundationFallback];if(d===se.n.htmlHls)return[2,se.n.htmlHlsMediaFoundationFallback]}return l=n||t[se.n.htmlFallback],c?[2,se.n.htmlMp4]:!l&&a?[2,se.n.htmlFallback]:d||a?d&&Object(ue.isFeatureEnabled)(ue.VideoModePreferStreamError)?[2,d]:[4,this._getPlaybackType(e,{})]:[2,se.n.none];case 3:return[2,i.sent()]}})})},t.prototype._evaluateItemPlayability=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){var t,n,a,r,o,s,c,d,l,u,f,p,m,_,b=this;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return t=this.item(),n=!(!t||t.did||!t.video&&!t.audio),a=se.n.none,r=this.videoStatus(),o=t&&0===t.size,s=r.error,c=!s||s.isRetriable,d=this.useBetaTranscode(),l=this._lastBetaSetting,this._lastBetaSetting=d,u=this._errorsByType(),o||!n?[3,2]:[4,this._getPlaybackType(t,u)];case 1:a=i.sent(),i.label=2;case 2:if(f=!(s||u&&u[this.playbackType.peek()]),this.url.peek()&&!u[this.playbackType.peek()]&&!e)return[2];if(this._encryptedPlaybackRequested&&u&&u[a]&&this.playbackType.peek()===a)return this._getNewDownloadUrl(!1).done(function(e){b.url.peek()===e?(b.setVideoStatus(u[a]),be.t.raise(b,"error")):b._reset(e,!0)}),[2];if(Object(ue.isFeatureEnabled)(ue.VideoModePreferStreamError)&&(p=u[a]))return this.setVideoStatus(p),be.t.raise(this,"error"),[2];if(a===this.playbackType.peek()){if(r.isVisible&&!c)return this.playbackType(se.n.none),be.t.raise(this,"error"),[2];if(t.key===this._lastItemKey&&this.url()&&d===l)return[2]}if(o)return this.setVideoStatus({statusMessage:h.i,error:new D({code:"FromMetadata",type:S.emptyFile,isExpected:!0,isRetriable:!1})}),be.t.raise(this,"error"),[2];if(!n)return t&&!t.isPlaceholder&&this.setVideoStatus({statusMessage:h.l,error:new D({code:"NotVideo",type:S.unsupportedFormat,isExpected:!0,isRetriable:!1})}),be.t.raise(this,"error"),[2];if(a===se.n.flashPending)return[2];if(a!==se.n.none){if(this.playbackType(a),m=u[a])return this.setVideoStatus(m),be.t.raise(this,"error"),[2];this._getNewDownloadUrl(f).done(function(e){b._reset(e,!0)})}else _=(Pn?wn?kn?void 0:S.mediaSourceUnsupported:S.h264Unsupported:S.html5VideoUnsupported)||S.unsupportedBrowser,this.setVideoStatus({statusMessage:h.d,error:new D({code:"",type:_,isExpected:!0,isRetriable:!1})}),be.t.raise(this,"error");return[2]}})})},t.prototype._evaluateFlashSupport=function(){var e=this;Mn=1,Vt.checkFlashSupport(Cn,function(t){e.isDisposed||(Mn=t?2:3,e._evaluateItemPlayability())})},t.prototype._shouldPreferNative=function(e){var t,n;return Object(i.__awaiter)(this,void 0,void 0,function(){var a,r,o,s;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return a=e.video,r=(void 0===a?{}:a).bitrate,o=void 0===r?void 0:r,e.itemStatus===wt.t.ConditionalAccessViewOnly?[2,!1]:[4,this._shouldPreferStreamingForTMR()];case 1:return i.sent()?[2,!1]:(s=(e.extension||"").toLowerCase(),e.audio&&".mp3"===s||o&&o<=3e6||!o&&".mp4"===e.extension&&e.size<=5242880?[2,!0]:(null===(t=e.photo)||void 0===t?void 0:t.isLivePhoto)&&Object(ue.isFeatureEnabled)(ue.EnableLivePhotoVideos)?Object(ue.isFeatureEnabled)(ue.EnableLivePhotoVideos_NativePlayback)?[2,!Tn.isChrome]:[2,!1]:(null===(n=e.photo)||void 0===n?void 0:n.isSamsungMotionPhoto)&&Object(ue.isFeatureEnabled)(ue.EnableSamsungMotionPhotoVideos)||!pe.e.isActivated("4DEBB627-E120-4D84-8E8E-682A25A20795","12/20/2021","Use vroom getDownloadUrl api")&&Object(xn.e)(e.ownerId)?[2,!0]:[2,!1])}})})},t.prototype._canPlayNative=function(e){var t=(e.extension||"").toLowerCase();if(e.audio&&".mp3"===t)return!0;if(En&&".webm"===t)return!0;var n=e?e.video:null;return n&&"H264"===n.fourCC&&wn&&("PCM"!==n.audioFormat||An)||!1},t.prototype._policyAllowsNative=function(e){return!this.isDownloadBlocked(e)},t.prototype._supportsDecryption=function(){var e=this.playbackType.peek();return(e===se.n.htmlDashling||e===se.n.htmlDashlingMediaFoundationFallback)&&oe.supportsDecryption()},t.prototype._isVideoUseCDNFarmSettingEnabled=function(){var e=window&&window._spPageContextInfo&&window._spPageContextInfo.farmSettings&&window._spPageContextInfo.farmSettings.ExternalService_videousecdnenabled;return void 0===e||"1"===e},t.prototype._getNewDownloadUrl=function(e){return Object(i.__awaiter)(this,void 0,ce.n,function(){var t,n,a=this;return Object(i.__generator)(this,function(i){switch(i.label){case 0:return this._pendingGetDownloadPromise?[2,this._pendingGetDownloadPromise]:(this._encryptedPlaybackRequested=e&&this._supportsDecryption()&&(this.isEncryptionFlightEnabled()||this.isCDNFlightEnabled()&&this._isVideoUseCDNFarmSettingEnabled()),!Object(ue.isFeatureEnabled)(ue.UseAltTranscodeForDashManifests)||this.playbackType.peek()!==se.n.htmlDashlingFFMPEGFallback&&this.playbackType.peek()!==se.n.htmlHlsFFMPEGFallback&&this.playbackType.peek()!==se.n.htmlHlsV6FFMPEGFallback?[3,1]:(this.useBetaTranscode(!0),[3,4]));case 1:return(t=Object(ue.isFeatureEnabled)(ue.ForceTMRToMediaFoundation)&&Object(se.a)(this.playbackType.peek())!==se.e.mp4&&this.useBetaTranscode.peek())?[4,this._isTeamsMeetingRecording()]:[3,3];case 2:t=i.sent(),i.label=3;case 3:t&&this.useBetaTranscode(!1),i.label=4;case 4:return n=this._videoItemDataSource.getDownloadUrl({item:this.item.peek(),playbackType:this.playbackType.peek(),useBetaTranscode:this.useBetaTranscode.peek(),preferEncryption:this._encryptedPlaybackRequested,forcedCdnParam:this._forcedCdnParam}),this._pendingGetDownloadPromise=this.trackPromise(n),[2,this._pendingGetDownloadPromise.then(function(e){if(a._pendingGetDownloadPromise=null,Object(ue.isFeatureEnabled)(ue.DisableSKCompliance)&&a.checkGeoLocInvalidRequest(e)){var t=new b.e({code:"405",message:h.r,isExpected:!0}),n={code:t.code,type:S.geoLocInvalidRequest,message:t.message,isRetriable:!1,isExpected:!0,requiresNewUrl:!0};return a.setVideoStatus({statusMessage:h.o,error:new D(n)}),ce.n.reject(t)}return a._currentPlaybackUrl=e,e},function(e){if(a._pendingGetDownloadPromise=null,!ce.n.isCanceled(e)){var t=e instanceof Error&&e,n={code:e.name,type:S.getDownloadUrlFailure,message:t&&t.message,isRetriable:!1,requiresNewUrl:!0};t instanceof b.e&&(n.correlationId=t.correlationId,n.code=t.code||t.name,n.isExpected=t.isExpected),Object(ue.isFeatureEnabled)(ue.DisableSKCompliance)&&a.checkGeoLocInvalidRequest(void 0,e)&&(n.type=S.geoLocInvalidRequest,n.message=h.r,n.isExpected=!0,n.requiresNewUrl=!1),a.setVideoStatus({statusMessage:h.o,error:new D(n)})}return ce.n.reject(e)})]}})})},t.prototype.checkGeoLocInvalidRequest=function(e,t){var n,a=t;if(a){var i="405"===a.code||"500"===a.code||405===a.status||500===a.status,r=a.request&&a.request.getResponseHeader("X-ClientErrorCode").toLowerCase()===S.geoLocInvalidRequest.toLowerCase(),o=a.innererror||a.innerError||a.data&&(a.data.innererror||a.data.innerError),s=(null===(n=null==o?void 0:o.code)||void 0===n?void 0:n.toLocaleLowerCase())===S.geoLocInvalidRequest.toLowerCase();return i&&r||s}if(e&&e.indexOf("error?code=405")>-1){var c=new fe.t(e);if("error"===c.getLastPathSegment()&&"405"===c.getQueryParameter("code"))return!0}return!1},t.prototype._audioEnhancementResetStreams=function(){var e=this.dashling(),t=this.allowAudioEnhancement();null!=e&&t&&e.resetStreams()},t}(It.n);function Hn(e,t){try{var n=e.canPlayType(t);return n&&"no"!==n.toLowerCase()}catch(e){return!1}}var Rn=n(3274),Nn=function(e){function t(t){var n=e.call(this,t)||this;return n._isMaximized=t.valueAccessor()||r.observable(!1),n.events.on(document,"fullscreenchange, webkitfullscreenchange, mozfullscreenchange, MSFullscreenChange",n._onFullScreenChanged),n.subscribe(n._isMaximized,n._onIsMaximizedChanged),n}return Object(i.__extends)(t,e),t.prototype._onIsMaximizedChanged=function(e){e?Rn.e.enterFullScreen():Rn.e.exitFullScreen()},t.prototype._onFullScreenChanged=function(){this._isMaximized(Rn.e.isFullScreen())},t}(_.t);Object(a.n)([{rawString:".od-captionsOverlay{position:absolute;left:0;top:0;bottom:80px;width:100%;pointer-events:none}"}]);var Bn=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a._context=n.context,a.subscribe(a._context.areCaptionsEnabled,a._onCaptionsEnabledUpdated),a}return Object(i.__extends)(t,e),t.prototype._onCaptionsEnabledUpdated=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return e?(this._onPositionChangedSubscription=this.subscribe(this._context.position,this._onPositionChanged),this._onPlaybackPanelVisibilityChangedSubscription=this.subscribe(this._context.isPlaybackPanelVisible,this._onPlaybackPanelVisibilityChanged),this._onMaximizedChangedSubscription=this.subscribe(this._context.isMaximized,this._onMaximizedChanged),this.events.on(window,"resize",this._onResizeHandler),this._overlay=document.getElementById("captionsOverlay"),[4,this._context.closedCaptionsManager.fetchAndParseCaptions()]):[3,2];case 1:return t.sent(),this._renderActiveCues(),[3,3];case 2:this._onPositionChangedSubscription.dispose(),this._onPlaybackPanelVisibilityChangedSubscription.dispose(),this._onMaximizedChangedSubscription.dispose(),this._clearDisplayCues(),t.label=3;case 3:return[2]}})})},t.prototype._onPositionChanged=function(e){if(!this._resizeTimer&&this._context.closedCaptionsManager){var t=this._context.closedCaptionsManager.getActiveCues(e);if(null==this._currentCues||t.length!==this._currentCues.length)return void this._renderCues(t);for(var n=0;n<t.length;n++)if(t[n].text!==this._currentCues[n].text)return void this._renderCues(t)}},t.prototype._onPlaybackPanelVisibilityChanged=function(e){this._overlay&&(this._overlay.style.bottom=e?"80px":"0px",this._renderActiveCues())},t.prototype._onMaximizedChanged=function(){this._clearDisplayCues(),this.async.clearTimeout(this._resizeTimer),this._resizeTimer=this.async.setTimeout(function(){this._renderActiveCues(),this._resizeTimer=null}.bind(this),200)},t.prototype._onResizeHandler=function(){this._resizeTimer||this._renderActiveCues()},t.prototype._clearDisplayCues=function(){this._renderCues([])},t.prototype._renderActiveCues=function(){if(this._context.closedCaptionsManager){var e=this._context.closedCaptionsManager.getActiveCues(this._context.position());this._renderCues(e)}},t.prototype._renderCues=function(e){return Object(i.__awaiter)(this,void 0,void 0,function(){return Object(i.__generator)(this,function(t){switch(t.label){case 0:return this._overlay?(this._currentCues=e,[4,this._context.closedCaptionsManager.getWebVTT()]):[3,2];case 1:t.sent().processCues(window,this._currentCues,this._overlay),t.label=2;case 2:return[2]}})})},t.dependencies=Object(i.__assign)(Object(i.__assign)({},m.t.dependencies),{context:Je.e}),t}(m.t),jn=Object(d.t)({name:"ClosedCaptionsOverlay",automationName:"ms-video-player-closed-captions-overlay",template:'<div class="od-captionsOverlay" id="captionsOverlay"></div>',viewModelType:Bn}),Vn=function(e){function t(t,n){var a=e.call(this,t,n)||this,i=performance?performance.now():Date.now();a.addBindingHandlers({control:d.n,fullScreen:Nn});var r=a,o=r.observables,s=r.resources;a.closedCaptionsOverlayControl=Object(d.a)(jn,{}),a.item=t.item,a._isPlaying=t.isPlaying||o.create(!1),a._playVideo=t.playVideo||o.create(!1);var c=t.result;a.actionBar=o.wrap(t.actionBar);var l=t.isLoading,u=a.context=s.expose(Je.e,new(a.managed(Fn))({autoplay:t.autoplay,item:a.item,isPlaybackPanelVisible:t.isPlaybackPanelVisible,clientId:t.clientId,timeAtUserInteractionInitiated:i}));return l&&a.scope.attach(l.register(u.isLoading)),a._isMaximized=t.isMaximized,a.playbackPanelHost={name:yt.e.tagName,params:{provider:n.playbackPanelProvider}},a.playbackPanel={name:vt.tagName,params:{}},a.correlationId=o.pureCompute(function(){var e=u.videoStatus(),t=e&&e.error;return t&&t.correlationId||""}),c&&a.scope.attach(c.register(o.pureCompute(a._computeResult))),o.backgroundCompute(a._computeSetIsMaximized),o.backgroundCompute(a._computeUpdateIsPlaying),o.backgroundCompute(a._computePlayVideo),a}return Object(i.__extends)(t,e),t.prototype.dispose=function(){this._isPlaying(!1),e.prototype.dispose.call(this)},t.prototype.onStatusClicked=function(e,t){var n=this.context.videoStatus.peek().error;return(!n||n.isRetriable)&&(this.context.isPlaying(!0),t.stopPropagation(),t.preventDefault()),!0},t.prototype.toggleIsMaximized=function(e,t){return!!this.context.shouldUseNativeControls||(this.context.isMaximized(!this.context.isMaximized.peek()),!1)},t.prototype.getErrorType=function(e){var t=e&&e.type||S.unknown;return S[t]},t.prototype.getErrorDetails=function(e){return e&&(e.message||S[e.type])||""},t.prototype.getCorrelationId=function(e){return e&&e.correlationId||""},t.prototype._computeUpdateIsPlaying=function(){var e=this.context.isPlaying();this._isPlaying(e)},t.prototype._computePlayVideo=function(){var e=this._playVideo(),t=this.context.isPlaying();e&&!t&&this.context.isPlaying(e)},t.prototype._computeSetIsMaximized=function(){this._isMaximized(this.context.isMaximized())},t.prototype._computeResult=function(){var e=this.context;if(e.hasError()){var t=e.videoStatus().error,n=t.type?S[t.type]:"",a=t.code,i=t.correlationId;a&&(n+=".".concat(a));var r=i?{CorrelationId:i}:{};return{error:t.message,resultCode:n,resultType:t.isExpected?c.e.ExpectedFailure:c.e.Failure,extraData:r}}if(e.canPlay()){var o=e.playbackType();return{resultType:c.e.Success,resultCode:o&&se.t[o]}}},t.dependencies=Object(i.__assign)(Object(i.__assign)({},m.t.dependencies),{playbackPanelProvider:Je.a.optional,engagement:St.e}),t}(m.t),zn=Object(d.t)({automationName:"ms-item-videoplayer",name:"VideoPlayer",template:'<div class="od-VideoPlayer" data-bind="fullScreen:context.isMaximized,css:{\'od-VideoPlayer--isFullScreen\':context.isMaximized,\'od-VideoPlayer--hasStatus\':context.videoStatus().isVisible}"><div class="od-VideoPlayer-canvas" data-bind="event:{dblclick:toggleIsMaximized},component:{name:\'od-videocanvas\'}"></div>\x3c!--ko if:context.areCaptionsAvailable()&&!context.shouldUseNativeControls--\x3e<div class="od-VideoPlayer-captionsOverlay" data-bind="control:closedCaptionsOverlayControl"></div>\x3c!--/ko--\x3e<div class="od-VideoPlayer-status" data-bind="click:onStatusClicked"><div class="od-VideoPlayer-statusContent">\x3c!--ko if:$component.context.videoStatus().isRetriable--\x3e<button class="od-VideoPlayer-statusButton ms-Icon" data-bind="icon:true,css:{\'ms-Icon--Sync\':context.hasError(),\'ms-Icon--Play\':!context.hasError()&&!context.isPlaying(),\'ms-Icon--Pause\':!context.hasError()&&context.isPlaying()}"></button>\x3c!--/ko--\x3e\x3c!--ko with:$component.context.videoStatus--\x3e\x3c!--ko if:$data.statusMessage--\x3e<div class="od-VideoPlayer-statusText" data-bind="text:$data.statusMessage"></div>\x3c!--/ko--\x3e\x3c!--ko if:$component.correlationId--\x3e<div class="od-VideoPlayer-debugText"><span data-bind="text:$component.correlationId"></span></div>\x3c!--/ko--\x3e\x3c!--ko if:$component.context.canShowDiagnostics--\x3e<div class="od-VideoPlayer-debugText"><strong data-bind="text:$component.getErrorType($data.error)"></strong><span data-bind="text:$component.getErrorDetails($data.error)"></span></div>\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--ko if:context.hasError()--\x3e\x3c!--ko control:actionBar--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e</div></div>\x3c!--ko if:!context.shouldUseNativeControls--\x3e\x3c!--ko component:playbackPanelHost--\x3e\x3c!--ko component:playbackPanel--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--/ko--\x3e</div>',viewModelType:Vn}),Gn=n(2121),Kn=n(3052),Wn=n(2415),qn=n(600),Qn=n(26),Yn=n(1855),Jn=n(163),Xn=n(3237),Zn=100,$n=function(e){function t(n,a){var r,s=this;(s=e.call(this,n,a)||this)._onLoadingChange=function(e){s._burstPhotoHasLoaded=!e,s._burstPhotoHasLoaded&&s.showBurstPhotoSpinner(!1)},s.addBindingHandlers({control:d.n});var l=s.observables,u=l.pureCompute(function(){var e=s.slide.item();return!(e.video&&(e.video.height||e.video.width)||!e.audio)});s.watermark=l.pureCompute(function(){var e=u()?"audiowatermark":"videowatermark";return"".concat(qn.i,"64/").concat(e,".svg")}),s.watermarkAlt=l.pureCompute(function(){return s.slide.item().displayName});var f=l.pureCompute(function(){var e=s.oneUp.size();return u()?{width:Math.min(200,e.width),height:Math.min(200,e.height)}:e}),p=l.pureCompute(function(){return!u}),m=Object(o.t)(),_=l.createCallback(m);s.showWatermark=l.pureCompute(function(){return!(s._burstPhotoType||_()&&_().resultType===c.e.Success)});var h=s.slide;s.thumbnailControl=Object(d.a)(Wn.e,{allowError:p,showErrorActions:!1,slide:Object(i.__assign)(Object(i.__assign)({},h),{loadState:l.create(0),loadResult:_}),oneUp:s.oneUp,size:f,isPreview:!0,expectLoadingFailure:!1}),s._isMobile=a.platformDetection.isMobile,h.isEditCaptionEnabled(!s._isMobile);var b=s._isPlaying=l.create(!1),g=s._playVideo=l.create(!1),v=s._isMaximized=l.create(!1);s.burstPhotoBadgeId="burstPhotoBadge"+ ++t._burstPhotoBadgeIdCounter,s._burstPhotoType=null===(r=h.item.peek().video)||void 0===r?void 0:r.burstPhotoType,s.videoVisible=l.pureCompute(function(){return!s._burstPhotoType||s._isPlaying()}),s.showVideo=l.pureCompute(function(){return!h.offset()}),s.showThumbnail=l.pureCompute(function(){return!!s._burstPhotoType||u()||!s.showVideo()}),s.showBurstPhotoBadge=l.pureCompute(function(){return!!s._burstPhotoType});var y=l.createCallback(m);s.scope.attach(h.loadResult.register(y));var S=h.loadState;S(2);var D,I=h.renderOptions,x=l.createCallback(Object(o.t)()),C=I&&I.qosEvent&&I.qosEvent.data&&I.qosEvent.data.extraData&&I.qosEvent.data.extraData.clientId,O=s._getAutoplayParam();D=Object(ue.isFeatureEnabled)(ue.VideoAutoplayBehaviorUpdate)?!s._burstPhotoType&&(void 0!==O?O:!I):!(s._burstPhotoType||I&&!I.autofocus),s.showBurstPhotoSpinner=l.create(!1),s.showBurstPhotoBadge()&&(s._burstPhotoHasLoaded=!1,s.scope.attach(x.subscribe(s._onLoadingChange)),s.burstPhotoBadgeStyle=s.createPureComputed(s._computeBurstPhotoBadgeStyle),s.burstPhotoBadgeImageUrl=s._getBurstPhotoBadgeImageUrl(),s.burstPhotoBadgeAriaLabel=Qn.Play,s.burstPhotoButtonClass="od-burstPhotoVideo-button od-"+s._burstPhotoType+"Badge",s.burstPhotoLoadingImageUrl=window.require.toUrl("odsp-media/images/loading/loadingspinner.gif")),s.videoPlayer=Object(d.a)(zn,{actionBar:I?Object(d.a)(Kn.e,{forceExternal:!0,item:h.item}):void 0,autoplay:D,result:y,item:h.item,isLoading:x,isPlaying:b,playVideo:g,isMaximized:v,isPlaybackPanelVisible:s.oneUp.isAwake,clientId:C?String(C):void 0}),l.backgroundCompute(function(){S()<3&&(!y()||x()||v()||b()||S(3))});var w=s.resources;return w.expose(Je.a,a.toolbarProvider),s._engagement=w.consume(St.e),l.compute(s._computeSetIsIdleEnabledFromIsPlaying),l.compute(s._computeChangesOnMaximized),l.compute(s._computePlayVideoFromIsPlaying),l.compute(s._sendBurstPhotoTelemetry),s}return Object(i.__extends)(t,e),t.prototype.onPlayBurstPhotoVideoClicked=function(){this._isPlaying()||(this._playVideo(!0),this._engagement.logData({name:"OneUp."+this._burstPhotoType+".Play",isIntentional:!0}),this._burstPhotoHasLoaded||this.showBurstPhotoSpinner(!0))},t.prototype.onPlayBurstPhotoVideoMouseover=function(){this._isMobile||this.onPlayBurstPhotoVideoClicked()},t.prototype.dispose=function(){if(this._burstPhotoType&&"SamsungMotionPhoto"===this._burstPhotoType){var e=this.slide.item();Xn.t(e.key)}},t.prototype._computePlayVideoFromIsPlaying=function(){this._burstPhotoType&&!this.slide.offset()&&this._isPlaying()&&this._playVideo()&&this._playVideo(!1)},t.prototype._sendBurstPhotoTelemetry=function(){if(this._burstPhotoType&&!this.slide.offset()){var e="OneUp."+this._burstPhotoType+".Open";this._engagement.logData({name:e,isIntentional:!0})}},t.prototype._getAutoplayParam=function(){if("undefined"!=typeof URLSearchParams){var e=new URLSearchParams(window.location.search).get("autoplay");return e?"true"===e||"1"===e:void 0}},t.prototype._computeSetIsIdleEnabledFromIsPlaying=function(){this.slide.isIdleEnabled(this._isPlaying())},t.prototype._computeChangesOnMaximized=function(){var e=this._isMaximized();this.oneUp.isCommandBarVisible(!e),this.slide.isEditCaptionEnabled(!this._isMobile&&!e),r.computedContext.isInitial()||this.oneUp.isInfoPaneExpanded(!1)},t.prototype._computeBurstPhotoBadgeStyle=function(){var e,t=this.oneUp.size(),n=this.slide.item().video;if(n){var a;a=t&&t.width&&t.height?t:n;var i=Yn.t(Yn.e.fit).getTransform(n,a),r=i.translate.x/a.width,o=i.translate.y/a.height;e=Jn.t.isRightToLeft?{left:"",right:"".concat((r*Zn).toFixed(2),"%"),top:"".concat((o*Zn).toFixed(2),"%")}:{left:"".concat((r*Zn).toFixed(2),"%"),right:"",top:"".concat((o*Zn).toFixed(2),"%")}}else e={left:"",right:"",top:""};return e},t.prototype._getBurstPhotoBadgeImageUrl=function(){if(this._burstPhotoType){if("AppleLivePhoto"===this._burstPhotoType)return window.require.toUrl("odsp-media/images/livephoto/livebadge_lightmode.svg");if("SamsungMotionPhoto"===this._burstPhotoType)return window.require.toUrl("odsp-media/images/samsung/motionphotobadgelight.svg")}return""},t.dependencies=Object(i.__assign)(Object(i.__assign)({},Gn.e.dependencies),{paneProvider:l.e,platformDetection:s.e,toolbarProvider:u.e,videoItemDataSource:Gt.Oe}),t._burstPhotoBadgeIdCounter=0,t}(Gn.e),ea=Object(d.t)({automationName:"od-one-up-video",name:"OneUpVideo",template:'\x3c!--ko if:showThumbnail--\x3e<div class="od-OneUpVideo-thumbnail" data-bind="control:thumbnailControl"></div>\x3c!--ko if:showWatermark--\x3e<img class="od-OneUpVideo-watermark" data-bind="attr:{src:watermark,alt:watermarkAlt}">\x3c!--/ko--\x3e\x3c!--/ko--\x3e\x3c!--ko if:showVideo--\x3e<div class="od-OneUpVideo" data-bind="control:videoPlayer,visible:videoVisible"></div>\x3c!--/ko--\x3e\x3c!--ko if:showBurstPhotoBadge--\x3e<div class="od-burstPhotoBadgeContainer" data-bind="style:burstPhotoBadgeStyle"><button data-automationid="od-burstPhotoVideo-play-button" data-bind="class:burstPhotoButtonClass,attr:{id:burstPhotoBadgeId,\'aria-label\':burstPhotoBadgeAriaLabel,title:burstPhotoBadgeAriaLabel},click:onPlayBurstPhotoVideoClicked,event:{mouseover:onPlayBurstPhotoVideoMouseover},style:{\'background-image\':\'url(\\\'\'+burstPhotoBadgeImageUrl+\'\\\')\'}"></button>\x3c!--ko if:showBurstPhotoSpinner--\x3e<img class="od-burstPhoto-loadingSpinner" data-bind="attr:{src:burstPhotoLoadingImageUrl}" alt="loading" role="alert">\x3c!--/ko--\x3e</div>\x3c!--/ko--\x3e',viewModelType:$n});t.default=ea}}]);