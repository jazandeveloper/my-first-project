(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[423],{4576:function(e,t,n){"use strict";n.r(t),n.d(t,"ItemCommentsDataSource",function(){return c}),n.d(t,"resourceKey",function(){return _});var a=n(119),i=n(60),r="my.microsoftpersonalcontent.com",o={folderDoesNotExist:!0,itemNotFound:!0,accessDenied:!0,unauthenticated:!0,409:!0},s=function(){function e(e,t){this._dataRequestor=t.vroomDataRequestor,this._itemCommentsResultProcessor=t.itemCommentsResultProcessor}return e.prototype.getComments=function(e,t){var n=this,a=this._getRequestUrl(e,t);return this._dataRequestor.send({apiName:"ItemActivityFeed.GetItemComments",path:a,accessToken:t.itemWrapper.activityItemWrapper.accessToken,expectedErrorCodes:o,useAuthorizationHeaders:-1!==a.indexOf(r)}).then(function(e){return n._itemCommentsResultProcessor.processResponse({item:t.itemWrapper,response:e})},function(e){return{comments:[],success:!1,error:e,isPermanentFailure:e.isExpected}})},e.prototype.addComment=function(e,t,n,a){var r="".concat(e,"/comments"),s=a&&a.length>0?{content:n,mentioned:a}:{content:n};return this._dataRequestor.send({apiName:"ItemActivityFeed.AddItemComments",path:r,accessToken:t.activityItemWrapper.accessToken,requestType:"POST",useAuthorizationHeaders:!0,getErrorAsMessage:!0,postData:JSON.stringify(s),expectedErrorCodes:o}).then(function(e){return e},function(e){return i.n.reject({code:e.error.code,message:{lang:"",value:e.error.message}})})},e.prototype.deleteCommentById=function(e,t,n){var a="".concat(e,"/comments/").concat(n);return this._dataRequestor.send({path:a,apiName:"ItemActivityFeed.DeleteCommentById",requestType:"DELETE",accessToken:t.activityItemWrapper.accessToken,useAuthorizationHeaders:!0,getErrorAsMessage:!0,expectedErrorCodes:o}).then(function(e){return i.n.resolve(!0)},function(e){return i.n.reject(e)})},e.prototype.getIsCommentsDisabled=function(e,t){var n="".concat(e,"?$select=id,commentMetadata");return this._dataRequestor.send({apiName:"ItemActivityFeed.GetIsCommentsDisabled",path:n,accessToken:t.activityItemWrapper.accessToken,requestType:"GET",expectedErrorCodes:o,useAuthorizationHeaders:-1!==n.indexOf(r)}).then(function(e){return e&&e.commentSettings&&e.commentSettings.commentingDisabled&&!!e.commentSettings.commentingDisabled.isDisabled},function(e){return i.n.reject(e)})},e.prototype.setCommentsDisabled=function(e,t,n){var a=e,r={id:t.item.itemId,commentSettings:{commentingDisabled:{isDisabled:n}}};return this._dataRequestor.send({apiName:"ItemActivityFeed.SetCommentsDisabled",path:a,accessToken:t.activityItemWrapper.accessToken,requestType:"PATCH",useAuthorizationHeaders:!0,getErrorAsMessage:!0,postData:JSON.stringify(r)}).then(function(e){return!0},function(e){return i.n.reject(e)})},e.prototype._getRequestUrl=function(e,t){var n;if(t.nextLink)n=t.nextLink;else{var a=t.pageSize||25;n="".concat(e,"/comments?"),n+="$top=".concat(a)}return n},e}(),c=function(){function e(e,t){this._itemCommentsService=new s(e=e,{vroomDataRequestor:t.vroomDataRequestor,itemCommentsResultProcessor:t.itemCommentsResultProcessor}),this._graphDataSource=t.graphDataSource}return e.prototype.getComments=function(e){var t=this.getGraphItemUrlV2dot1(e.itemWrapper);return this._itemCommentsService.getComments(t,e)},e.prototype.addComment=function(e,t,n){var a=this.getGraphItemUrlV2dot1(e);return this._itemCommentsService.addComment(a,e,t,n)},e.prototype.deleteCommentById=function(e,t){var n=this.getGraphItemUrlV2dot1(e);return this._itemCommentsService.deleteCommentById(n,e,t)},e.prototype.addReply=function(e,t,n){throw new Error("Method not implemented.")},e.prototype.getReplies=function(e,t){return i.n.resolve(void 0)},e.prototype.getIsCommentsDisabled=function(e){var t=this.getGraphItemUrlV2dot1(e);return this._itemCommentsService.getIsCommentsDisabled(t,e)},e.prototype.setCommentsDisabled=function(e,t){void 0===t&&(t=!0);var n=this.getGraphItemUrlV2dot1(e);return this._itemCommentsService.setCommentsDisabled(n,e,t)},e.prototype.deleteAllComments=function(e){throw new Error("Method not implemented.")},e.prototype.getGraphItemUrlV2dot1=function(e){return this._graphDataSource.getItemUrl(e.item,{useDirectEndpoint:!0,apiVersion:"v2.1"})},e}(),d=n(0),l=n(2481),u=function(){function e(){}return e.prototype.processResponse=function(e){var t=this,n=e.item,a=e.response,i=a.value.map(function(e){return t._processCommentResponse(n,e)});return{nextLink:a["@odata.nextLink"],inlineCount:i.length,comments:i,success:!0}},e.prototype._processCommentResponse=function(e,t){var n=this._extractDetailFromCommentSingleLevel(t),a={comment:{commentId:t.id,commentDetail:Object(d.__assign)(Object(d.__assign)({},n),{replies:{comments:[],success:!0}})}};return{id:e.item.id+"_"+t.id,item:e.activityItemWrapper,type:l.e.comment,actors:[n.author],action:a,time:new Date(t.createdDateTime),friendlyDisplayTime:t.createdDateTime}},e.prototype._extractDetailFromCommentSingleLevel=function(e){var t;return e&&e.mentioned&&(t=e.mentioned.map(function(e){return e.user})),e&&{id:e.id,author:e.createdBy.user,text:e.content,mentioned:t,createdDate:new Date(e.createdDateTime),parentId:e.parentId,replyCount:e.replyCount,friendlyDisplayTime:e.createdDateTime}},e}(),f=Object(a.r)("ItemCommentsResultProcessor",u,{}),p=n(1882),m=n(3848),_=Object(a.r)("ItemCommentsDataSource",c,{vroomDataRequestor:p.e,itemCommentsResultProcessor:f,graphDataSource:m.resourceKey})}}]);