(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[450],{2880:function(e,t,n){"use strict";var a=n(291),i=n(321),r=function(){function e(e,t){this._dataRequestor=t.dataRequestor,this._substrateToken=e.substrateToken,this._mailbox=e.mailbox}return e.prototype.getContacts=function(e){var t="/me/contacts?$select=displayName,emailAddresses&$top=50";return e&&e.length>0&&(t+='&$search="'.concat(a.e.encodeURIComponent(e),'"')),this._dataRequestor.send({path:t,apiName:"GetContacts",requestType:"GET",useAuthorizationHeaders:!0}).then(function(e){return e.value})},e.prototype.getPeople=function(e){var t="/me/people?$select=displayName,emailAddresses&$top=20";return e&&e.length>0&&(t+='&$search="'.concat(a.e.encodeURIComponent(e),'"')),this._dataRequestor.send({path:t,apiName:"GetTopCollaborators",requestType:"GET",useAuthorizationHeaders:!0}).then(function(e){return e&&e.value},function(e){})},e.prototype.searchPeople=function(e){var t="/me/people?$select=displayName,emailAddresses&$top=20";return e&&e.length>0&&(t+='&$search="'.concat(a.e.encodeURIComponent(e),'"')),this._dataRequestor.send({path:t,apiName:"SearchPeople",requestType:"GET",useAuthorizationHeaders:!0}).then(function(e){return e&&e.value},function(e){})},e.prototype.searchPeople3S=function(e){var t,n={Authorization:"Bearer "+this._substrateToken,"x-anchormailbox":"SMTP:".concat(this._mailbox)};return t=JSON.stringify({EntityRequests:[{EntityType:"People",ProvenanceMergeMode:"Default",Provenances:["Mailbox"],Query:{QueryString:e},From:0,Size:25,Fields:["DisplayName","EmailAddresses","CompanyName","JobTitle","OfficeLocation","Department","UserPrincipalName","PeopleType","PeopleSubtype"]}],TimeZone:"UTC",Cvid:i.e.generate(),Scenario:{Name:"documentshare"}}),this._dataRequestor.send({apiName:"Substrate.PeopleSearch",path:"/api/v1/suggestions",endpoint:"https://outlook.office.com/search",needsAuthorization:!1,headers:n,requestType:"POST",postData:t}).then(function(e){return e&&e.Groups&&e.Groups.length&&e.Groups[0].Suggestions},function(e){})},e}();t.e=r},3225:function(e,t,n){"use strict";n.d(t,"e",function(){return r});var a=n(60),i=function(){return null},r=function(){function e(e){this.getPersonaDetails=i,this.subscribePresence=i,this.getPickerEntityInformation=i,this.addToMruCache=i,this._dataSource=e,this.MaxCacheSuggestions=0}return e.prototype.search=function(e,t){var n,i=this,r={cached:null,promise:null};return r.promise=new a.n(function(a,r){n=i._dataSource.search(e,t).then(function(e){e&&a(e)},function(e){r(e)})},function(){n&&n.cancel()}),r},e.prototype.resolve=function(e,t){return this._dataSource.resolve(e,t).then(function(e){return e})},e}()},3410:function(e,t,n){"use strict";n.d(t,"e",function(){return o});var a,i=n(60),r=n(1983);!function(e){e[e.Email=0]="Email",e[e.User=1]="User",e[e.Group=2]="Group",e[e.Link=3]="Link",e[e.Public=4]="Public",e[e.Friends=5]="Friends",e[e.Facebook=6]="Facebook",e[e.Application=7]="Application",e[e.GroupOwned=99]="GroupOwned"}(a||(a={}));var o=function(){function e(e,t){this._service=e,this._supportsPeople=t||!1}return e.prototype.getCapabilities=function(){return{supportsMruCaching:!1}},e.prototype.search=function(e,t){var n=this;if(t.useNew3Ssearch)try{return this._service.searchPeople3S(e).then(function(a){if(a&&a.length){var i=[],o=r.e.isValidEmailSyntax(e,!1);!1!==t.resolveEmailIfNoResults&&0===i.length&&o&&i.push({email:e,name:e,userId:e,isResolved:!0});for(var s=0,c=a;s<c.length;s++){var d=c[s],l=d.EmailAddresses&&d.EmailAddresses.length?d.EmailAddresses[0]:"",u="";if(l)try{(u=btoa(d.Id)).indexOf(l)>-1&&(u=u.substring(0,u.indexOf(l)))}catch(e){u=""}i.push({email:l,name:d.DisplayName,userId:u,isResolved:!0})}return i}return n._getContact(e,t)})}catch(e){}else if(this._supportsPeople)try{return this._service.searchPeople(e).then(function(n){var a,i,o=[],s=r.e.isValidEmailSyntax(e,!1);if(!1!==t.resolveEmailIfNoResults&&0===o.length&&s&&o.push({email:e,name:e,userId:e,isResolved:!0}),n&&n.length>0)for(var c=0,d=n;c<d.length;c++){var l=d[c],u=null===(i=null===(a=null==l?void 0:l.emailAddresses)||void 0===a?void 0:a[0])||void 0===i?void 0:i.address,f="";if(u)try{(f=btoa(l.id)).indexOf(u)>-1&&(f=f.substring(0,f.indexOf(u)))}catch(e){f=""}o.push({email:u,name:l.displayName,userId:f,isResolved:!0})}return o})}catch(e){}return this._getContact(e,t)},e.prototype._getContact=function(e,t){return this._service.getContacts(e).then(function(n){var a=r.e.isValidEmailSyntax(e,!1);if(!1!==t.resolveEmailIfNoResults&&0===n.length&&a)return[{email:e,name:e,userId:e,isResolved:!0}];var i=e.toLowerCase();return n.map(function(e){var t="",n="",r=e.emailAddresses;if(r&&r.length>0)for(var o=0,s=r;o<s.length;o++){var c=s[o];if(c&&c.address&&c.address.length>0&&(n||(n=c.address),a&&0===c.address.toLowerCase().indexOf(i))){t=c.address;break}}return{userId:a&&t||e.displayName,name:e.displayName,email:a?t:n,isResolved:!0}}).filter(function(e){return e.email})})},e.prototype.resolve=function(e,t){var n,a=this,r=function(){n&&(n.cancel(),n=void 0)};return new i.n(function(o,s){var c=function(e){r(),o(e)};n=i.n.timeout(2e3).then(function(){c(a._getPersonFromQuery(e))}),a.search(e,t).then(function(t){0===t.length?c(a._getPersonFromQuery(e)):c(t[0])},function(t){c(a._getPersonFromQuery(e))})},r)},e.prototype.getPersonaDetails=function(e){return null},e.prototype.subscribePresence=function(e,t){return{dispose:function(){}}},e.prototype.getPickerEntityInformation=function(e){return null},e.prototype._getPersonFromQuery=function(e){var t=new r.e(e),n={};return t.getEmail()?(n.name=t.getName()||"",n.image="",n.sharingInfo={type:a.Email},n.isResolved=!0):n.name=n.name||e,n.email=t.getEmail()||e,n},e}()},4684:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return P});var a=n(0),i=n(60),r=n(1877),o=n(1960),s=n(814),c=function(){function e(e){this._itemTaskObserver=e.itemTaskObserver}return e.prototype.updateItem=function(e,t){this._itemTaskObserver.update([new o.t(e.key).succeed({item:Object(a.__assign)({key:e.key},t)})],!1),this._itemTaskObserver.flush()},e.prototype.getAccessToken=function(e,t){if(t)return t.getAccessToken(e)},e.prototype.isOfficeItem=function(e){var t=e.extension&&e.extension.replace(/^\./,"");return t&&s.t[t]&&".pdf"!==e.extension},e}(),d=n(119),l=n(58),u=n(67),f=n(29),p=n(151),m=n(2852),_=n(2818),h=n(36),b=n(10),g=n(377),v=n(1875),y=n(810),S=n(94),D=n(2366),I=n(2078),x=n(3007),C=n(2070),O=n(47),w=n(2880),E=n(3410),A=n(3225),L=n(68),k=n(8),M=function(e){function t(t,n){var a=e.call(this,t,n)||this;return a._actionMap=n.actionMap,a._itemTaskObserver=new n.itemTaskObserver,a._isOneDriveWinApp=Object(p.e)(),a._urlDataSource=n.urlDataSource,a._baseHelper=new c({itemTaskObserver:a._itemTaskObserver}),a._identityDataSource=n.identityDataSource,a._checkUserAccessDataSource=n.checkUserAccessDataSource,a._itemRedeemer=n.itemRedeemer,a._graphDataRequestor=n.graphDataRequestor,a._itemSelectionHelper=new(a.child(y.e))({allowMultiSelect:!0,canFallback:!1}),a._setAtMentionEnable(),a._isAtMentionEnabled&&a._initPeoplePicker(),a}return Object(a.__extends)(t,e),t.prototype.getPeoplePickerProvider=function(){return this._peoplePickerProvider},t.prototype.getActivityItemUrl=function(e){var t=this._getActivityItemUrl(e);return this._appendDeeplinkQueryParams(t,e)||t},t.prototype.getGraphItemUrl=function(e,t){if(t){var n=t.getItemUrl(e,{useDirectEndpoint:!0});return this.isCommentsInActivityFeedEnabled()?n:n.substring(0,n.indexOf("/drives/"))+"/drive/root"}},t.prototype.updateItem=function(e,t){this._baseHelper.updateItem(e,t)},t.prototype.getAccessToken=function(e,t){return this._baseHelper.getAccessToken(e,t)},t.prototype.isNonOfficeFileCommentsAvailable=function(e){return this.isCommentsInActivityFeedEnabled()&&this._isCommentsSupportedOnItem(e)},t.prototype.renderUser=function(e,t){return t?t(e):null},t.prototype.getAPIEnvironment=function(e){return"consumer"},t.prototype.getCurrentRootTitle=function(e){return e&&e.isRootFolder&&e.name||void 0},t.prototype.getDefaultItemTitle=function(e){},t.prototype.navigateToItem=function(e,t,n,i){var r=this;if(n){var o=t.driveItem;if(o.webUrl||(o=Object(a.__assign)(Object(a.__assign)({},o),{webUrl:n})),t.isFolder&&o.webUrl)i&&i("folder"),this.navigateToFolder(o.webUrl);else{var s=this._tryAndFetchOneDriveItem(o);s?(i&&i(s.folder?"folder":s.extension||"file"),n&&(s.openUrl=n),this.navigateToOneDriveItem(s)):this._convertToOneDriveItem(e,o).then(function(e){i&&i(e.folder?"folder":e.extension||"file"),n&&(e.openUrl=n),r.navigateToOneDriveItem(e)})}}},t.prototype.isGuestUser=function(){return!this._identityDataSource||this._identityDataSource.getIdentity().type===g.e.anonymous},t.prototype.isAnonymousUser=function(){return this.isGuestUser()},t.prototype.isAccessTokenRequired=function(){return!1},t.prototype.getCommentListItem=function(e,t){if(this.isNonOfficeFileCommentsAvailable(e))return{item:e,activityItemWrapper:t,parentListId:e.key}},t.prototype.getCommentItemWrapper=function(e,t){var n=this.getGraphItemUrl(e,t),a=this.getAccessToken(e,t);return this.getCommentListItem(e,{name:e.displayName,graphItemUrl:n,accessToken:a})},t.prototype.getCurrentUserEmail=function(){return this._identityDataSource.getIdentity().email},t.prototype.isCommentOnItemDisabled=function(e){return!!(e&&e.comments&&e.comments.settings&&e.comments.settings.isCommentDisabled)},t.prototype.isCommentingDisabledOnList=function(e){return!1},t.prototype.isCommentingDisabledOnTenant=function(e){return!1},t.prototype.isItemNotificationActive=function(e){if(!e)return!1;var t=this._urlDataSource.getOwnerId(void 0,{}).toLowerCase()===this._urlDataSource.getOwnerId(e.key).toLowerCase(),n=this._itemSelectionHelper.currentItem(),a=this._urlDataSource.getKeyParams(n.key),i=this._urlDataSource.getQueryType(a);return!this.isGuestUser()&&t&&!e.isPlaceholder&&e.type!==S.e.Folder&&!this._urlDataSource.isRecycleBin(i)&&!this._urlDataSource.isCurrentQueryRecent()&&Object(b.isFeatureEnabled)(b.EnableNotificationSubscriptions)},t.prototype.isCommentsInActivityFeedEnabled=function(){return!0},t.prototype.isActivityContextMenuAvailable=function(e){var t;return this.isWXPCommentingDisabled(e)?this.isCommentsInActivityFeedEnabled()&&void 0!==e.type&&e.type!==S.e.Folder&&0!==(null===(t=e.comments)||void 0===t?void 0:t.count):this.isCommentsInActivityFeedEnabled()&&void 0!==e.type&&e.type!==S.e.Folder},t.prototype.isCommentsOnly=function(e,t){return!(!e.folder||e.isRootFolder)||this.isNonOfficeFileCommentsAvailable(e)&&t},t.prototype.getDeepLinkCommentThreadId=function(){var e,t=this.resources.consume(x.e);return e=t.peek().commentId,t({}),e},t.prototype.cleanupDeeplinkCommentId=function(){this.resources.consume(x.e)({})},t.prototype.isReadOnly=function(e){var t=this.isNonOfficeFileCommentsAvailable(e),n=this.isCommentOnItemDisabled(e);return!(t&&this.checkHasCommentingPermission(e))||n},t.prototype.checkHasDeletePermission=function(e){return this.checkHasCommentingPermission(e)},t.prototype.isSingleLevel=function(e){return!e.isRootFolder},t.prototype.getPersonaIconUrl=function(){return function(e){return r.e.getProfileImage(e)}},t.prototype.activityHeaderToDisplay=function(e){var t;return e.type===S.e.Folder?e.isRootFolder?D.l:D.c:this.isWXPCommentingDisabled(e)&&0===(null===(t=e.comments)||void 0===t?void 0:t.count)?D.l:void 0},t.prototype.userCanManageCommentsSettings=function(e){return!(this.isGuestUser()||e.sharingRole!==v.e.Owner||void 0!==e.dateDeleted||e.vault&&e.vault.root)},t.prototype.getActivityApiHeaders=function(e){return e.isRootFolder?"Get-Self,Force-VaultItems-Filter":"Get-Self"},t.prototype.checkHasCommentingPermission=function(e){return!this.isGuestUser()&&(e.sharingRole===v.e.Owner||e.sharingRole===v.e.Edit)},t.prototype.getItemNameToDisplay=function(e,t){return D.p},t.prototype.isAtMentionEnabled=function(e){return this._isAtMentionEnabled&&!this._baseHelper.isOfficeItem(e)&&!e.vault},t.prototype.isWXPCommentingDisabled=function(e){return!!this._baseHelper.isOfficeItem(e)||e.type===S.e.OneNote},t.prototype.isPublicEmailAddressMentionSupported=function(e){return this.isAtMentionEnabled(e)},t.prototype.checkUserAccess=function(e,t,n,a,r){var o=this,s=t?t.getItemUrl(e,{useDirectEndpoint:!0,apiVersion:"v2.1"}):"",c=[{email:n}],d=i.n.resolve({resultType:O.e.Success});return e.tokenNeedsRedeeming&&(d=this._itemRedeemer.redeemItem(e,{name:"AtMention",resources:this.resources})),d.then(function(t){if(t.resultType===O.e.Success&&o._checkUserAccessDataSource&&n)return e.tokenNeedsRedeeming&&o.updateItem(e,{tokenNeedsRedeeming:!1}),o._checkUserAccessDataSource.checkUserAccess(s,c);throw new Error("CheckAccess pre-condition failed")}).then(function(e){if(a){var t=e.filter(function(e){var t,a;return n.toLowerCase()===(null===(a=null===(t=null==e?void 0:e.recipient)||void 0===t?void 0:t.email)||void 0===a?void 0:a.toLowerCase())});t&&t.length>0&&a(t[0].canWrite)}})},t.prototype._appendDeeplinkQueryParams=function(e,t){var n=e&&new L.t(e),a=t&&t.navigationId;return n&&a&&(n.setQueryParameter("nav",a),n.setQueryParameter("commentId",a)),n&&n.toString()||e},t.prototype._getActivityItemUrl=function(e){var t=e&&e.driveItem;return t&&t.webUrl?t.webUrl:t&&e.isFolder?this._urlDataSource.getCurrentSiteUrl()+"#id="+t.id:t&&void 0!==e.relativePath?this._urlDataSource.getCurrentPageBaseUrl()+e.relativePath:void 0},t.prototype.navigateToOneDriveItem=function(e){var t=this.createObservable(e);this._isOneDriveWinApp?new(this.child(this._actionMap.OpenInDesktopAction))({openRelation:2,item:t,actionType:m.e.OpenItemActivityItem}).execute(void 0):e&&e.openUrl?this.navigateToUrlDirectly(e.openUrl):new(this.child(this._actionMap.ExternalNavigateAction))({item:t}).execute(void 0)},t.prototype.navigateToFolder=function(e){this.navigateToUrlDirectly(e)},t.prototype.navigateToUrlDirectly=function(e){new(this.managed(this._actionMap.NavigationAction))({url:e,forceNavigation:!0,target:"_blank"}).execute(void 0)},t.prototype._convertToOneDriveItem=function(e,t){var n=this;return i.n.resolve(this.resources.consumeAsync(_.e)).then(function(a){var i=a.processItem({itemFromServer:t,requestKey:e.key,observer:n._itemTaskObserver}).key;n._itemTaskObserver.flush();var r=n._itemTaskObserver.getItem({key:i});return r&&(r.queryType=h.e.DetailsPane),r})},t.prototype._tryAndFetchOneDriveItem=function(e){var t,n=e.root?"root":e.id,a=this._urlDataSource.getKey(((t={}).id=n,t)),i=this._itemTaskObserver.getItem({key:a});return i&&(i.queryType=h.e.DetailsPane),i},t.prototype._isCommentsSupportedOnItem=function(e){return e&&!e.isRootFolder&&e.graph&&e.graph.itemId&&(k.e.isActivated("E1B90D96-7497-4B95-8296-2C5D9BF02655","03/24/2022","ItemId and DriveId check for comments")?e.graph.itemId.indexOf("!")>=0:e.graph.itemId!==e.graph.driveId)},t.prototype._initPeoplePicker=function(){var e=new w.e({},{dataRequestor:this._graphDataRequestor});this._peoplePickerDataSource=new E.e(e,!0),this._peoplePickerProvider=new A.e(this._peoplePickerDataSource)},t.prototype._setAtMentionEnable=function(){this._isAtMentionEnabled=!this.isGuestUser()},t.dependencies=Object(a.__assign)(Object(a.__assign)({},l.n.dependencies),{actionMap:f.e,itemTaskObserver:o.a,urlDataSource:u.Se,identityDataSource:u.D,itemRedeemer:C.e,graphDataRequestor:I.e,checkUserAccessDataSource:u.r.optional,itemActivityFeedSharingHelper:u.w.optional}),t}(l.n),P=(t.default=M,Object(d.r)("ItemActivityFeedHelper",M))}}]);