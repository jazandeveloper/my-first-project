(window.odspNextWebpackJsonp=window.odspNextWebpackJsonp||[]).push([[249],{2297:function(e,t,n){"use strict";var a,i;function r(e){return e===i.htmlMp4||e===i.htmlFallback||e===i.flashMp4?a.mp4:e===i.htmlHls||e===i.htmlHlsMediaFoundationFallback||e===i.htmlHlsFFMPEGFallback?a.hls:e===i.htmlHlsV6||e===i.htmlHlsV6MediaFoundationFallback||e===i.htmlHlsV6FFMPEGFallback?a.hlsV6:a.dash}n.d(t,"e",function(){return a}),n.d(t,"t",function(){return i}),n.d(t,"a",function(){return r}),function(e){e.hls="hls",e.hlsV6="hlsV6",e.dash="dash",e.mp4="htmlMp4"}(a||(a={})),function(e){e.none="none",e.flashDash="flashDash",e.flashMp4="flashMp4",e.flashPending="flashPending",e.htmlMp4="htmlMp4",e.htmlDashling="htmlDashling",e.htmlDashlingMediaFoundationFallback="htmlDashlingMediaFoundationFallback",e.htmlHls="htmlHls",e.htmlHlsMediaFoundationFallback="htmlHlsMediaFoundationFallback",e.htmlFallback="htmlFallback",e.htmlDashlingFFMPEGFallback="htmlDashlingFFMPEGFallback",e.htmlHlsFFMPEGFallback="htmlHlsFFMPEGFallback",e.htmlHlsV6="htmlHlsV6",e.htmlHlsV6MediaFoundationFallback="htmlHlsV6MediaFoundationFallback",e.htmlHlsV6FFMPEGFallback="htmlHlsV6FFMPEGFallback"}(i||(i={})),t.n=i},3237:function(e,t,n){"use strict";n.d(t,"e",function(){return l}),n.d(t,"t",function(){return f});var a=n(0),i=n(60),r="SEFH",o="SEFT",s=r.length,c=o.length,d={};function l(e,t){return Object(a.__awaiter)(this,void 0,i.n,function(){return Object(a.__generator)(this,function(n){return[2,t.then(function(t){return function(e,t){return Object(a.__awaiter)(this,void 0,i.n,function(){var n,i,r;return Object(a.__generator)(this,function(a){switch(a.label){case 0:return a.trys.push([0,2,,3]),p("Generate new Blob Url for item key ",e),[4,m(t)];case 1:return n=a.sent(),i=new Blob([u(n)],{type:"video/mp4"}),d[e]=window.URL.createObjectURL(i),[2,d[e]];case 2:return r=a.sent(),[2,Promise.reject(r)];case 3:return[2]}})})}(e.key,t)}).catch(function(e){return i.n.reject(e)})]})})}function u(e){try{var t=new DataView(e),n={startSignature:"",formatVersion:0,dataCount:0,dataReferences:[],endSignature:""},a=e.byteLength-c;n.endSignature=String.fromCharCode(t.getInt8(a),t.getInt8(a+1),t.getInt8(a+2),t.getInt8(a+3));var i=4+c,d=t.getUint32(e.byteLength-i,!0)+i;p("SEF Tail Size: ",d);var l=e.byteLength-d,u=l+s,f=u+4;n.startSignature=String.fromCharCode(t.getInt8(l),t.getInt8(l+1),t.getInt8(l+2),t.getInt8(l+3)),n.formatVersion=t.getUint32(u,!0),n.dataCount=t.getUint32(f,!0);for(var m=l+s+4+4,_=0;_<n.dataCount;++_)n.dataReferences[_]={subData:t.getUint16(m,!0),dataType:t.getUint16(m+2,!0),startPosition:t.getUint32(m+4,!0),dataLength:t.getUint32(m+8,!0)},m+=12;if(D=!0,((S=n).startSignature!==r||S.endSignature!==o||S.formatVersion<101||S.dataCount<=0||2608!==S.dataReferences[S.dataCount-1].dataType)&&(D=!1),p(D?"":"INVALID ","SEF Tail",S),!D)throw new Error("Invalid SEF: "+JSON.stringify(n));var h=d+n.dataReferences[n.dataCount-1].dataLength,b=8+t.getUint32(e.byteLength-h+4,!0);if(p("SEG Header Size: ",b),24!==b)throw new Error("Unexpected motionPhotoHeaderSize: "+b);var g=d+n.dataReferences[n.dataCount-1].dataLength-b,v=e.byteLength-g;p("MP4 Offset: ",v);var y=e.slice(v);if(!function(e){var t=!1,n=new DataView(e);return e.byteLength>8&&(t="ftyp"===String.fromCharCode(n.getInt8(4),n.getInt8(5),n.getInt8(6),n.getInt8(7))),t||p("Not an MP4"),t}(y))throw new Error("Invalid MP4");return y}catch(e){throw e.message="SamsungMotionPhoto Error: "+(e.message||""),p(e.name||"",e.message),e}var S,D;return new ArrayBuffer(0)}function f(e){d[e]&&(window.URL.revokeObjectURL(d[e]),delete d[e],p("Freeing videoBlobs[",e,"]"))}function p(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t]}function m(e){return Object(a.__awaiter)(this,void 0,void 0,function(){return Object(a.__generator)(this,function(t){return[2,new Promise(function(t){var n=new FileReader;n.onload=function(){t(n.result)},n.readAsArrayBuffer(e)})]})})}},4683:function(e,t,n){"use strict";n.r(t),n.d(t,"resourceKey",function(){return g});var a=n(60),i=n(215),r=n(119),o=n(1906),s=n(2297),c=n(67),d=n(10),l=n(151),u=n(30),f=n(3237),p=n(8),m=n(86),_=n(79),h=n(1022),b=function(){function e(e,t){this._downloadDataSource=t.downloadDataSource,this._graphDataSource=t.graphDataSource;var n=t.platformDetection;this._redirectToHttp=n.isAndroid&&n.browserMajor<4,this.isOneDriveWinApp=Object(l.e)()}return e.prototype.isStreamingSupported=function(e){return!0},e.prototype.isHlsPlaybackSupported=function(){return!0},e.prototype.isDownloadBlocked=function(e){return!1},e.prototype.fetchVTTCaptions=function(e){return a.n.resolve()},e.prototype.getCaptionsSrcUrl=function(e){return a.n.resolve()},e.prototype.fetchVideoMetaData=function(e){return a.n.resolve()},e.prototype.fetchTranscripts=function(e){return a.n.resolve()},e.prototype.fetchTranscriptsAndAudioFiles=function(e){throw a.n.resolve()},e.prototype.getDownloadUrl=function(e){var t,n,i,r=this,o=e.item;if((null===(t=o.photo)||void 0===t?void 0:t.isLivePhoto)&&Object(d.isFeatureEnabled)(d.EnableLivePhotoVideos)){if(!o.itemId)return a.n.reject(new Error("Item not available"));var c=p.e.isActivated("11322CDF-E2A5-4DEB-B01A-23763510C988","09/02/2022","Add authkey for annoymous"),l=Object(u.u)({apiVersion:"v1.0",driveId:o.ownerId}),b=(c?"".concat(l,"/drive/items/").concat(o.itemId,"/content?format="):"".concat(l,"/drives/").concat(o.ownerId,"/items/").concat(o.itemId,"/content?format="))+(e.playbackType===s.n.htmlDashling?"dash":"video");i=this._graphDataSource.getAuthenticationParams(o).then(function(e){return b+(e.access_token?"&access_token=".concat(e.access_token):e.authkey&&!c?"&authkey=".concat(e.authkey):"")},function(e){return a.n.reject(e)})}else{if((null===(n=o.photo)||void 0===n?void 0:n.isSamsungMotionPhoto)&&Object(d.isFeatureEnabled)(d.EnableSamsungMotionPhotoVideos)){if(o.itemId){var g=this._downloadDataSource.getItemContents(o);return f.e(o,g)}return a.n.reject(new Error("Item not available"))}if(p.e.isActivated("126A864D-B398-485B-AD70-D7388DE7BA53","10/21/2021","Change video auth")){if(!p.e.isActivated("52C7BEED-7ADC-4169-A943-522B362F7D03","06/1/2022","Use videomanifest so that converged user can play videos.")&&Object(m.e)(_.l))return function(e,t){var n=e.item,i=e.playbackType,r=e.preferEncryption,o=e.forcedCdnParam,c=i===s.n.htmlMp4||i===s.n.htmlFallback,l=n.urls;if(!l)return a.n.reject(new Error("Could not get download URL"));if(!c&&function(e){return!!(e&&e.urls&&e.urls[h.e.video])}(n)){var u=l[h.e.video],f=function(e){return e===s.n.htmlDashling||e===s.n.htmlDashlingMediaFoundationFallback||e===s.n.flashDash||e===s.n.htmlDashlingFFMPEGFallback?"dash":e===s.n.htmlHls||e===s.n.htmlHlsMediaFoundationFallback||e===s.n.htmlHlsFFMPEGFallback?"hls":e===s.n.htmlHlsV6||e===s.n.htmlHlsV6MediaFoundationFallback||e===s.n.htmlHlsV6FFMPEGFallback?"hls-vnext":void 0}(i),p=u&&u.indexOf("?")>-1;if(u&&f)return u+="".concat(p?"&":"?","part=index&").concat("","format=").concat(f),u+="&useScf=True",!e.useBetaTranscode||i!==s.n.htmlDashling&&i!==s.n.htmlDashlingFFMPEGFallback&&i!==s.n.flashDash&&i!==s.n.htmlHls&&i!==s.n.htmlHlsFFMPEGFallback&&i!==s.n.htmlHlsV6&&i!==s.n.htmlHlsV6FFMPEGFallback?u+="&manifestMetadata="+(n.video&&n.video.manifestMetadata||""):(u+="&altTranscode=1",u+="&altManifestMetadata="+(n.video&&n.video.altManifestMetadata||"")),i===s.n.htmlDashling||i===s.n.htmlDashlingMediaFoundationFallback?(u+="&pretranscode=0&transcodeahead=0",r&&((Object(d.isFeatureEnabled)(d.VideoUseCdn)||"1"===o)&&(u+="&enableCdn=1"),Object(d.isFeatureEnabled)(d.VideoEnableEncryption)&&(u+="&enableEncryption=1"))):i===s.n.flashDash&&(u+="&pretranscode=0",u+="&.ism/manifest(format=mpd-time-csf)"),"hls"===f&&r&&(Object(d.isFeatureEnabled)(d.VideoUseCdnForHls)&&(u+="&enableCdn=1"),Object(d.isFeatureEnabled)(d.VideoEnableEncryptionForHls)&&(u+="&enableEncryption=1")),a.n.resolve(u)}return a.n.resolve(l[h.e.download])}(e);i=p.e.isActivated("4DEBB627-E120-4D84-8E8E-682A25A20795","12/20/2021","Use vroom getDownloadUrl api")?this._downloadDataSource.getDownloadUrl(o,{downloadType:2}):this._graphDataSource.getDownloadUrl(o,{useDirectEndpoint:!0})}else{var v=o&&o.urls,y=v&&v.download;i=y?a.n.resolve(y.replace(/\?.+/g,"")):this._graphDataSource.getDownloadUrl(o,{useDirectEndpoint:!0})}}return i.then(function(t){return r._buildVideoUrl(t,e.playbackType)})},e.prototype.getRequestParametersAsync=function(e,t){return this._downloadDataSource.getDownloadRequestParameters(e,{allowHeaders:!1,url:t.replace(/&access_token=[^&]+/g,"")})},e.prototype._buildVideoUrl=function(e,t){if(this._redirectToHttp&&0===e.toLowerCase().indexOf("https:")&&(e="http"+e.substr(5)),-1===e.indexOf("?")&&(e+="?"),t!==s.n.htmlDashling&&t!==s.n.flashDash||(e+="&videoformat=dash&part=index"),t===s.n.htmlDashling)e+="&pretranscode=0",e+="&transcodeahead=0";else if(t===s.n.flashDash)e+="&pretranscode=0",e+="&.ism/manifest(format=mpd-time-csf)";else if(t===s.n.htmlHls)e+="&videoformat=hls&part=index";else if(!this.isOneDriveWinApp)return o.e.authenticate(e).then(function(){return e});return e},e}(),g=(t.default=b,Object(r.r)("VideoItemDataSource",b,{downloadDataSource:c.c,graphDataSource:c.y,platformDetection:i.e}))}}]);